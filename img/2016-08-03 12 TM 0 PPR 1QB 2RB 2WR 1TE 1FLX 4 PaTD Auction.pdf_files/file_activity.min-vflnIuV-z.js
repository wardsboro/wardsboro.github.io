var __decorate=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,c=3>r?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(3>r?o(c):r>3?o(e,i,c):o(e,i))||c);return r>3&&c&&Object.defineProperty(e,i,c),c};define(["require","exports","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(t,e,i,n,o,r,c,a,s,m){"use strict";var u=function(){function t(t){var e=void 0===t?{}:t,n=e.activity_key,o=void 0===n?"":n,r=e.feedback_off,c=void 0===r?!1:r,a=e.can_edit_feedback,s=void 0===a?!0:a,m=e.comment_activities,u=void 0===m?[]:m,f=e.users_to_notify,_=void 0===f?[]:f,v=e.latest_revision,y=void 0===v?null:v;this.activity_key=o,this.feedback_off=c,this.can_edit_feedback=s,this.comment_activities=u,this.users_to_notify=_,this.latest_revision=y,i(this)}return t.fromDict=function(e){return new t({activity_key:e.activity_key,feedback_off:e.feedback_off,can_edit_feedback:e.can_edit_feedback,comment_activities:e.comment_activity_dicts.map(s.CommentActivity.fromDict),users_to_notify:(e.users_to_notify||[]).map(c.ActivityUser.fromDict),latest_revision:e.latest_revision})},t.prototype.enableCommenting=function(){return r.set(this,"feedback_off",!1)},t.prototype.disableCommenting=function(){return r.set(this,"feedback_off",!0)},t.prototype._withMutations=function(t){var e=r.thaw(this),n=this.comment_activities.map(r.thaw);return e.comment_activities=n,e.comment_activities.forEach(function(t){t.comment_activities=t.comment_activities.map(r.thaw)}),t(e),i(e)},t.prototype._reapComments=function(t){var e=this.comment_activities.slice();return this.comment_activities.forEach(function(t){e.push.apply(e,t.comment_activities)}),t?e.filter(t):e},t.prototype._findCommentPath=function(t,e){void 0===e&&(e=!1);for(var i=n.matches({activity_key:t}),o=0;o<this.comment_activities.length;o++){var r=this.comment_activities[o];if(i(r))return["comment_activities",o];if(!e)for(var c=0;c<r.comment_activities.length;c++)if(i(r.comment_activities[c]))return["comment_activities",o,"comment_activities",c]}return null},t.prototype._updateComment=function(t,e){return t?r.updateIn(this,t,e):this},t.prototype._updateConversations=function(t){return r.update(this,"comment_activities",t)},t.prototype._updateReplies=function(t,e){var i=this._findCommentPath(t,!0);return i?(i.push("comment_activities"),r.updateIn(this,i,e)):this},t.prototype.findCommentByKey=function(t){for(var e=n.matches({activity_key:t}),i=0;i<this.comment_activities.length;i++){var o=this.comment_activities[i];if(e(o))return o;for(var r=0;r<o.comment_activities.length;r++){var c=o.comment_activities[r];if(e(c))return c}}return null},t.prototype.findConversationByKey=function(t){return n.findWhere(this.comment_activities,{activity_key:t})},t.prototype.purgeCommentByKey=function(t){var e=this._findCommentPath(t);if(e){var i=e.pop();return r.updateIn(this,e,function(t){return r.splice(t,i,1)})}return this},t.prototype.deleteCommentByKey=function(t){var e=this._findCommentPath(t);return this._updateComment(e,function(t){return t.delete()})},t.prototype.undeleteCommentByKey=function(t){var e=this._findCommentPath(t);return this._updateComment(e,function(t){return t.undelete()})},t.prototype.appendComment=function(t,e){var i=function(t){return r.push(t,e)};return this.activity_key===t?this._updateConversations(i):this._updateReplies(t,i)},t.prototype.resolveCommentByKey=function(t){var e=this._findCommentPath(t);return this._updateComment(e,function(t){return t.resolve()})},t.prototype.unresolveCommentByKey=function(t){var e=this._findCommentPath(t);return this._updateComment(e,function(t){return t.unresolve()})},t.prototype.setCommentStatusByKey=function(t,e){var i=this._findCommentPath(t);return this._updateComment(i,function(t){return t.setStatus(e)})},t.prototype.markCommentSeenByKeyBatch=function(t){return 0===t.length?this:this._withMutations(function(e){var i=e._reapComments(function(e){return n.contains(t,e.activity_key)});i.forEach(function(t){t.is_seen=!0,t.highlight_as_unread=!1})})},__decorate([a.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:o.Maybe(Array),latest_revision:m.RevisionShape})],t,"fromDict",null),t}();e.FileActivity=u});
//# sourceMappingURL=file_activity.min.js-vflMbAEPg.map