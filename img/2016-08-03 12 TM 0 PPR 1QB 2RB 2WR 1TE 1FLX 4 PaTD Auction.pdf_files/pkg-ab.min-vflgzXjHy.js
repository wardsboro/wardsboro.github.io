(function(){var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/ajax",["jquery","external/underscore","modules/clean/devtools/perf_hub_actions","modules/clean/job_progress","modules/clean/storage","modules/clean/undo","modules/constants/debug","modules/constants/env","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v){var y,w,b,x,E,S,T,C,k,R,A,N,L,I,O,D,P,$,M,F,U,j,q,B,H,W,G,z,V,J,X,Y,K,Q,Z,ee,te,ne,re,oe,ie,se,ae,le;return se=m._,B="err:",q="async_task_started:",j="async_task_err:",U="done:",$="oref",H=function(e,n){var r,o,i,s,a;return null==e&&(e={}),null==n&&(n=[]),null==e.type&&(null!=e.method?(p.raiseAndReport("Use of method property within modules/clean/ajax's Request",{tags:["module:ajax"]}),s=e.method):s="POST",e.type=s),r=new E(e),o=ae(r,n),a=t.ajax({url:o.url(),type:e.type,data:o.data(),dataType:e.dataType||"text",headers:o.headers(),traditional:!0,xhrFields:o.xhrFields(),success:function(e,t,n){return o.success(e,t,n)},error:function(e,t,n){return o.error(e,t,n)},complete:function(e,t){return o.complete(e,t)},async:null!=(i=e.async)?i:!0,timeout:e.timeout}),o.request(a)},ae=function(e,t){var n,o,i,s,a,l,u,c;for(o=[e],c=r(t.slice(0)).reverse(),i=0,l=c.length;l>i;i++)n=c[i],o.push(new n);for(a=null,s=0,u=o.length;u>s;s++)n=o[s],a&&(n.next=a),a=n;return a},E=function(){function e(e){null==e&&(e={}),this.options=function(){return e},this.url=function(){return String(e.url||"")},this.data=function(){return e.data||{}},this.headers=function(){return e.headers||{}},this.xhrFields=function(){return e.xhrFields||{}},this.success=e.success||this.identity,this.error=e.error||this.identity,this.complete=e.complete||this.identity,this.request=this.identity}return e.prototype.identity=function(e){return e},e}(),k=function(){function e(){}return e.prototype.options=function(){return this.next.options()},e.prototype.url=function(){return this.next.url()},e.prototype.data=function(){return this.next.data()},e.prototype.headers=function(){return this.next.headers()},e.prototype.xhrFields=function(){return this.next.xhrFields()},e.prototype.success=function(e,t,n){return this.next.success(e,t,n)},e.prototype.error=function(e,t,n){return this.next.error(e,t,n)},e.prototype.complete=function(e,t){return this.next.complete(e,t)},e.prototype.request=function(e){return this.next.request(e)},e}(),T=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.SUPPORTED_TLDS=["dropbox.com"],r.prototype.data=function(){var e;return p.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain"),e={is_xhr:!0},"get"!==(this.options().type||"post").toLowerCase()&&(e.t=h.read(c.JS_CSRF_COOKIE)||""),t.extend(e,this.next.data())},r.prototype._is_db_domain=function(){var e,t;return(e=v.parse(String(this.url())).authority)?(t=e.split("."),this.SUPPORTED_TLDS.reduce(function(e,n){var r,o;return o=n.split("."),r=t.slice(-1*o.length).join("."),e||n===r},!1)):!0},r}(k),Y=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.data=function(){var e,t;return e=this.next.data(),t=this.options(),t.subject_user&&!e[_.UID_PARAM_NAME]&&(e[_.UID_PARAM_NAME]=String(t.subject_user)),e},n.prototype.headers=function(){var e,t;return e=this.next.headers(),t=this.options(),t.subject_user&&(e["X-DROPBOX-UID"]=String(t.subject_user)),e},n}(k),S=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.error=function(e,t,n){var r,o;return 403===e.status&&(r=s.SessionStorage.get("reload-timestamp"),o=(new Date).getTime(),(!r||o-r>3e4)&&(s.SessionStorage.set("reload-timestamp",o),window.location.reload(!0))),this.next.error(e,t,n)},n}(k),G=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.data=function(){var e;return e=this.next.data(),null!=t.ajaxSettings.restrict&&(e.restrict=t.ajaxSettings.restrict),e},r}(k),W=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.data=function(){var e,n;return e=this.next.data(),c.REQUEST_TRACING_ENABLED&&"post"===this.options().type.toLowerCase()?(n={parent_request_id:c.REQUEST_ID},t.extend(n,e)):e},r}(k),N=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.data=function(){var e,n;return e=this.next.data(),l.CPROFILE_ENABLED?(n={parent_request_id:c.REQUEST_ID,cProfile:l.CPROFILE_PARAMETER},t.extend(n,e)):e},r.prototype.success=function(e,t,n){return o.add_ajax_profile({xhr:n,url:this.url()}),this.next.success(e,t,n)},r}(k),A=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.error=function(e,t,n){return this._notify_dev(e,t,n),this.next.error(e,t,n)},r.prototype._notify_dev=function(e,n,r){var o,i,s;return!u.IS_PROD&&500===e.status&&e.getResponseHeader("X-Debug-Url")?(s=e.getResponseHeader("X-Debug-Url"),o=t("<span />"),o.text(g.DEFAULT_ERROR),i=t("<a/>",{href:s,target:"_blank"}).text(se("View debug")),o.append("&nbsp;").append(i),g.error(new f(o.html()))):void 0},r}(k),K=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.success=function(e,t,n){var r,o,i;return n.responseText.length?0===n.responseText.indexOf(B)?(r=n.responseText.substr(B.length),i=this.next.error(n,t,r),"{"!==(o=r[0])&&"["!==o&&g.error(r),i):this.next.success(e,t,n):this.next.error(n,t,"")},n.prototype.error=function(e,t,n){return"abort"!==t&&g.error(g.DEFAULT_ERROR),this.next.error(e,t,n)},n}(k),I=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.success=function(e,t,n){var r;if(!this.options().skipErrorHandling){if(!n.responseText.length)return this.next.error(n,t,"");if(0===n.responseText.indexOf(B))return r=n.responseText.substr(B.length),this.next.error(n,t,r)}return this.next.success(e,t,n)},n}(k),Q=function(t){function r(){return this._clear_working_msg=n(this._clear_working_msg,this),r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.request=function(e){return this.xhr=e,setTimeout(function(e){return function(){return e._request_finished()?void 0:e._should_show_working_msg()?(e._show_working_msg(),e.xhr.done(e._clear_working_msg)):void 0}}(this),4e3),this.next.request(this.xhr)},r.prototype._request_finished=function(){return 4===this.xhr.readyState},r.prototype._should_show_working_msg=function(){return g.isShown()&&g.current()!==a.undo_notification},r.prototype._show_working_msg=function(){return this.notification=g.success(se("Still working..."))},r.prototype._clear_working_msg=function(){return g.isShown()&&this.notification===g.current()?g.clear():void 0},r}(k),F=function(r){function o(){return this._watch=n(this._watch,this),o.__super__.constructor.apply(this,arguments)}return e(o,r),o.prototype.data=function(){var e,n;return this.job_id=o.generate_job_id(),e=this.next.data(),this.uid=e[_.UID_PARAM_NAME],n=this.options().subject_user,!this.uid&&n&&(this.uid=String(n)),t.extend({job_id:this.job_id},e)},o.prototype.request=function(e){return this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval),this.next.request(e)},o.prototype.success=function(e,t,n){return this.next.success(e,t,n)},o.prototype.error=function(e,t,n){return this.next.error(e,t,n)},o.prototype.complete=function(e,t){return this._stop(),i.Job.handled(this.job_id),this.next.complete(e,t)},o.prototype._watch=function(){return i.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},o.prototype._stop=function(){return clearInterval(this._watch_id),i.ModalProgress.hide()},o.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,i.ModalProgress.show(this.options().progress_text))},o.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[_.UID_PARAM_NAME]=this.uid),x({url:"/job_status/"+this.job_id,data:e,success:function(e,t,n){var r;return r=0===n.responseText.indexOf("done")?"1/1":n.responseText,i.ModalProgress.update(r)},error:function(e){return function(t,n,r){return e._failures++,e._failures<3?void 0:(e._stop(),e.next.error(t,n,r))}}(this)})},o.generate_job_id=function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString(),t=("000000"+t).substring(t.length),n+t},o}(k),w=function(t){function r(){return this._watch=n(this._watch,this),r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.data=function(){var e,t;return e=this.next.data(),this.uid=e[_.UID_PARAM_NAME],t=this.options().subject_user,!this.uid&&t&&(this.uid=String(t)),e},r.prototype.success=function(e,t,n){return this._is_async_job_response(n)?(this.job_id=n.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(e,t,n)},r.prototype.complete=function(e,t){return this._is_async_job_response(e)?void 0:this.next.complete(e,t)},r.prototype._is_async_job_response=function(e){var t,n;return 0!==(null!=(n=e.responseText)?n.indexOf(q):void 0)?!1:(t=e.responseText.split(":")[1],t.match(/^[A-Za-z0-9_\-=]*$/))},r.prototype._watch=function(){return i.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},r.prototype._stop=function(){return clearInterval(this._watch_id),i.ModalProgress.hide()},r.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,i.ModalProgress.show(this.options().progress_text))},r.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[_.UID_PARAM_NAME]=this.uid),x({url:"/async_task_status/"+this.job_id,data:e,success:function(e){return function(t,n,r){var o,s,a;return a=r.responseText,0===a.indexOf(U)?(i.Job.handled(e.job_id),e._stop(),a=a.substr(U.length),r.responseText=a,e.next.success(a,n,r),e.next.complete(r,n)):0===a.indexOf(B)?(i.Job.handled(e.job_id),e._stop(),o=a.substr(B.length),g.error(o),e.next.error(r,n,o),e.next.complete(r,n)):0===a.indexOf(j)?(i.Job.handled(e.job_id),e._stop(),s=a.substr(j.length),g.error(new f(s)),e.next.complete(r,n)):i.ModalProgress.update(a)}}(this),error:function(e){return function(t,n,r){return e._failures++,e._failures<3?void 0:(e._stop(),e.next.error(t,n,r),e.next.complete(t,n))}}(this)})},r}(k),M=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.data=function(){var e,n;return e=d.get_uri().getQuery()[$],!(null!=(n=this.next.data())?n.oref:void 0)&&e?t.extend({oref:e},this.next.data()):this.next.data()},r}(k),C=function(r){function o(){this.browser_unload_handler=n(this.browser_unload_handler,this),o.__super__.constructor.apply(this,arguments),this.is_browser_unloading=!1}return e(o,r),o.prototype.browser_unload_handler=function(){this.is_browser_unloading=!0},o.prototype.request=function(e){var n;return t(window).on("beforeunload",this.browser_unload_handler),(n=this.next).request.apply(n,arguments)},o.prototype.error=function(e,t,n){var r,o,i;return r=0===e.status&&0===e.readyState&&"error"===t&&!n,o=r&&this.is_browser_unloading,o?this.next.error(e,"abort","unload"):(i=this.next).error.apply(i,arguments)},o.prototype.complete=function(){var e;return t(window).off("beforeunload",this.browser_unload_handler),(e=this.next).complete.apply(e,arguments)},o}(k),ie=[C],y=[Y,T,S,G],b=function(e){return null==e&&(e={}),H(e,[].concat(ie,y))},P=[Q],R=[A,N,W],D=[w],ee=[].concat(ie,P,K,R,y,D),re=function(e){return null==e&&(e={}),H(e,ee)},oe=function(e){return null==e&&(e={}),H(e,[].concat(M,ee))},L=[].concat(ie,P,I,R,y,D),O=function(e){return null==e&&(e={}),H(e,L)},te=[].concat(ie,P,K,R,y,F,D),ne=function(e){return null==e&&(e={}),H(e,te)},x=function(e){return null==e&&(e={}),H(e,[].concat(ie,R,y))},z=[Y,T,G],V=[].concat(ie,R,z),J=function(e){return null==e&&(e={}),H(e,V)},X=function(e){return null==e&&(e={}),H(e,[].concat(M,V))},Z=function(e){var n,r,o;return null==e&&(e={}),n=new E(e),r=ae(n,y),o=t.ajax({url:r.url(),type:"OPTIONS",data:r.data(),success:function(e,t,n){return r.success(e,t,n)},error:function(e,t,n){return r.error(e,t,n)},complete:function(e,t){return r.complete(e,t)}}),r.request(o)},le={Request:H,AuthenticatedRequest:b,BackgroundRequest:x,SilentBackgroundRequest:J,SilentBackgroundRequestOref:X,WebRequest:re,WebRequestOref:oe,FormWebRequest:O,WebProgressRequest:ne,ValidationSchemaRequest:Z}})}).call(this),function(){define("modules/clean/analytics",["jquery","modules/clean/viewer","modules/clean/ajax","modules/clean/web_timing_logger"],function(e,t,n,r){var o,i,s,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x,E;return E=function(e){var n,r,o;return o=t.get_viewer(),n=e?[e]:function(){var e,t,n,i;for(n=o.get_users(),i=[],e=0,t=n.length;t>e;e++)r=n[e],i.push(r.id);return i}()},o={log:function(e,t){var r,o,i,s,a;for(i=0,s=0,a=e.length;a>s;s++)r=e[s],r.dir&&i++;return o=e.length-i,n.AuthenticatedRequest({url:"/browse_actions_context_menu_logger",data:{file_count:o,folder_count:i,action:t}})}},v={log:function(e,t){return n.AuthenticatedRequest({url:"/log/ux_analytics",data:{event_type:e,extra_params:JSON.stringify(t)}})}},c={log:function(e,t){return n.AuthenticatedRequest({url:"/log/pro_events",data:{event:e,extra:JSON.stringify(t)}})}},s={start_time:0,start:function(e){return null==e&&(e=null),this.start_time?void 0:this.start_time=e||Date.now()},stop:function(e){return this.start_time?e.extra.time_taken=Date.now()-this.start_time:e.extra.time_taken=0,this.log(e),this.start_time=0},log:function(e){return n.AuthenticatedRequest({url:"/log/file_view",data:{viewing_user_ids:JSON.stringify(E(e.user_id)),target:e.target,platform:e.platform,origin:e.origin||null,action:e.action||null,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,shared_link_url:e.shared_link_url||null,extra:JSON.stringify(e.extra)}})}},a={log:function(e,t,r,o,i,s){return null==s&&(s={}),n.AuthenticatedRequest({url:"/linkfile_activity_log",data:{event_name:e,file_ext:t,link_domain:r,success:o,source:i,extra:JSON.stringify(s)}})}},l={start_times:{},start:function(e,t){return null==t&&(t=null),this.start_times[e]=t||Date.now()},stop:function(e,t){return null!=this.start_times[e]?(t.total_time=Date.now()-this.start_times[e],this.log(e,t),delete this.start_times[e]):void 0},log:function(e,t){return null==t&&(t={}),n.AuthenticatedRequest({url:"/preview_activity_log",data:{event_name:e,input_method:t.input_method,file_ext:t.file_ext,extra:t.extra}})}},u={log:function(e,t,r,o,i,s,a){return n.AuthenticatedRequest({url:"/preview_quality_popup_logger",subject_user:t,data:{event_name:e,file_nsid:r,file_sjid:o,extension:i,doc_preview_status:s,feedback_text:a}})}},_={create_completion_log_dict:function(e,t,n,r,o,i,s,a,l){return null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),null==r&&(r=null),null==o&&(o=null),null==i&&(i=null),null==s&&(s=null),null==a&&(a=null),null!=e?(null!=t&&(e.request_id=t),null!=n&&(e.latency=(new Date).getTime()-n),null!=r&&(e.query_string=r),null!=o&&(e.displayed=o),null!=i&&(e.result_count=i),null!=s&&200!==s&&(e.failure_type=s),null!=a&&(e.file_nsid=a.ns_id,e.file_sjid=a.sjid),e):void 0},log:function(e,t,r){return null==r&&(r={}),n.AuthenticatedRequest({url:"/searchclientlogger",subject_user:t,data:{event_name:e,action_type:r.action_type,displayed:r.displayed,failure_type:r.failure_type,file_nsid:r.file_nsid,file_sjid:r.file_sjid,firefly:r.firefly,infinite_scroll:r.infinite_scroll,latency:r.latency,match_type:r.match_type,path_scoped:r.path_scoped,position:r.position,query_string:r.query_string,request_id:r.request_id,result_count:r.result_count,search_type:r.search_type,viewport:r.viewport}})}},h={flow_id:null,log:function(e,t,r,o,i){var s;return null==r&&(r=null),null==o&&(o={}),null==i&&(i=!1),(i||null===this.flow_id)&&(s=new Date,this.flow_id=s.getTime().toString()+Math.random().toString(),this.flow_id=this.flow_id.replace(".","")),n.AuthenticatedRequest({url:"/sflogger",data:{platform:e,event_name:t,extra:JSON.stringify(o),active_uid:null!=r?r.id:null,flow_id:this.flow_id}})}},d={log:function(e,t,r,o){return null==o&&(o={}),n.AuthenticatedRequest({url:"/share_tib_log",data:{event:t,origin:r,extra:JSON.stringify(o)},subject_user:e})},log_unauth:function(e,t,r){return null==r&&(r={}),n.AuthenticatedRequest({url:"/share_tib_log_unauth",data:{event:e,origin:t,extra:JSON.stringify(r)}})}},p={log:function(e,t,r){return null==r&&(r={}),n.AuthenticatedRequest({url:"/log/sharing_experiments",data:{action_type:t,action_extras:JSON.stringify(r)},subject_user:e})}},f={TARGET_ITEMS:{FOLDER_IS_SF:"folder-is-sf",FOLDER_CAN_SF:"folder-can-sf",FOLDER_NO_SF:"folder-no-sf",FILE:"file"},log:function(e,t,r){return new n.AuthenticatedRequest({url:"/shmuilog",data:{evt:e,origin:t,target_item:r}})},log_with_target_file:function(e,t,n){return this.log(e,t,this.get_target_item(n))},get_target_item:function(e){var t;return t=f.TARGET_ITEMS,e.dir?e.is_shared_folder()?t.FOLDER_IS_SF:e.could_be_shared_folder()?t.FOLDER_CAN_SF:t.FOLDER_NO_SF:t.FILE}},g={LOG_CATEGORY:{PROMO_TEAMS:"promo_teams",TEAM_INFO:"team_info",UPGRADE:"upgrade_to_dfb",USAGE_INFO:"usage_info"},log:function(e,t,r,o,i,s){var a;return null==o&&(o=null),null==i&&(i=!1),a=E(o),n.AuthenticatedRequest({url:"/teamswalogger",data:{event_name:e,extra:JSON.stringify(t),for_uids:JSON.stringify(a),log_category:s,restricted:i?"1":void 0},success:r?r:void 0,error:r?r:void 0})},registerToLogClickEvent:function(t,n,r){return e(t).click(function(e){return function(){return e.log(n,null,null,null,!1,r)}}(this))}},y={start_times:{},start:function(e,t,n){return null==n&&(n=null),this.start_times[t]=n||Date.now()},stop:function(e,t,n,r){return null==r&&(r=null),null!=this.start_times[t]?(n.total_time=Date.now()-this.start_times[t],this.log(e,t,n,r),delete this.start_times[t]):void 0},log:function(e,t,r,o){var i;return null==o&&(o=null),r=r||{},i=E(o),n.AuthenticatedRequest({url:"/ualogger",data:{platform:e,event_name:t,extra:JSON.stringify(r),for_uids:JSON.stringify(i)}})}},w={log:function(e,t,r,o){return n.AuthenticatedRequest({url:"/virallogger",data:{user_ids:JSON.stringify(e),viral_type:t,action:r,extra:JSON.stringify(o||{})}})}},b={log:function(e,t,r){var o;return null==r&&(r=null),o=E(r),n.AuthenticatedRequest({url:"/misclogger",data:{event_name:e,extra:JSON.stringify(t),for_uids:JSON.stringify(o)}})}},m={_log:function(e,t){return null==t&&(t={}),n.AuthenticatedRequest({url:"/support_experiments_log",data:{event_name:e,extra:JSON.stringify(t)}})},log_file_restore:function(e){return this._log("file_restore",{ref:e})}},i=i=function(){function e(e){this.context=null!=e?e:null,this._clear_buffers()}return e.prototype._clear_buffers=function(){return this.selection_buffer=[],this.timing_buffer=[],this.total_searches=0,this.slow_searches=0},e.prototype.add_record=function(e){return e.deleted=!1,this.selection_buffer.push(e)},e.prototype.flag_record_as_removed=function(e){var t,n,r,o;for(o=this.selection_buffer,n=0,r=o.length;r>n;n++)if(t=o[n],t.contact_id===e&&!t.deleted)return void(t.deleted=!0)},e.prototype.add_timing_record=function(e){return this.timing_buffer.push(e)},e.prototype.count_search=function(e){return this.total_searches+=1,e?this.slow_searches+=1:void 0},e.prototype.log_records=function(e,t,r){var o,i;return null==r&&(r=0),o={events:JSON.stringify(this.selection_buffer),canceled:t},(this.total_searches||this.timing_buffer.length)&&(i={context:this.context,total_searches:this.total_searches,slow_searches:this.slow_searches},o.total_contacts=r,o.timing_events=JSON.stringify(this.timing_buffer),o.session_summary=JSON.stringify(i)),n.AuthenticatedRequest({url:"/contact_search_log",subject_user:e,data:o}),this._clear_buffers()},e}(),x={BrowseActionsContextMenuLogger:o,ContactSearchLogger:i,UXAnalyticsLogger:v,ProEventsLogger:c,FileViewLogger:s,LinkfileActivityLogger:a,PreviewQualityPopupLogger:u,PreviewActivityLogger:l,SearchClientActivityLogger:_,SharedFolderActivityLogger:h,ShareTibEventLogger:d,SharingExperimentsLogger:p,ShmodelUILogger:f,SupportExperimentsWebLogger:m,TeamsWebActionsLogger:g,UserActivityLogger:y,ViralLogger:w,WebMiscActivityLogger:b},INLINE_JS.ShmodelUILogger=f,x})}.call(this),function(){define("modules/clean/avatar/stacked_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/css","modules/core/user_i18n"],function(e,t,n,r,o,i){var s,a,l,u,c;return a=r.VALID_AVATAR_DIMENSIONS,u=e.DOM,c=e.PropTypes,l=e.createElement,s=e.createClass({displayName:"StackedAvatars",propTypes:{user_front:c.object.isRequired,user_back:c.object.isRequired,dimension:c.oneOf(a).isRequired,optionalClass:c.string,shape:c.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vfl-wEGDN.css")},render:function(){var e,r;return e="stacked-avatar-bottom",r="stacked-avatar-top",this.props.optionalClass&&(e+=" "+this.props.optionalClass,r+=" "+this.props.optionalClass),u.div({className:"stacked-avatars-section u-l-ib"},l(t,{dimension:this.props.dimension,photoUrl:this.props.user_back.avatar_url,optionalClass:e,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_back.display_name||this.props.user_back.email,initials:i.getInitials(this.props.user_back.display_name||this.props.user_back.email),shape:this.props.shape,optionalClass:e})}),l(t,{dimension:this.props.dimension,photoUrl:this.props.user_front.avatar_url,optionalClass:r,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_front.display_name||this.props.user_front.email,initials:i.getInitials(this.props.user_front.display_name||this.props.user_front.email),shape:this.props.shape,optionalClass:r})}))}})})}.call(this),function(){define("modules/clean/base64",[],function(){var e,t,n,r;return r=function(e){var t,n,r,o,i,s;for(s=[],i=0,t=0,n=0,r=0,o=0,e+="";i<e.length;)n=e.charCodeAt(i),128>n?(s[t++]=String.fromCharCode(n),i++):n>191&&224>n?(r=e.charCodeAt(i+1),s[t++]=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=e.charCodeAt(i+1),o=e.charCodeAt(i+2),s[t++]=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return s.join("")},t=function(e){var t,n,r,o,i,s,a,l,u,c,_,d,h,p;if(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=void 0,_=void 0,d=void 0,i=void 0,s=void 0,a=void 0,l=void 0,r=void 0,u=0,t=0,o="",p=[],!e)return e;for(;;)if(c=e.charCodeAt(u++),_=e.charCodeAt(u++),d=e.charCodeAt(u++),r=c<<16|_<<8|d,i=r>>18&63,s=r>>12&63,a=r>>6&63,l=63&r,p[t++]=n.charAt(i)+n.charAt(s)+n.charAt(a)+n.charAt(l),!(u<e.length))break;return o=p.join(""),h=e.length%3,(h?o.slice(0,h-3):o)+"===".slice(h||3)},e=function(e,t){var n,o,i,s,a,l,u,c,_,d,h,p,f,m,g;if(h=function(e){return e},a=t?h:r,"function"==typeof window.atob)return a(window.atob(e));if(o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,n=0,g=[],!e)return e;for(e+="";;)if(l=o.indexOf(e.charAt(d++)),u=o.indexOf(e.charAt(d++)),c=o.indexOf(e.charAt(d++)),_=o.indexOf(e.charAt(d++)),i=l<<18|u<<12|c<<6|_,p=i>>16&255,f=i>>8&255,m=255&i,64===c?g[n++]=String.fromCharCode(p):64===_?g[n++]=String.fromCharCode(p,f):g[n++]=String.fromCharCode(p,f,m),!(d<e.length))break;return s=g.join(""),s=a(s)},n={encode:t,decode:e}})}.call(this),function(){define("modules/clean/browse_events",[],function(){var e;return e={RENDER:"db:browse:render",BEFORE_UPDATE:"db:browse:before_update",UPDATE:"db:browse:update",NEW_PAGE:"db:browse:new_page",UPDATE_RENDERED:"db:browse:update_rendered",GA_RENDERED:"db:browse:ga_rendered"}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/captcha",["jquery","external/react","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/notify"],function(t,n,r,o,i){var s,a;return a=n.createElement,s=function(){function s(t,n,r,o,i,s){var a;this.parent_form=t,this.captcha_div=n,this.other_recaptcha_div=r,this.endpoint=o,this.email_name=i,this.variant=s,this.captcha_display_handler=e(this.captcha_display_handler,this),this._hide_other_captcha=e(this._hide_other_captcha,this),this._hide_captcha=e(this._hide_captcha,this),this._show_captcha=e(this._show_captcha,this),this.$recaptcha_container=null!=(a=this.parent_form.find(this.captcha_div))?a[0]:void 0,this.$recaptcha_react_component=null}return s.prototype._show_captcha=function(e,t){var r,i;return null==(null!=(i=this.$recaptcha_container)?i.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(r=a(o,{public_key:e,variant:this.variant,error:t}),this.$recaptcha_react_component=n.render(r,this.$recaptcha_container)):this.$recaptcha_react_component.reload(t)},s.prototype._hide_captcha=function(){var e;return null==(null!=(e=this.$recaptcha_container)?e.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component?(n.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null):void 0},s.prototype._hide_other_captcha=function(){var e;return e=t(this.other_recaptcha_div)[0],null!=(null!=e?e.children:void 0)?n.unmountComponentAtNode(e):void 0},s.prototype.captcha_display_handler=function(e){return r.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:function(t){return function(n){var r,o,s;try{return s=JSON.parse(n),s.needs_captcha?(t._hide_other_captcha(),t._show_captcha(s.recaptcha_public_key,e)):t._hide_captcha()}catch(e){return r=e,i.error(i.DEFAULT_ERROR)}}}(this)})},s}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/ajax_form",["jquery","modules/core/controller_helpers","modules/core/exception","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/validators/validators"],function(t,n,r,o,i,s,a){var l,u;return u=r.assert,l=function(){function r(t,r,o){this.$container=t,this.do_before_submitting=r,this._clear_pending=e(this._clear_pending,this),this._clear_errors=e(this._clear_errors,this),this._handle_errors=e(this._handle_errors,this),this._on_error=e(this._on_error,this),this._on_success=e(this._on_success,this),this._submit_form=e(this._submit_form,this),this._install_schema=e(this._install_schema,this),this.add_additional_data=e(this.add_additional_data,this),this.additional_data={},o=o||{},"FORM"===this.$container.prop("tagName")?this.$form=this.$container:this.$form=this.$container.find("form"),this.$form.submit(this._submit_form),this.$submit_button=this.$form.find("[type='submit']"),n.deprecated_set_controller(this.$form,this),this.schema={},this.should_validate=o.client_side_validation,this.should_submit_once=o.should_submit_once,this.error_handler="function"==typeof o.error_handler?o.error_handler:!1,this.should_validate&&this._fetch_schema()}return r.SUCCESS_EVENT="db:ajaxform:success",r.ERROR_EVENT="db:ajaxform:error",r.extract_errors=function(e){var t,n,r;if(0!==e.indexOf("err:"))return!1;e=e.substr(4);try{return r=JSON.parse(e)}catch(n){return t=n,"string"==typeof e?e:i.DEFAULT_ERROR}},r.clear_errors=function(e){return e.find(".input-error").removeClass("input-error"),e.find(".error-message").remove()},r.clear_error=function(e,t){var n;return n=e.find("input[name='"+t+"'], input[data-encrypted-name='"+t+"']"),n.removeClass("input-error"),e.find("[data-error-field-name='"+t+"']").prev(".error-message").remove()},r.fill_errors=function(e,n){var r,o,i,s;e.find(".c-card").addClass("u-l-dn"),i=[];for(o in n)s=n[o],r=t("<span>",{class:"error-message"}),s.message_html?r.html(s.message_html):r.text(s.message_text),r.insertBefore(e.find("[data-error-field-name='"+o+"']")),e.find("input[name='"+o+"'], input[data-encrypted-name='"+o+"']").addClass("input-error"),"failed-login-invalid-email-password"===o?i.push(e.find(".c-card").removeClass("u-l-dn")):i.push(void 0);return i},r.prototype.add_additional_data=function(e){return t.extend(this.additional_data,e)},r.prototype._install_schema=function(e){var n,r,o;try{o=JSON.parse(e)}catch(e){n=e}return t.each(o,function(e){return function(t,n){return n?e.schema[t]=a.create(n):void 0}}(this))},r.prototype._fetch_schema=function(){return s.ValidationSchemaRequest({url:this.$form.attr("action"),success:function(e){return function(t){return e._install_schema(t)}}(this)})},r.prototype.reset=function(){var e,n,r,o,i;for(o=this.$form.find("input"),i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(t(n).closest(".text-input").val(n.defaultValue));return i},r.prototype.set_input_value=function(e,t){return this.$form.find("input[name='"+e+"']").closest(".text-input").val(t)},r.prototype._get_form_data=function(){var e,n,r,o,i,s,a,l,c,_,d;for(e={},c=this.$form.find("input, select, textarea").not(":disabled").not(":radio"),n=0,s=c.length;s>n;n++)r=c[n],l=t(r).attr("name"),l&&(o=t(r).attr("type"),d="checkbox"===o?t(r).prop("checked")?"True":"":t(r).val(),"radio"!==o&&u(!(l in e),"found multiple inputs with the same name"),e[l]=d);for(_=this.$form.find("input:radio:checked:not(disabled)"),i=0,a=_.length;a>i;i++)r=_[i],l=t(r).attr("name"),e[l]=t(r).val();return e},r.prototype._validate=function(e){var n,r;return this.should_validate?(n={},r=!0,t.each(e,function(t){return function(o,i){var s,a;if(t.schema[o])try{return t.schema[o].validate(i,{field:o,data:e,errors:n})}catch(e){return s=e,r=!1,n[o]={message_text:s.message}}}}(this)),r?null:n):null},r.prototype._submit_form=function(e){var t;return e.preventDefault(),"function"==typeof this.do_before_submitting&&this.do_before_submitting(),this._clear_errors(),this.$form.prop("disabled",!0),this.$form.addClass("ajax-loading"),this.$submit_button.prop("disabled",!0),t=this._validate(this._get_form_data()),t?this._handle_errors(t):this.send_request()},r.prototype.send_request=function(){var e;return e=this._get_form_data(),t.extend(e,this.additional_data),s.FormWebRequest({url:this.$form.attr("action"),data:e,success:this._on_success,error:this._on_error,complete:this._on_complete,skipErrorHandling:!0})},r.prototype._on_success=function(e,t,n){var o,i,s,a,l;if(l=n.responseText,s=r.extract_errors(l),s!==!1)return void this._handle_errors(s);try{a=JSON.parse(l)}catch(e){return o=e,void this._on_error()}return this.$form.trigger(r.SUCCESS_EVENT,a),this._clear_pending(!this.should_submit_once)},r.prototype._on_error=function(){return this.$form.trigger(r.ERROR_EVENT),i.error(),this._clear_pending(!0)},r.prototype._handle_errors=function(e){if(this.error_handler)this.error_handler(e);else{if("string"==typeof e)return i.error(new o(e)),void this._clear_pending(!0);r.fill_errors(this.$form,e)}return this._clear_pending(!0),this.$form.trigger(r.ERROR_EVENT,e)},r.prototype._clear_errors=function(){return this.$form.find(".error-message").remove(),this.$form.find("input").removeClass("input-error")},r.prototype._clear_pending=function(e){return this.$form.removeClass("ajax-loading"),e?(this.$form.prop("disabled",!1),this.$submit_button.prop("disabled",!1)):void 0},r}()})}.call(this),function(){
define("modules/clean/components/animation",["jquery"],function(e){var t;return t=function(){function t(t){this.id=t.id,this.animationQueue=t.animationQueue,this.$el=e("#"+this.id),this.$strip=this.$el.find(".animator-strip"),this.implementationWidth=null,this.imageLoadCount=0,this.animationQueue=function(){return e.grep(arguments[0],function(e){return""!==e&&null!==e})}(this.animationQueue),this.imagesInit(),this.$strip.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd OAnimationEnd animationend",this.onAnimationEnd)}var n;return t.prototype.onAnimationEnd=function(t){return n(),e(this).removeClass("intro-animation").addClass("loop-animation"),!0},n=function(){var t,n,r;return t=e(".animator-poster").width(),n=e(".animator-frame--intro").width(),r=n-t,e(".animator-frame--intro").css("transform","translateX(-"+r+"px)")},t.prototype.setAnimationLoadClass=function(){var e;return this.imageLoadCount++,e="loop-animation",2===this.animationQueue.length&&(e="intro-animation"),this.imageLoadCount===this.animationQueue.length?this.$strip.addClass("loaded "+e):void 0},t.prototype.rescale=function(){var e,t;return this.implementationWidth||(this.implementationWidth=parseInt(this.$el.data("implementation-width"))),e=this.$el.parent().innerWidth(),e<this.implementationWidth?(t=e/this.implementationWidth,this.$el.css({transform:"scale("+t+") translateY(-"+10*t+"%)","-webkit-transform":"scale("+t+") translateY(-"+10*t+"%)","transform-origin":"bottom left"})):void 0},t.prototype.imagesInit=function(){var t,n;return n=this,t=this.$strip,this.$el.data("scale-down")===!0&&(e(window).resize(function(){return n.rescale()}),n.rescale()),t.find("img").each(function(t,r){return e(r).data("src")&&(e(r).on("load",function(){return n.setAnimationLoadClass()}),e(r).attr("src",e(r).data("src")),e(r).prop("complete"))?n.setAnimationLoadClass():void 0})},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/bubble_dropdown",["jquery","external/jquery_ui","external/underscore","modules/clean/keycode"],function(t,n,r,o){var i;return i=function(){function n(o,i,s,a,l,u,c){var _,d;this.$root=o,this.arrow_direction=i,this.show_on_hover=s,this.show_close_button=a,this.shown_by_default=l,this.top_adjustment=null!=u?u:0,this.tabindex=c,this._hide_bubble=e(this._hide_bubble,this),this._show_bubble=e(this._show_bubble,this),this._toggle_bubble=e(this._toggle_bubble,this),this._on_global_hover=e(this._on_global_hover,this),this._on_mouseout=e(this._on_mouseout,this),this._on_mouseover=e(this._on_mouseover,this),this._onDropdownKeydown=e(this._onDropdownKeydown,this),this._onTargetKeydown=e(this._onTargetKeydown,this),this._activateNonButton=e(this._activateNonButton,this),this.repositionDropdown=e(this.repositionDropdown,this),this.openDropdown=e(this.openDropdown,this),this.closeDropdown=e(this.closeDropdown,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$dropdown=this.$root.find(".bubble-dropdown"),this.$arrow_anchor=this.$root.find(".bubble-dropdown-arrow-anchor"),this.$arrow=this.$dropdown.find(".bubble-arrow"),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[this.arrow_direction],this.$target.on("keydown",this._onTargetKeydown),this.$dropdown.on("keydown",this._onDropdownKeydown),this.$target.attr("aria-expanded",!1),this.show_close_button?this.$root.find(".bubble-dropdown-x").on("click",this.closeDropdown):this.show_on_hover?(this.$target.on("mouseover",this._on_mouseover),this.$dropdown.on("mouseover",this._on_mouseover),this.$target.on("mouseout",this._on_mouseout),this.$dropdown.on("mouseout",this._on_mouseout),this.$target.attr("tabindex",0).on("focus",this._show_bubble),0===this.$dropdown.find(this._focus_selectors).length&&(_=r.uniqueId("bubble-dropdown-tooltip-"),this.$dropdown.attr({id:_,role:"tooltip"}),this.$target.attr("aria-describedby",_)),t(document).on(n.HOVER_SHOWN,this._on_global_hover)):(this.$target.click(this._toggle_bubble),d=0,this.tabindex&&(d=this.tabindex),"BUTTON"!==this.$target.get(0).tagName&&this.$target.attr({role:"button",tabindex:d}).on("keyup",this._activateNonButton),t("body").on("click",function(e){return function(n){var r;return t(n.target).is("select")?!0:(r=t(n.target).closest(e.$target).length||t(n.target).closest(e.$dropdown).length,r||e._hide_bubble(),!0)}}(this))),this.shown_by_default&&this.openDropdown()}return n.HOVER_SHOWN="bubble:hover:shown",n.prototype._dropdown_shown=!1,n.prototype._focus_selectors="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",n.prototype.closeDropdown=function(){return this._dropdown_shown?this._hide_bubble():void 0},n.prototype.openDropdown=function(){return this._dropdown_shown?void 0:this._show_bubble()},n.prototype.repositionDropdown=function(){return this._dropdown_shown?this._show_bubble():void 0},n.prototype._activateNonButton=function(e){var t;return(t=e.keyCode)===o.ENTER||t===o.SPACE?(this._toggle_bubble(),!1):void 0},n.prototype._onTargetKeydown=function(e){return(e.keyCode===o.ESC&&!this.show_on_hover||e.keyCode===o.TAB&&e.shiftKey||e.keyCode===o.TAB&&1===this.$root.find(this._focus_selectors).length)&&this._hide_bubble(),!0},n.prototype._onDropdownKeydown=function(e){var t;return this.show_on_hover||e.keyCode!==o.ESC?e.keyCode!==o.TAB||e.shiftKey||(t=this.$root.find(this._focus_selectors),e.target===t[t.length-1]&&this._hide_bubble(!this.show_on_hover)):this._hide_bubble(!0),!0},n.prototype._on_mouseover=function(){return t(document).trigger(n.HOVER_SHOWN,this.$target),this._show_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))},n.prototype._on_mouseout=function(){var e;return e=setTimeout(this._hide_bubble,200),this.$dropdown.data("timeout_id",e)},n.prototype._on_global_hover=function(e,t){return this._dropdown_shown&&t!==this.$target?(this._hide_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))):void 0},n.prototype._toggle_bubble=function(){return this._dropdown_shown?this._hide_bubble():this._show_bubble(),!0},n.prototype._show_bubble=function(){var e,t,n,r,o,i;if(!this.$target.hasClass("disabled")){switch(this.$dropdown.show(),i=this.$arrow.outerWidth(),t=this.$arrow.outerHeight()-this.top_adjustment,o=this.$arrow.position().top,n=this.$arrow.position().left,this.arrow_direction){case"left":e="left+"+i+"px top-"+o+"px";break;case"right":e="right-"+i+"px top-"+o+"px";break;case"top":e="left-"+n+"px top+"+t+"px";break;case"bottom":e="left-"+n+"px bottom-"+t+"px"}return r={my:e,at:this.target_position,of:this.$arrow_anchor.length?this.$arrow_anchor:this.$target,collision:"none"},this.$dropdown.position(r),this._dropdown_shown=!0,this.$target.addClass("bubble-dropdown-target--active").attr("aria-expanded",!0)}},n.prototype._hide_bubble=function(e){return this.$dropdown.hide(),this._dropdown_shown=!1,this.$target.removeClass("bubble-dropdown-target--active").attr("aria-expanded",!1),e?this.$target.focus():void 0},n}()})}.call(this),function(){define("modules/clean/components/expanding_section",["jquery","modules/clean/analytics"],function(e,t){var n;return n=function(){function n(t,n,r,o,i){this.$parent=e("#"+t),n&&(this.$scrollElement=e(""+n)),this.scrollElementOffset=r||0,this.expandingSectionAnalyticsId=o,this.defaultOffset=95,this.toggledState=!1,i?this.$toggleButton=e(i):this.$toggleButton=this.$parent.find(".expanding-section__button"),this.closeButton=this.$parent.find(".expanding-section__button-close"),this._setupClickHandlers()}return n.prototype._setupClickHandlers=function(){var e,t;return e=function(e){return function(t){return t.preventDefault(),e._scrollToSection(),e._expandSection(),e.expandingSectionAnalyticsId&&e._logAnalyticsTracking(),!0}}(this),t=function(e){return function(t){return t.preventDefault(),e._expandSection(),!0}}(this),this.$toggleButton.on("click",e),this.closeButton.length>0&&this.closeButton.on("click",t),!0},n.prototype._scrollToSection=function(){var t;return t=this.$parent.offset().top-this.scrollElementOffset-this.defaultOffset,this.$scrollElement&&(t=this.$parent.find(this.$scrollElement).offset().top-this.scrollElementOffset+"px"),this.toggledState||e("html, body").animate({scrollTop:t}),t},n.prototype._expandSection=function(){var e;return e=0,this.toggledState?(e=0,this.toggledState=!1):(e=this.$parent.find(".expanding-section__content-container").outerHeight(!0),this.toggledState=!0),this.$parent.find(".expanding-section__content").css("max-height",e),this.$toggleButton.blur().toggleClass("button-toggled"),this},n.prototype._logAnalyticsTracking=function(){t.TeamsWebActionsLogger.log(this.expandingSectionAnalyticsId)},n}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/components/input",["jquery","modules/clean/components/tabbable","modules/core/i18n","modules/core/exception","require"],function(n,r,o,i,s){var a,l,u,c,_,d,h;return _=o._,h=i.assert,d=function(e){var t;return t=n.data(e,"input-element"),h(t.length,"TextInput element has no related input element please ensure it was setup correctly"),t},n.valHooks.textinput={get:function(e){return d(e).val()},set:function(e,t){return d(e).val(t).trigger("input")}},c=function(r){function o(t){var r,i;this.$text_input=t,this._on_change=e(this._on_change,this),this.persistent_label=this.$text_input.is(".label-above"),this.$input=this.$text_input.find(".text-input-input"),this.$text_input.data("input-element",this.$input),this.$label=this.$text_input.find("label"),this.$text_input.find(".error-message").length&&this.$input.addClass("input-error"),this.$text_input.each(function(e,t){return t.type="textinput"}),this.$text_input.focus(function(e){return function(){return setTimeout(function(){return e.$input.focus()},0)}}(this)),i="BODY"===(null!=(r=document.activeElement)?r.tagName:void 0),i&&n(".autofocus:visible").first().focus(),this._listen(),this._on_change(),o.__super__.constructor.call(this)}return t(o,r),o.prototype._listen=function(){return this.$input.on("keydown keyup paste input blur",function(e){return function(){return e._on_change()}}(this)),this.$input.on("blur",function(e){return function(t){return e.$text_input.trigger(t)}}(this)),this.$input.on("focus",function(e){return function(){return e.$input.removeClass("input-error")}}(this))},o.prototype._on_change=function(){return this.persistent_label?void 0:this.$label.toggle(!this.$input.val())},o}(r),l=function(e){function n(e){this.$text_input=e,this.$caps=this.$text_input.find(".password-caps-indicator"),this.$caps_lock=!1,this.$text_input.on("keypress",function(e){return function(t){var n,r,o,i,s;return i=/Mac/.test(navigator.platform),r=null!=(s=t.charCode)?s:t.keyCode,n=String.fromCharCode(r),n.toLowerCase()===n.toUpperCase()?o=void 0:n===n.toLowerCase()?o=t.shiftKey:n!==n.toUpperCase()||t.shiftKey&&i||(o=!t.shiftKey),null!=o&&(e.$caps_lock=o),e.$caps_lock?e.$caps.addClass("password-caps-indicator-activated"):e.$caps.removeClass("password-caps-indicator-activated")}}(this)),n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(c),u=function(r){function o(t){this.$text_input=t,this._on_change=e(this._on_change,this),this.$bubble_title=this.$text_input.find(".password-bubble-title"),this.$bubble_desc=this.$text_input.find(".password-bubble-desc"),this.$meter=this.$text_input.find(".password-input-meter"),this.$default_bubble_text=this.$bubble_desc.text(),this.$last_pwd="",s(["external/zxcvbn"]),o.__super__.constructor.call(this,this.$text_input)}return t(o,r),o.prototype._on_change=function(){var e,t,n,r,i;return t=this.$input.val(),this.$last_pwd!==t?(this.$last_pwd=t,"correcthorsebatterystaple"===t||"Tr0ub4dour&3"===t||"Tr0ub4dor&3"===t?(n=0,r=_("lol",{comment:"'lol'='laugh out loud'"}),this.$bubble_title.text(r),"correcthorsebatterystaple"===t?(e=_("Whoa there, don't take advice from a webcomic too literally ;)",{comment:"This text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(e)):(e=_("Guess again",{comment:"this text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(e))):(i=["",_("Weak"),_("So-so"),_("Good"),_("Great!")],n=this._score(t),r=i[n],this.$bubble_title.text(r),this.$bubble_desc.text(this.$default_bubble_text)),this.$meter.find(".password-input-dot").removeClass("password-input-dot-selected"),this.$meter.find(".password-input-dot").slice(4-n,4).addClass("password-input-dot-selected"),o.__super__._on_change.apply(this,arguments)):void 0},o.prototype._get_user_inputs=function(){var e,t,r,o,i;for(r=["dropbox"],i=this.$text_input.closest("form").find("input[type=text], input[type=email]"),t=0,o=i.length;o>t;t++)e=i[t],r.push(n(e).val());return r},o.prototype._score=function(e){return window.zxcvbn&&e?Math.max(1,zxcvbn(e,this._get_user_inputs()).score):0},o}(l),a=function(n){function r(t){this.$text_input=t,this.crement=e(this.crement,this),r.__super__.constructor.call(this,this.$text_input),this.$text_input.find(".number-input-btn--up").on("click",function(e){return function(t){return e.crement(t,1)}}(this)),this.$text_input.find(".number-input-btn--down").on("click",function(e){return function(t){return e.crement(t,-1)}}(this)),this.min=this.$input.attr("min"),null!=this.min&&(this.min=parseInt(this.min)),this.max=this.$input.attr("max"),null!=this.max&&(this.max=parseInt(this.max))}return t(r,n),r.prototype.crement=function(e,t){var n;return n=parseInt(this.$text_input.val())+t,isNaN(n)||(null!=this.min&&n<this.min?this.$text_input.val(this.min):null!=this.max&&n>this.max?this.$text_input.val(this.max):this.$text_input.val(n)),this.$text_input.trigger("change")},r}(c),{TextInput:c,PasswordInput:l,PasswordWatchInput:u,NumberInput:a}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/login_form",["jquery","external/cyfd","external/u2f-api","modules/constants/login_and_register","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/gandalf_util","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/profile_services/third_party_signup","modules/clean/sso_login_checks","modules/clean/abuse/event_watcher","require"],function(t,n,r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v,y){var w,b,x,E,S;return E=a._,x=f.ProfileServicesLinkingHandler,b=m.PictureURLHandler,o.SPECTER_TELEMETRY_COLLECTION&&(S=v.getInstance(),S.start()),w=function(){function a(n,r,o,s,a,l){var c,h,p,f,m,v,w;this.multi_login=r,this.variant=o,null==s&&(s=!1),null==a&&(a=!0),this.inline_google_login_errors=null!=l?l:!1,this._finish_login=e(this._finish_login,this),this._fill_two_factor_error=e(this._fill_two_factor_error,this),this._fill_login_error=e(this._fill_login_error,this),this._login_via_email_start=e(this._login_via_email_start,this),this._sign_u2f_challenge=e(this._sign_u2f_challenge,this),this._retry_u2f_challenge=e(this._retry_u2f_challenge,this),this._use_phone_instead=e(this._use_phone_instead,this),this._resend_code=e(this._resend_code,this),this._resend_code_success=e(this._resend_code_success,this),this._switch_from_twofactor_to_login_error=e(this._switch_from_twofactor_to_login_error,this),this._two_factor_success=e(this._two_factor_success,this),this._login_success=e(this._login_success,this),this._show_two_factor=e(this._show_two_factor,this),this._setup_two_factor=e(this._setup_two_factor,this),this._show_login_via_email=e(this._show_login_via_email,this),this._show_login=e(this._show_login,this),this._hide_sso=e(this._hide_sso,this),this._show_sso=e(this._show_sso,this),this._before_submit=e(this._before_submit,this),this._handle_emails_do_not_match=e(this._handle_emails_do_not_match,this),this._google_login_callback=e(this._google_login_callback,this),this._google_login=e(this._google_login,this),this._set_focus_to_twofactor=e(this._set_focus_to_twofactor,this),this._set_focus_to_password=e(this._set_focus_to_password,this),this.$login_form=n.find(".login-form"),this.$google_auth_container=n.find(".login-form-container__google-div"),this.$all_two_factor_forms=n.find(".two-factor-form"),this.$two_factor_phone_form=n.find(".two-factor-form.2fa-phone-form"),this.$two_factor_seckey_form=n.find(".two-factor-form.2fa-seckey-form"),this.$login_via_email_link=n.find(".login-via-email-link"),this.$two_factor_form=this.$two_factor_phone_form,null!=(h=this.$login_form.find(".login-button"))&&h.prop("disabled",!1),null!=(p=this.$google_auth_container.find(".auth-google"))&&p.prop("disabled",!1),s||y(["modules/clean/unity/features/web_destiny_ui"],function(e){return function(t){return e.web_destiny_interface=new t(n),e.web_destiny_interface.maybe_show_web_destiny()}}(this)),this.login_controller=new d(this.$login_form,this._before_submit,{should_submit_once:!0}),this.$captcha_component=new _(this.$login_form,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant),this.$login_form.on(d.SUCCESS_EVENT,this._login_success),this.$login_form.on(d.ERROR_EVENT,function(e){return function(t,n){var r;return r=null!=n?n.recaptcha_response:void 0,e.$captcha_component.captcha_display_handler(r),e.$login_form.find(".login-via-email-blade-link").click(e._login_via_email_start)}}(this)),this.$login_form.is(":visible")&&this.$captcha_component.captcha_display_handler(),c=u.parse(this.$login_form.find("input[name='cont']").val()),c.fragment=window.location.hash.substr(1),this.cont=c.toString(),this.two_factor_phone_controller=new d(this.$two_factor_phone_form,function(){return null},{should_submit_once:!0}),this.two_factor_seckey_controller=new d(this.$two_factor_seckey_form,function(){return null},{should_submit_once:!0}),this.two_factor_controller=this.two_factor_phone_controller,this.$two_factor_phone_form.on(d.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_seckey_form.on(d.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_seckey_form.on(d.ERROR_EVENT,function(e){return function(t,n){return e.$two_factor_seckey_form.find(".two-factor-seckey-instructions .error-msg").text(n.u2f.message_text),e.$two_factor_seckey_form.find(".two-factor-seckey-instructions").toggle()}}(this)),this.$two_factor_phone_form.find(".resend-two-factor-code").click(this._resend_code),this.$two_factor_seckey_form.find(".two-factor-use-phone-instead").click(this._use_phone_instead),this.$two_factor_seckey_form.find(".two-factor-seckey-retry").click(this._retry_u2f_challenge),null!=(f=this.$login_via_email_link)&&f.click(this._login_via_email_start),null!=(m=this.$google_auth_container.find(".auth-google"))&&m.click(this._google_login),w=this.$two_factor_seckey_form.find("input[name='u2f_challenge']").val(),w&&this._sign_u2f_challenge(w),this.$login_form.find(".sso-optout a").click(function(e){return function(){return e._hide_sso(!0)}}(this)),this.$login_form.find(".login-button").attr("disabled",!1),null!=(v=this.$login_via_email_button)&&v.attr("disabled",!1),this.$login_form.find(".login-button.disabled-button").prop("disabled",!0),a&&(this.$forgot_link=n.find(".login-need-help a").click(function(e){return function(n){var r,o;return n.preventDefault(),o=t(n.target).attr("href"),r=encodeURIComponent(e.$login_form.find("input[name='login_email']").val()),i.redirect(o+"?email_from_login="+r)}}(this))),this._set_focus_to_password(),new g(this.$login_form.find("input[name='login_email']"),this._show_sso,this._hide_sso)}return a.LOGIN_SUCCESS="db:login:success",a.MULTI_LOGIN_SUCCESS="db:multilogin:success",a.prototype._set_focus_to_password=function(){if(this.$login_form.find("input[name='login_email']")[0].value)try{return this.$login_form.find("input[name='login_password']")[0].focus()}catch(e){}},a.prototype._set_focus_to_twofactor=function(){try{return this.$two_factor_form.find("input[name='code']").val("").focus()}catch(e){}},a.prototype._google_login=function(){var e,t;return d.clear_errors(this.$login_form),t="on"===this.$login_form.find("input[name='remember_me']").val(),e=new x,e.auth_service_login_user(p.GOOGLE,this._google_login_callback,"login_form",t)},a.prototype._google_login_callback=function(e){var t;return e.success?(l.success(E("Log in successful! Your browser will be redirected in a few seconds.")),t=function(e){return function(){return i.redirect(e.cont?e.cont:"/home")}}(this),e.should_update_account_photo?b.download_picture(e.profile.picture_url,function(n){return b.upload_account_picture(e.user_id,n,t)}):t()):"access_denied"===e.err_msg?l.error(E("You need to accept Googles request in order to log in.")):"emails_do_not_match"===e.err_msg?this.inline_google_login_errors?this._handle_emails_do_not_match(e):l.error(E("We couldnt find a Dropbox account matching that email.")):"google_login_not_allowed"===e.err_msg?(l.error(E("Google sign in isnt yet available to business customers.")),this.$login_form.find("input[name='login_email']").val(e.profile.email),this.$login_form.find("input[name='login_email']").trigger("input"),this._set_focus_to_password()):"tfa_required"===e.err_msg?i.redirect("/verify_code?remember_me="+e.remember_me):l.error(E("We couldnt log you in with Google.  Try again?"))},a.prototype._handle_emails_do_not_match=function(e){var t,n,r;return t="/third_party_signup",n={fname:e.profile.given_name,lname:e.profile.family_name,email:e.profile.email,picture_url:e.profile.picture_url,refresh_token:e.refresh_token,email_sig:e.email_sig},r=String(u({path:t,query:n})),this.$google_auth_container.find(".third-party-signup-link").attr("href",r),this.$google_auth_container.find(".google-login-error").removeClass("u-l-dn")},a.prototype._before_submit=function(){return n.cfsubmit(),o.SPECTER_TELEMETRY_COLLECTION?this.login_controller.add_additional_data({specter_login_tm:S.toJSON()}):void 0},a.prototype._show_sso=function(e){return this.$login_form.find("input[name='login_password']").val(""),this.$login_form.addClass("sso-required"),e?this.$login_form.addClass("sso-optional"):void 0},a.prototype._hide_sso=function(e){if(null==e&&(e=!1),this.$login_form.removeClass("sso-required sso-optional"),e)try{return this.$login_form.find("input[name='login_password']").focus()}catch(e){}},a.prototype._browser_supports_u2f=function(){return"undefined"!=typeof MessageChannel},a.prototype._show_login=function(){return this.$two_factor_form.hide(),t(".login-register-header, .login-register-switch").show(),this.$login_form.show(),this.$login_form.find("input[name='login_password']").val("")},a.prototype._show_login_via_email=function(){var e;return null!=(e=this.$login_via_email_container)?e.show():void 0},a.prototype._setup_two_factor=function(e){return e.u2f_challenge&&this._browser_supports_u2f()&&(this.$two_factor_form=this.$two_factor_seckey_form,this.two_factor_controller=this.two_factor_seckey_controller,this._sign_u2f_challenge(e.u2f_challenge)),e.last_four_digits?(this.$all_two_factor_forms.addClass("hide-authenticator"),this.$two_factor_phone_form.find(".last-four-digits").text(e.last_four_digits)):this.$all_two_factor_forms.addClass("hide-sms"),this.$two_factor_form.find("input[name='remember_me']").val(e.remember_me),this._show_two_factor()},a.prototype._show_two_factor=function(){return t(".login-register-header, .login-register-switch").hide(),this.$login_form.hide(),this.$two_factor_form.show(),this._set_focus_to_twofactor()},a.prototype._login_success=function(e,t){var n,r,o;switch(t.status){case"OK":return this._finish_login(t);case"TWOFACTOR":return this._setup_two_factor(t);case"TWOFACTOR_REQUIRED":return i.redirect(t.cont);case"LOGIN_VIA_EMAIL_REQUIRED":return n=t.email,o=u({path:t.cont}).updateQuery({email:n}),i.redirect(o);case"SSO":return i.unsafeRedirect(t.sso_url);case"RATELIMIT":return this._fill_login_error(E("You've tried to log in too many times. Please try again in a few minutes."));case"ERROR":return r=t.html_response?new s(t.message):t.message,l.error(r),this.login_controller._clear_pending(!0);case"EXPIRED":return i.redirect(t.cont);default:return l.error()}},a.prototype._two_factor_success=function(e,t){switch(t.status){case"OK":return this.$two_factor_seckey_form.find(".seckey-loading-status").toggle(),this._finish_login(t);case"EXPIRED":return this._switch_from_twofactor_to_login_error(t.message);case"REQUIRES_ROLE":return this._switch_from_twofactor_to_login_error(t.message);case"ERROR":return l.error(t.message);default:return l.error()}},a.prototype._switch_from_twofactor_to_login_error=function(e){return this.two_factor_controller._clear_pending(!0),this.login_controller._clear_pending(!0),this._show_login(),this._fill_login_error(e),this._set_focus_to_password()},a.prototype._resend_code_success=function(e){switch(e){case"OK":return l.success(E("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this._fill_two_factor_error(E("You've tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this._fill_two_factor_error(E("We couldn't reach your phone number. Are you sure it's correct?"));case"EXPIRED":return this._fill_two_factor_error(E("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this._fill_two_factor_error(E("Unfortunately, your carrier isnt supported at this time."));case"INVALIDNUMBER":return this._fill_two_factor_error(E("That isnt a valid phone number."));case"NOTAMOBILE":return this._fill_two_factor_error(E("That phone number doesnt appear to be a valid mobile number."));default:return l.error()}},a.prototype._resend_code=function(){var e;return c.WebRequest({url:"/twofactor_resend",data:{backup:(null!=(e=this.$two_factor_form.find("input[name='backup']"))?e.val():void 0)||!1},success:this._resend_code_success,error:function(){return l.error()}}),!1},a.prototype._use_phone_instead=function(){return this.$two_factor_seckey_form.hide(),this.$two_factor_phone_form.show(),this.$two_factor_form=this.$two_factor_phone_form,this.$two_factor_phone_form.hasClass("hide-authenticator")&&this._resend_code(),this._set_focus_to_twofactor(),!1},a.prototype._retry_u2f_challenge=function(){return c.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(e){return function(t){return e.$two_factor_seckey_form.find(".two-factor-seckey-instructions").toggle(),e._sign_u2f_challenge(t)}}(this),error:function(){return l.error()}}),!1},a.prototype._sign_u2f_challenge=function(e){var t;if(this._browser_supports_u2f())return t=JSON.parse(e),r.sign(t.authenticateRequests,function(e){return function(t){return e.$two_factor_seckey_form.find(".text-input-input").val(JSON.stringify(t)),e.$two_factor_seckey_form.submit()}}(this))},a.prototype._login_via_email_start=function(){return d.clear_errors(this.$login_form),c.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$login_form.find("input[name='login_email']").val(),remember_me:"on"===this.$login_form.find("input[name='remember_me']").val()},success:function(){return l.success(E("We emailed you a sign in link. Please check your inbox."))},error:function(e){return function(t,n,r){return d.fill_errors(e.$login_form,JSON.parse(r))}}(this)}),!1},a.prototype._fill_login_error=function(e){return d.fill_errors(this.$login_form,{login_email:{message_text:e}})},a.prototype._fill_two_factor_error=function(e){return d.fill_errors(this.$two_factor_form,{code:{message_text:e}})},a.prototype._finish_login=function(e){var t,n,r;return r=this.$login_form.find("input[type='hidden'][name=refresh_token]").val(),t=this.$login_form.find("input[type='hidden'][name=email_sig]").val(),r&&t&&c.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:e.id,data:{service:p.GOOGLE,refresh_token:r,email_sig:t}}),n=this.multi_login?a.MULTI_LOGIN_SUCCESS:a.LOGIN_SUCCESS,this.$login_form.trigger(n,e),this.cont?i.redirect(this.cont):void 0},a}(),__CONDITIONAL_JS__.LoginForm=w,w})}.call(this),function(){define("modules/clean/components/login_or_register",["jquery","modules/clean/register_form"],function(e,t){var n;return n=function(){function n(n){this.$login_form=n.find(".login-register-login-part"),this.$register_form=n.find(".login-register-register-part"),n.click(function(t){return function(n){return e(n.target).hasClass("login-register-switch-link")?(n.preventDefault(),t._toggle_forms(),t.$login_form.find(".text-input input:visible").first().focus(),t.$register_form.find(".text-input input:visible").first().focus()):void 0}}(this)),this.$register_form.on(t.USER_EXISTS,function(e){return function(t){var n,r,o;e._toggle_forms(),r=t.prefill;for(n in r)o=r[n],e.$login_form.find(n).val(o);return e.$login_form.find(t.focus).focus()}}(this))}return n.prototype._toggle_forms=function(){return this.$login_form.toggle(),this.$register_form.toggle()},n}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},n=function(e,t){function n(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},r={}.hasOwnProperty;define("modules/clean/components/role_picker",["external/underscore","modules/constants/viewer","modules/core/controller_helpers","modules/core/exception","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer"],function(r,o,i,s,a,l,u){var c,_,d,h,p,f,m,g;return _=o.ROLE_PERSONAL,d=o.ROLE_PHOTOS,h=o.ROLE_WORK,g=s.assert,f={ALL:"all",PERSONAL:_,WORK:h},p=function(){function n(n){var o,i,s,a,l,c;null==n&&(n={}),this._actually_set_state=e(this._actually_set_state,this),this._do_login=e(this._do_login,this),this.is_user_visible=e(this.is_user_visible,this),this.is_role_visible=e(this.is_role_visible,this),this.ensure_role_is_visible=e(this.ensure_role_is_visible,this),this.set_state=e(this.set_state,this),this.get_state=e(this.get_state,this),this._allow_merged_state=null!=n.allow_merged_state?n.allow_merged_state:!0,this._limit_to_role=null!=n.limit_to_role?n.limit_to_role:null,c=u.get_viewer(),i=c.is_role_signed_in(f.PERSONAL)&&c.is_role_signed_in(f.WORK),n.initial_state?(a=r.values(f),g((s=n.initial_state,t.call(a,s)>=0),"RolePicker requires initial_state to be one of: "+a),this.set_state(n.initial_state)):this._allow_merged_state&&i?this.set_state(f.ALL):(o=c.get_users(),g(o.length,"tried to use RolePicker on a page with no users"),l=o[0],this.set_state(l.role))}return n.prototype.get_state=function(){return this._state},n.prototype.set_state=function(e){var t,n,r,o;if(g(this._allow_merged_state||e!==f.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&g(e===f.ALL||e===this._limit_to_role),e===f.ALL){for(r=[_,h,d],t=0,n=r.length;n>t;t++)if(o=r[t],!u.get_viewer().is_role_signed_in(o))return void this._do_login(o,e)}else if(o=e,!u.get_viewer().is_role_signed_in(o))return void this._do_login(o,e);return this._actually_set_state(e)},n.prototype.update_picker_ui=function(){},n.prototype.ensure_role_is_visible=function(e){return this.is_role_visible(e)?void 0:this._allow_merged_state?this.set_state(f.ALL):this.set_state(e)},n.prototype.is_role_visible=function(e){return this._state===f.ALL||this._state===e},n.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},n.prototype._do_login=function(e,t){return a.show_modal({role:e,on_success:function(e){
return function(){return e._actually_set_state(t)}}(this)})},n.prototype._actually_set_state=function(e){return e!==this._state?(this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0):void 0},n}(),m=function(t){function r(t,n){this.$container=t,null==n&&(n={}),this.limit_to_role=e(this.limit_to_role,this),this.update_picker_ui=e(this.update_picker_ui,this),this.on_ui_change=e(this.on_ui_change,this),this.$bubble_picker=this.$container.find(".bubble-picker"),this.$bubble_picker.on("db:bubblepicker:changed",this.on_ui_change),r.__super__.constructor.call(this,n)}return n(r,t),r.prototype.on_ui_change=function(e,t){var n;return n=t.clicked_val,n!==this._state?(i.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(n)):void 0},r.prototype.update_picker_ui=function(){return i.get_controller(this.$bubble_picker).set_value(this._state)},r.prototype.limit_to_role=function(e,t){var n,r;if(null!=e){this.ensure_role_is_visible(e);for(n in f)r=f[n],r!==e&&r!==f.ALL&&i.get_controller(this.$bubble_picker).disable_option(r,t)}else for(n in f)r=f[n],i.get_controller(this.$bubble_picker).enable_option(r);return this._limit_to_role=e},r}(p),c=function(e){function t(e,n){null==n&&(n={}),n.allow_merged_state=!1,t.__super__.constructor.call(this,e,n)}return n(t,e),t.prototype.on_state_change=function(e){var t;return t=function(){switch(e){case f.PERSONAL:return _;case f.WORK:return h}}(),l.emit(t)},t}(m),{RolePickerState:f,RolePicker:p,RoleSelect:m,PageRoleSelect:c}})}.call(this),function(){define("modules/clean/components/tabbable",["jquery"],function(e){var t;return t=function(){function t(){t.initialized||this.listen()}return t.initialized=!1,t.prototype.listen=function(){return t.initialized=!0,e(document).on("keydown",function(t){return function(t){return 9===t.keyCode?e(document.body).addClass("tabbing"):void 0}}(this)),e(document).on("mousedown",function(t){return function(t){return e(document.body).removeClass("tabbing")}}(this))},t}()})}.call(this),function(){var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/components/tooltip",["jquery","modules/core/controller_helpers"],function(t,n){var r,o,i;return i=[],r=function(){function e(e,t,r){var o;this.$wrapper=e,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=t,this.tooltip_location=r,this.listen(),o=n.clone_element(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),this.tooltip.css({width:o.width()+1,position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body")}return e.prototype.tooltip_shown=!1,e.prototype.position_global=!1,e.prototype.listen=function(){var e,t,n,r,o;for(r=[this.hover_target,this.tooltip],o=[],t=0,n=r.length;n>t;t++)e=r[t],e.mouseenter(function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}}(this)),o.push(e.mouseleave(function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}}(this)));return o},e.prototype.find_hover_target=function(){return this.prompt},e.prototype.show_tooltip=function(e){var t,n,r,o,s,a,l;if(!this.tooltip_shown){for(s=this.position_global?this.hover_target.offset():this.hover_target.position(),n=0,o=i.length;o>n;n++)l=i[n],l.hide_tooltip();return i.push(this),"top"===this.tooltip_location?(a=s.top-this.tooltip.outerHeight()-this.hover_target.height()/2,r=s.left-this.tooltip.outerWidth()/2,t={top:"-=7"}):"left"===this.tooltip_location?(a=s.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=s.left-this.tooltip.outerWidth()-2,t={left:"-=7"}):(a=s.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=s.left+this.hover_target.width()+2,t={left:"+=7"}),this.tooltip.css({top:a,left:r}).show().animate(t,50),this.tooltip_shown=!0}},e.prototype.hide_tooltip=function(){var e;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,e=i.indexOf(this),-1!==e?i.splice(e,1):void 0},e}(),o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},n}(r),{DBTooltip:r,InfoTooltip:o}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(n){var r,o;return r=n.DBUserModal,o=function(n){function r(t,n,o){this.show_hidden_modal=n,this.link_with_facebook=o,this.on_confirm_button_click=e(this.on_confirm_button_click,this),this.on_hide=e(this.on_hide,this),r.__super__.constructor.call(this,t,{element_id:"facebook-confirm-modal-user-"+t.id})}return t(r,n),r.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},r.prototype.on_confirm_button_click=function(e){return this.hide(),this.link_with_facebook()},r}(r)})}.call(this),function(){define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,r,o,i){var s,a;return a=t.assert,s={do_auth:function(e,t){var r;return a(null!=t,"user_id must be specified"),r=window.open(n({path:"/fb/access_token"}).updateQuery(i.UID_PARAM_NAME,t).toString(),"fb_auth","width=600,height=450"),e?s.onLoginSuccessCallback=e:void 0},post:function(e,t,i,l,u,c,_){return a(null!=_,"user_id must be specified!"),o.get_viewer().is_signed_in?("function"==typeof s.custom_show_posting&&s.custom_show_posting(),new r.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:i,description:l,from_referrals:s.from_referrals,from_getspace:s.from_getspace,picture:u?u:""},success:function(n,r,o){var a;return a=o.responseText,0===a.indexOf("ok")?"function"==typeof s.custom_show_complete?s.custom_show_complete():void 0:0===a.indexOf("auth")?s.do_auth(function(){return s.post(e,t,i,l,u,c,_)},_):void 0},error:function(){return"function"==typeof c?c():void 0},subject_user:_})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:i}).toString())}}})}.call(this),function(){define("modules/clean/css",["jquery","external/rsvp","modules/clean/static_urls","modules/constants/env","modules/core/exception","modules/core/uri"],function(e,t,n,r,o,i){var s,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x;s=t.Promise,x=n.static_url,c=o.assert,_={"/static/css/packaged/components-vfloK3Thj.css":["/static/css/components/bubble_dropdown-vflbLryNB.css","/static/css/components/bubble_picker-vflN49sh3.css","/static/css/components/button-vflOGUEG3.css","/static/css/components/checkbox-vfl89WPlN.css","/static/css/components/column-headers-vflS11lNY.css","/static/css/components/input-vflu6Lzih.css","/static/css/components/input_helpers-vfl1B2M2Y.css","/static/css/components/list_menu-vfltM8jWK.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/components/locale_selector-vflRu24eh.css","/static/css/components/login_form-vfl7DVsqJ.css","/static/css/components/login_or_register-vflfxcikm.css","/static/css/components/phone_number-vfl7fjF60.css","/static/css/components/select_input-vflguVQ0B.css","/static/css/components/slider-vflbeTc0k.css","/static/css/components/sprite-div-vflfVxe3h.css","/static/css/components/tabs-vfl6DY_z1.css","/static/css/components/tooltip-vflH_372s.css"]},u={};for(y in _)for(h=_[y],p=0,m=h.length;m>p;p++)d=h[p],u[d]=y;for(l={},a={},b=e('link[rel="stylesheet"]'),f=0,g=b.length;g>f;f++)v=b[f],w=i.parse(e(v).attr("href")).path,r.IS_PROD||(w=w.replace(/-vfl[\w-]*/,"")),l[w]=s.resolve(),a[w]=!0;return{css_url:function(e){return'url("'+String(e).replace("\\","\\\\").replace('"','\\"')+'")'},require_css:function(e,t,n){var r,o;return c(0===e.indexOf("/static/css/"),"invalid static css path: "+e),r=u[e],null!=r&&(e=r),o=l[e],o||(o=l[e]=new s(function(t,n){var r;return r=document.createElement("link"),r.href=x(e),r.rel="stylesheet",r.type="text/css",r.crossorigin="anonymous",r.onload=function(){return a[e]=!0,t()},r.onerror=n,document.head.appendChild(r)})),o.then(t,n)},require_css_multi:function(e,t,n){var r;return r=e.map(function(e){return function(t){return e.require_css(t)}}(this)),s.all(r).then(t,n)},is_loaded:function(e){return e.every(function(e){return c(0===e.indexOf("/static/css/"),"invalid static css path: "+e),e in a})}}})}.call(this),function(){define("modules/clean/datetime",["modules/constants/viewer","modules/core/exception","modules/core/i18n"],function(e,t,n){var r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x,E,S,T,C;return d=t.assert,u=n._,C=n.ungettext,s=1e3,i=60*s,o=60*i,r=24*o,a=7*r,l=365*r,E=[u("January"),u("February"),u("March"),u("April"),u("May"),u("June"),u("July"),u("August"),u("September"),u("October"),u("November"),u("December")],c=[u("Jan"),u("Feb"),u("Mar"),u("Apr"),u("May"),u("Jun"),u("Jul"),u("Aug"),u("Sep"),u("Oct"),u("Nov"),u("Dec")],x=function(e,t){return t?c[e]:E[e]},m=function(e,t){var n;return n=[u("AM"),u("PM")],t.replace(/'[^']*'|y+|M+|d+|h+|k+|K+|H+|m+|s+|S+|a+/g,function(t){var r;switch(t[0]){case"'":return 2===t.length?"'":t.slice(1,-1);case"y":if("yy"===t)return e.getYear()%100;r=e.getFullYear();break;case"M":if(t.length>=3)return x(e.getMonth(),3===t.length);r=e.getMonth()+1;break;case"d":r=e.getDate();break;case"h":r=e.getHours()%12||12;break;case"k":r=e.getHours()%12+1;break;case"K":r=e.getHours()%12;break;case"H":r=e.getHours();break;case"m":r=e.getMinutes();break;case"s":r=e.getSeconds();break;case"S":r=e.getMilliseconds();break;case"a":return n[1*(e.getHours()>=12)]}return r=""+r,r.length<t.length&&(r=("00000000"+r).slice(-1*t.length)),r})},g=function(e,t){var n;return n=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),m(n,t)},v=function(e){var t,n,r,o,i,s,a;for(s=[86400,3600,60,1],e=isNaN(e)?0:e,t=n=0,r=s.length;r>n;t=++n)if(i=s[t],e>=i){a=parseInt(e/i,10)||0;break}return 1>e&&(a=0),t>=3?o=C("%d sec","%d secs",a).format(a):2===t?o=C("%d min","%d mins",a).format(a):1===t?o=C("%d hour","%d hours",a).format(a):0===t?o=C("%d day","%d days",a).format(a):d(!1,"Invalid time"),o},f=function(e){var t,n,r;return n=Math.floor(e),0>n&&(n=0),t=function(e){return 10>e?"0"+e:e.toString()},r=":"+t(n%60),n=Math.floor(n/60),r=t(n%60)+r,n=Math.floor(n/60),n>0&&(r=""+n.toString()+":"+r),r},b=function(e,t){return u("%(month)s %(year)s",{comment:"Like Jun 2012"}).format({month:x(e,!0),year:t})},S=function(e,t,n,r){var o,i,s,a;return null==n&&(n=!1),null==r&&(r=!1),n?(o=e.getUTCDate(),i=e.getUTCMonth(),a=e.getUTCFullYear()):(o=e.getDate(),i=e.getMonth(),a=e.getFullYear()),s=x(i,!r),t?u("%(month)s %(date)s, %(year)s",{comment:"Like Jan 15, 2014"}).format({month:s,date:o,year:a}):u("%(month)s %(date)s",{comment:"Like Jan 15"}).format({month:s,date:o})},_=function(e,t){var n,s,c,_,d,h,p;return null==t&&(t=!0),s=Date.now()-Number(e),i>s?u(t?"Just now":"just now"):o>s?(_=Math.floor(s/i),C("%d min ago","%d mins ago",_).format(_)):r>s?(c=Math.floor(s/o),C("%d hour ago","%d hours ago",c).format(c)):30*r>s?(n=Math.floor(s/r),C("%d day ago","%d days ago",n).format(n)):56*r>s?(h=Math.floor(s/a),C("%d week ago","%d weeks ago",h).format(h)):l>s?(d=Math.floor(s/(30*r)),d=Math.max(2,d),d=Math.min(11,d),C("%d month ago","%d months ago",d).format(d)):(p=Math.floor(s/l),C("%d year ago","%d years ago",p).format(p))},y=function(e){var t,n,r,o,s,a;return r=Date.now(),n=r-Number(e),t=new Date(e),r=new Date(r),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()-1),o=m(t,"h:mm a"),i>n?u("just now",{comment:"Like 'You edited just now'"}):e>Number(s)?u("today at %(time)s",{comment:"Like 'You edited today at 3:00 PM'"}).format({time:o}):e>Number(a)?u("yesterday at %(time)s",{comment:"Like 'You edited yesterday at 3:00 PM'"}).format({time:o}):(t=t.getFullYear()===r.getFullYear()?S(t,!1,!1,!0):S(t,!0,!1,!0),u("on %(date)s",{comment:"Like 'You edited on August 20, 2015"}).format({date:t}))},w=function(e,t,n,r,o,i){return null==t&&(t=0),null==n&&(n=0),null==r&&(r=0),null==o&&(o=0),null==i&&(i=0),e.setFullYear(e.getFullYear()+t),e.setMonth(e.getMonth()+n),e.setDate(e.getDate()+r),e.setHours(e.getHours()+o),e.setMinutes(e.getMinutes()+i),e},T=function(){return(new Date).getTime()},h=function(e){var t,n,r,o;return t=new Date,t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),w(t,o=0,r=0,n=e)},p={abbr_month_names:c,ago:_,daysAfterToday:h,format_date:m,format_date_utc:g,format_time:v,formatAudioTime:f,getActingTime:y,increment_date:w,localized_date_format:e.date_format,localized_datetime_format:e.datetime_format,localized_time_format:e.time_format,month_abbr_with_year:b,month_name:x,month_names:E,nice_date_with_month_name:S,time:T}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};define("modules/clean/dbmodal",["jquery","external/jquery_ui","external/keymaster","modules/core/browser","modules/core/controller_helpers","modules/core/dom","modules/core/exception","modules/clean/viewer","modules/constants/viewer"],function(r,o,i,s,a,l,u,c,_){var d,h,p,f;return f=u.assert,h=function(){function e(){}return e.__stack=[],e.CLEAR="dbmodal:clear",e.pop=function(t){var n;return null==t&&(t=null),null!=t?e.remove(t):t=e.__stack.pop(),null!=t&&t._hide(),n=e.top(),null!=n?n._show():r(document).trigger(e.CLEAR)},e.push=function(t){var n;return f(t instanceof d,"must pass in valid DBModal"),e.remove(t),n=e.top(),(null!=n?n.visible:void 0)&&n._hide(),e.__stack.push(t),t._show()},e.top=function(){var t;return t=e.__stack.length,t?e.__stack[t-1]:null},e.remove=function(t){var n,r,o,i,s;for(i=[],s=e.__stack,n=0,r=s.length;r>n;n++)o=s[n],o!==t&&i.push(o);e.__stack=i},e.clear=function(){var t,n,o,i;for(t=n=i=e.__stack.length-1;n>=0;t=n+=-1)o=e.__stack[t],o.visible&&o._hide();return r(document).trigger(e.CLEAR),e.__stack=[]},e.register=function(t,n){return r(document).on(t,n),r(document).on(e.CLEAR,function(){return r(document).off(t,n)})},e.unregister=function(e,t){return r(document).off(e,t)},e.trigger=function(e,t){return r(document).trigger(e,t)},e}(),d=function(){function n(t){var r;this.options=t,this.set_title=e(this.set_title,this),this._hide=e(this._hide,this),this._show=e(this._show,this),this.hide=e(this.hide,this),this.show=e(this.show,this),this.__prefill=e(this.__prefill,this),this.__focus=e(this.__focus,this),this.__unlisten=e(this.__unlisten,this),this.__listen_buttons=e(this.__listen_buttons,this),this.__listen=e(this.__listen,this),this.__overlay_click_handler=e(this.__overlay_click_handler,this),this.__keydown_handler=e(this.__keydown_handler,this),this.__x_click_handler=e(this.__x_click_handler,this),this.__show_modal=e(this.__show_modal,this),this.__clone_modal=e(this.__clone_modal,this),this.format=e(this.format,this),this.on_cancel_button_click=e(this.on_cancel_button_click,this),this.on_confirm_button_click=e(this.on_confirm_button_click,this),this.before_show=e(this.before_show,this),this.element_id=n.add_role_to_id(this.options.element_id,this.options.role),this.$template=n.get_template(this.options.element_id),r=this.$template.find(".db-modal"),0===this.$template.length&&(window.DB_FRAME_BUST?f(!1,"Missing DBModal element '"+this.element_id+"', probably because this page is being framed by "+window.top.location.host+" and our frame protection has kicked in."):f(!1,"Missing DBModal pyxl element for '"+this.element_id+"'")),this.options.focus&&("confirm"===this.options.focus?f(r.find(".confirm-button").length,"DBModal pyxl element is missing a confirm button to focus"):"cancel"===this.options.focus?f(r.find(".cancel-button").length,"DBModal pyxl element is missing a cancel button to focus"):f(r.find(this.options.focus).length,"DBModal pyxl element is missing focus element with selector '"+this.options.focus+"'")),null!=this.on_show&&f("function"==typeof this.on_show,"'on_show' must be a function"),null!=this.before_show&&f("function"==typeof this.before_show,"'before_show' must be a function"),null!=this.on_hide&&f("function"==typeof this.on_hide,"'on_hide' must be a function"),null!=this.on_confirm_button_click&&f("function"==typeof this.on_confirm_button_click,"'on_confirm_button_click' must be a function"),null!=this.on_cancel_button_click&&f("function"==typeof this.on_cancel_button_click,"'on_cancel_button_click' must be a function"),this.options.vars&&(this.vars=this.options.vars),this.click_out_to_close=!0,this.options.click_out_to_close===!1&&(this.click_out_to_close=!1),this.prev_key_scope=null}return n.KEY_SCOPE="dbmodal",n.__stack=[],n.__DOUBLE_CLICK_MAX_TIME=300,n.get_containing_modal=function(e){var t,r;return r=e.closest(".db-modal-wrapper"),t=a.get_controller(r),t&&f(t instanceof n,"controller of .db-modal-wrapper must be a DBModal object"),t},n.prototype.before_show=function(e){return null!=this.options.title?this.set_title(this.options.title):void 0},n.prototype.on_confirm_button_click=function(e){return e.preventDefault(),h.pop()},n.prototype.on_cancel_button_click=function(e){return e.preventDefault(),h.pop()},n.prototype.on_show=null,n.prototype.on_hide=null,n.prototype.format=function(e){var n,r;for(n in e)t.call(e,n)&&(r=e[n],this.$modal_window.find(n).text(r));return this},n.prototype.__clone_modal=function(){return this.$modal_window||(this.options.preloaded?(this.$modal_window=r("#"+this.element_id),this.$modal_window.removeClass("db-modal-wrapper--preloaded")):this.$modal_window=a.clone_element(this.$template).attr("id",this.element_id),this.$overlay=this.$modal_window.find(".db-modal-overlay")),a.deprecated_set_controller(this.$modal_window,this),a.bind_controllers(this.$modal_window),this.options.preloaded?void 0:r("body").prepend(this.$modal_window)},n.prototype.__show_modal=function(){return this.$modal_window.show()},n.prototype.__x_click_handler=function(e){return e.preventDefault(),h.clear()},n.prototype.__keydown_handler=function(e){return(27===e.keyCode||8===e.keyCode&&!l.focus_in_input())&&(e.preventDefault(),"function"==typeof this.logger_keydown_close_handler&&this.logger_keydown_close_handler(),h.clear()),l.keepFocusIn(this.$modal_window.find(".db-modal"),e)},n.prototype.__overlay_click_handler=function(e){return e.preventDefault(),this.__last_show_time&&Date.now()<this.__last_show_time+this.constructor.__DOUBLE_CLICK_MAX_TIME?void 0:h.clear()},n.prototype.__listen=function(){return this.click_out_to_close!==!1&&this.$overlay.on("click",this.__overlay_click_handler),this.$db_modal_x=this.$modal_window.find(".db-modal-x"),this.$db_modal_x.on("click",this.__x_click_handler),r(document).on("keydown",this.__keydown_handler),this.__listen_buttons()},n.prototype.__listen_buttons=function(){return null!=this.on_confirm_button_click&&(this.$confirm_button=this.$modal_window.find(".confirm-button"),this.$confirm_button.on("click",this.on_confirm_button_click)),null!=this.on_cancel_button_click?(this.$cancel_button=this.$modal_window.find(".cancel-button"),this.$cancel_button.on("click",this.on_cancel_button_click)):void 0},n.prototype.__unlisten=function(){return this.click_out_to_close!==!1&&this.$overlay.off("click"),this.$db_modal_x.off("click"),r(document).off("keydown",this.__keydown_handler),null!=this.on_confirm_button_click&&this.$confirm_button.off("click"),null!=this.on_cancel_button_click?this.$cancel_button.off("click"):void 0},n.prototype.__focus=function(){var e,t;return e=this.$modal_window.find(".db-modal"),"confirm"===this.options.focus?this.focus_element=e.find(".confirm-button").first():"cancel"===this.options.focus?this.focus_element=e.find(".cancel-button").first():this.options.focus?this.focus_element=e.find(this.options.focus).first():(this.focus_element=e,t=l.getTabbableElementsIn(e),t.length&&(t.length>1&&r(t[0]).is(".db-modal-x")?this.focus_element=t[1]:this.focus_element=t[0])),this.focus_element.focus()},n.prototype.__prefill=function(){var e,t,n,r,o;if(null!=this.options.prefill){t=this.$modal_window.find(".db-modal"),r=this.options.prefill;for(n in r)o=r[n],e=t.find(n).val(o),f(e,"Element with name '"+n+"' not found")}},n.add_role_to_id=function(e,t){return t?e+"-"+t:e},n.get_template=function(e,t){var o;return o=n.add_role_to_id(e,t),r("#db-modal-"+o)},n.prototype.show=function(e,t){return null==e&&(e=null),null==t&&(t=null),null!=e&&(this.options.focus=e),null!=t&&(this.options.prefill=t),h.push(this)},n.prototype.hide=function(){return this!==h.top()?(h.remove(this),this._hide()):h.pop()},n.prototype._show=function(){return this.visible?void 0:(this.__last_show_time=Date.now(),this.__clone_modal(),"function"==typeof this.before_show&&this.before_show(this.$modal_window),this.__show_modal(),this.__listen(),this.visible=!0,window.key.getScope()!==this.constructor.KEY_SCOPE&&(this.prev_key_scope=window.key.getScope()),window.key.setScope(this.constructor.KEY_SCOPE),r(document).trigger("modalOpened",[1]),l.scroll_lock_document(),"function"==typeof this.on_show&&this.on_show(),this.__prefill(),this.__focus(),this)},n.prototype._hide=function(){return this.visible?(this.__unlisten(),window.key.setScope(this.prev_key_scope),this.$modal_window.remove(),this.visible=!1,this.prev_key_scope=null,r(document).trigger("modalClosed",[1]),l.scroll_unlock_document(),"function"==typeof this.on_hide&&this.on_hide(),this):void 0},n.prototype.set_title=function(e){return this.$modal_window.find(".db-modal-title-text").text(e),this},n}(),p=function(t){function o(t,n){this.user=t,this.__inject_basic_user_properties=e(this.__inject_basic_user_properties,this),this.before_show=e(this.before_show,this),o.__super__.constructor.call(this,n)}return n(o,t),o.prototype.before_show=function(e){return o.__super__.before_show.call(this,e),this.__inject_basic_user_properties(e)},o.prototype.__inject_basic_user_properties=function(e){var t,n;return t=e.find("form"),t.find("input[name='"+_.UID_PARAM_NAME+"']").remove(),n=r('<input type="hidden">').attr({name:_.UID_PARAM_NAME,value:this.user.id}),t.append(n),e.find(".dbmodal-email-placeholder").text(this.user.email)},o}(d),__CONDITIONAL_JS__.DBModalStack=INLINE_JS.DBModalStack=h,{DBModalStack:h,DBModal:d,DBUserModal:p}})}.call(this),function(){define("modules/clean/devtools/perf_hub_action_types",[],function(){var e;return e={},e.ActionTypes={PROFILED_AJAX_LOAD_FINISHED:"PROFILED_AJAX_LOAD_FINISHED",WEB_TIMING_FETCHED:"WEB_TIMING_FETCHED"},e})}.call(this),function(){define("modules/clean/devtools/perf_hub_actions",["modules/clean/flux/dispatcher","modules/clean/devtools/perf_hub_action_types"],function(e,t){var n,r;return n=t.ActionTypes,new(r=function(){function t(){}return t.prototype.add_ajax_profile=function(t){var r,o;return o=t.xhr,r=t.url,e.dispatch({type:n.PROFILED_AJAX_LOAD_FINISHED,data:{xhr:o,url:r}})},t.prototype.add_web_timing_details=function(t){var r;return r=t.details,e.dispatch({type:n.WEB_TIMING_FETCHED,data:{details:r}})},t}())})}.call(this),function(){define("modules/clean/em_string",[],function(){var e;return e=function(){function e(t){return this instanceof e?(this.s=t,this.info=this.widthInfo(),void(this.length=t.length?this.info[this.s.length-1]:0)):new e(t)}return e.em_snippet=function(t,n,r){return null==n&&(n=50),null==r&&(r=.75),new e(t.toString()).snippet(n,r).toString()},e.prototype.widthInfo=function(){var e,t,n,r;for(n={},n[-1]=0,e=t=0,r=this.s.length;r>=0?r>t:t>r;e=r>=0?++t:--t)n[e]=n[e-1]+this.ems(this.s.charAt(e));return n},e.prototype.findSpot=function(e){var t,n,r,o;if(!e)return 0;for(o=0,n=this.s.length;n>=o;)if(r=Math.floor(o/2+n/2),t=this.info[r-1],t>e)n=r-1;else{if(!(e>t))return r;o=r+1}return o>r?o:r},e.prototype.ems=function(t){var n,r,o,i,s;return r=.65,n=1.08,o=.58,i=t.charCodeAt(0),s=e.CODEPOINT_TO_WIDTH[i],s?s/Math.pow(10,e.ACCURACY):i>=768&&879>=i?0:i>=65377&&65500>=i?o:i>=11904&&40911>=i||i>=44032&&55215>=i||i>=4352&&4607>=i||i>=63744&&64255>=i||i>=65280&&65535>=i||i>=131072&&196607>=i?n:r},e.prototype.substr=function(t,n){var r,o;return o=this.findSpot(t),null!=n?(r=this.findSpot(t+n),new e(this.s.substr(o,r-o))):new e(this.s.substr(o))},e.prototype.toString=function(){return this.s},e.prototype.snippet=function(t,n){var r,o,i,s,a;return null==t&&(t=50),null==n&&(n=.75),this.length<=t?this:(t-=e._ELLIPSIS_LENGTH,r=t*n,s=t-r,a=this.length-s,i=this.substr(0,r),o=this.substr(a),new e(i.toString()+""+o.toString()))},e.ACCURACY=2,e.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1e3:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,2026:67,19977:108,65403:58},e._ELLIPSIS_LENGTH=new e("").length,e}()})}.call(this),function(){define("modules/clean/event_load",[],function(){var e,t,n;return e=function(e){return window.setTimeout(function(){return e.apply(e)},0)},n=function(t){return"complete"===document.readyState?e(t):null!=window.attachEvent?window.attachEvent("onload",t):null!=window.addEventListener?window.addEventListener("load",t,!1):void 0;
},t={window_load:n}})}.call(this),function(){define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,n,r,o,i,s,a,l){var u,c,_;return _=r._,c=s.SupportExperimentsWebLogger,u={configureAllLinks:function(t,n,r,o,i){return null==r&&(r=null),null==o&&(o=void 0),null==i&&(i=void 0),e(t).on("click",n,function(t){var n,s,l,d,h,p;return null!=r&&c.log_file_restore(r),n=e(t.target),p=n.data("user-id"),l=n.data("ns-id"),s=n.data("cs-id"),d=n.data("redirect"),null==d&&(d=!0),h=o?n.data("sjids"):null,a.SimpleModal.show({title_text:_("Undo this deletion"),body_html:_("Are you sure you want to undo this deletion?"),confirm_text:_("Undo deletion"),confirm_callback:function(){return u.rollback(p,l,s,d,i,h,o)},cancel_text:_("Cancel")}),!1})},configureLink:function(t,r,o,i,s,l){return e(t).on("click",function(e){return e.stopPropagation(),a.SimpleModal.show({title_text:r,body_html:n.escape(o).toHTML(),confirm_text:_("Restore"),confirm_callback:function(){return u.rollback(i,s,l)},cancel_text:_("Cancel")}),!1})},rollback:function(e,n,r,s,a,u,c){var d;return null==a&&(a=void 0),null==u&&(u=null),null==c&&(c=!1),d={},c?(d[n]=u,l.WebProgressRequest({url:"/cmd/restore_sjids",data:{ns_to_sjids:JSON.stringify(d)},subject_user:e,html_in_error_msg:!0,progress_text:_("Restoring files..."),success:function(){return o.success(_("Finished restoring files.")),"function"==typeof a&&a(),s?t.redirect(i({path:"/browse_cs/"+e+"/"+n+"/"+r})):void 0}})):(d[n]=r,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(d)},subject_user:e,html_in_error_msg:!0,progress_text:_("Restoring files..."),success:function(){return o.success(_("Finished restoring files.")),"function"==typeof a&&a(),s?t.redirect(i({path:"/browse_cs/"+e+"/"+n+"/"+r})):void 0}}))}}})}.call(this),function(){define("modules/clean/filepath",["modules/core/i18n"],function(e){var t,n,r,o,i,s,a,l,u,c,_,d,h,p,f,m;return r=e._,h=function(e){return e?("/"!==e.charAt(0)&&(e="/"+e),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""},f=function(e,t){return h(e).toLowerCase()===h(t).toLowerCase()},u=function(e,t){return e=h(e),e=e.split("/"),u=e.pop(),""===u?t||r("Dropbox"):u},c=function(e){return-1===e.indexOf(".")?e:e.split(".").slice(0,-1).join(".")},s=function(e,t){var n;return null==t&&(t=!1),n=e.split(".").pop(),t&&n===e?"":n},a=function(e){return-1===e.indexOf(".")?"":s(e).toLowerCase()},t={_other:"page_white",log:"page_white",msg:"page_white",sln:"page_white",vcproj:"page_white",txt:"page_white_text",wps:"page_white_text",doc:"page_white_word",docx:"page_white_word",docm:"page_white_word",rtf:"page_white_word",pages:"page_white_word",wpd:"page_white_word",odt:"page_white_word",pdf:"page_white_acrobat",eps:"page_white_acrobat",xls:"page_white_excel",xlsm:"page_white_excel",xlsx:"page_white_excel",xlsb:"page_white_excel",ods:"page_white_excel",csv:"page_white_excel",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",pptm:"page_white_powerpoint",pps:"page_white_powerpoint",ppsx:"page_white_powerpoint",ppsm:"page_white_powerpoint",odp:"page_white_powerpoint",key:"page_white_keynote",css:"page_white_code",html:"page_white_code",htm:"page_white_code",xml:"page_white_code",php:"page_white_code",c:"page_white_code",h:"page_white_code",rb:"page_white_code",cpp:"page_white_code",java:"page_white_code",js:"page_white_code",json:"page_white_code",cs:"page_white_code",py:"page_white_code",pl:"page_white_code",exe:"page_white_gear",dll:"page_white_gear",app:"page_white_gear",mp3:"page_white_sound",m3u:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aif:"page_white_sound",iff:"page_white_sound",mid:"page_white_sound",mpa:"page_white_sound",ra:"page_white_sound",aiff:"page_white_sound",amr:"page_white_sound",ogg:"page_white_sound","3ga":"page_white_sound",aac:"page_white_sound",oga:"page_white_sound",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture","3fr":"page_white_picture",ari:"page_white_picture",arw:"page_white_picture",srf:"page_white_picture",sr2:"page_white_picture",bay:"page_white_picture",crw:"page_white_picture",cr2:"page_white_picture",cap:"page_white_picture",eip:"page_white_picture",dcs:"page_white_picture",dcr:"page_white_picture",drf:"page_white_picture",k25:"page_white_picture",kdc:"page_white_picture",dng:"page_white_picture",erf:"page_white_picture",fff:"page_white_picture",iiq:"page_white_picture",mef:"page_white_picture",mos:"page_white_picture",mrw:"page_white_picture",nef:"page_white_picture",nrw:"page_white_picture",orf:"page_white_picture",pef:"page_white_picture",ptx:"page_white_picture",pxn:"page_white_picture",r3d:"page_white_picture",raf:"page_white_picture",rw2:"page_white_picture",raw:"page_white_picture",rwl:"page_white_picture",rwz:"page_white_picture",obm:"page_white_picture",srw:"page_white_picture",x3f:"page_white_picture",svg:"page_white_picture",avi:"page_white_film",mov:"page_white_film",mp4:"page_white_film",mkv:"page_white_film",wmv:"page_white_film",mpg:"page_white_film","3gp":"page_white_film","3gpp":"page_white_film",m4v:"page_white_film",vob:"page_white_film",ogv:"page_white_film",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",tgz:"page_white_compressed",bz2:"page_white_compressed",iso:"page_white_dvd",dmg:"page_white_dvd",ai:"page_white_vector",psd:"page_white_paint",au:"page_white_sound",fla:"page_white_flash",swf:"page_white_flash",url:"page_white_linkfile",webloc:"page_white_linkfile",website:"page_white_linkfile"},n={SMALL:"SMALL",LARGE:"LARGE"},m=function(e,t){switch(null==t&&(t=n.SMALL),t){case n.LARGE:return e+"_32";default:return e}},i=function(e,n){var r,o;return o=(null!=n?n:{}).size,r=t[e]||"page_white",m(r,o)},l=function(e,t){var n,r;return r=(null!=t?t:{}).size,n=s(e).toLowerCase(),i(n,{size:r})},p=function(e){var t;return t=e.split("/").slice(0,-1).join("/"),t||"/"},d=function(e,t){var n;return n=_({isInTeamFolderTree:e,hasGoldenGateIconography:t}),"s_web_"+n},_=function(e){var t,r,o,i,s,a,l,u,c,_,d,h,p,f,g,v,y,w;return c=null!=e?e:{},s=null!=(_=c.isShared)?_:!1,o=null!=(d=c.isDeleted)?d:!1,a=null!=(h=c.isTeamFolder)?h:!1,i=null!=(p=c.isInTeamFolderTree)?p:!1,l=null!=(f=c.isViewOnly)?f:!1,r=null!=(g=c.hasGoldenGateIconography)?g:!1,w=null!=(v=c.size)?v:n.LARGE,y=a?"_team":s||i&&r?"_user":"",u=l&&""!==y?"_locked":"",t=o?"_gray":"",m("folder"+y+u+t,w)},o={ICON_SIZES:n,paths_are_equal:f,filename:u,file_extension:s,filename_without_extension:c,file_extension_for_logging:a,file_icon:l,folder_icon:_,extension_icon:i,new_folder_icon:d,normalize:h,parent_dir:p}})}.call(this),function(){"use strict";var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/flux/dispatcher",["external/flux","modules/core/exception"],function(t,n){var r,o;return o=!1,new(r=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.dispatch=function(e){n.assert(!o,"Invariant error: cannot dispatch during dispatch."),n.assert(null!=e.type,"Invariant error: cannot dispatch action without 'type' properrty."),o=!0;try{"function"==typeof this.dispatch_begin&&this.dispatch_begin();try{return r.__super__.dispatch.call(this,{action:e})}finally{"function"==typeof this.dispatch_end&&this.dispatch_end()}}finally{o=!1}},r}(t.Dispatcher))})}.call(this),function(){define("modules/clean/gandalf_util",["modules/constants/gandalf"],function(e){var t;return new(t=function(){function t(){}return t.prototype.getGandalfRule=function(t){return e.gandalf[t]},t.prototype.isGandalfInVariant=function(e,t){return null==t&&(t="CONTROL"),this.getGandalfRule(e)===t},t}())})}.call(this),function(){define("modules/clean/growth/experiments/logger",["modules/clean/ajax"],function(e){var t;return t=function(){function t(){}var n,r;return t.start_times={},t.DEFAULT_TIMER_NAME="view_time",t.get_timer_name=function(e){return null==e||"boolean"==typeof e?t.DEFAULT_TIMER_NAME:e},t.set_start_time=function(e){var n;return n=t.get_timer_name(e),t.start_times[n]=Date.now()},t.do_log_view_time=function(e,n){var r;return r=t.get_timer_name(n),e[r]=Math.round((Date.now()-t.start_times[r])/1e3)},r={},n=[5,15,60,120,300],t.start_counter=function(e,t){var o,i,s,a;for(s=[],o=0,i=n.length;i>o;o++)a=n[o],s.push(function(n){return r[e+n]=setTimeout(function(){return t(e,{time_since_first_view:n})},1e3*n)}(a));return s},t.stop_counter=function(e){var t,o,i,s;for(i=[],t=0,o=n.length;o>t;t++)s=n[t],i.push(clearTimeout(r[e+s]));return i},t.log=function(n,r,o,i){switch(null==i&&(i=!1),o=o||{},n){case"onboarding":return i&&t.do_log_view_time(o,i),e.SilentBackgroundRequest({url:"/growth_onboarding_log",data:{evt:r,extra:JSON.stringify(o)}});case"sharing":return t.do_log_view_time(o),e.SilentBackgroundRequest({url:"/growth_sharing_log",data:{evt:r,extra:JSON.stringify(o)}});case"post_client_install_tab":return i&&t.do_log_view_time(o,i),e.SilentBackgroundRequest({url:"/growth_post_client_install_tab_log",data:{evt:r,extra:JSON.stringify(o)}});default:throw new Error("Invalid series name")}},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/header_bubble",[],function(){var t;return t=function(){function t(t,n){this.$element=t,this.options=n,this.hide=e(this.hide,this),this.$element.parent().addClass("active"),this.$element.find(".confirm-button").on("click",this.hide),this.$element.find(".dismiss-button").on("click",this.hide)}return t.prototype.hide=function(){return this.$element.parent().removeClass("active")},t}()})}.call(this),function(){define("modules/clean/hi_res",["jquery"],function(e){var t;return t=function(){function t(e){var t;this.constructor._show_hi_res()&&(t=e.attr("data-hi-res-no-resize"),this.constructor.set_src(e,e.attr("data-hi-res"),t),this.constructor.set_bg(e,e.attr("data-hi-res-background"),t))}return t.set_src=function(e,t,n){return this._show_hi_res()&&t&&t!==e.attr("src")?this._replace(e,t,!n,this._replace_img):void 0},t.set_bg=function(e,t,n){return this._show_hi_res()?this._replace(e,t,!n,this._replace_background):void 0},t._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},t._replace=function(t,n,r,o){var i;if(n)return i=new Image,i.src=n,e(i).on("load",function(){return o(t,n,r,i.width,i.height)})},t._replace_img=function(e,t,n,r,o){return e.attr("src",t),n?(e.width(r/2),e.height(o/2)):void 0},t._replace_background=function(e,t,n,r,o){var i;return i="url('%(src)s')".format({src:t}),e.css("backgroundImage",i),n?e.css("backgroundSize",r/2+"px "+o/2+"px"):void 0},t}()})}.call(this),function(){define("modules/clean/image_size",[],function(){var e;return e=function(e,t){var n,r,o,i,s,a,l;for(i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]],r=0,s=i.length;s>r;r++)if(a=i[r],o=a[0],l=a[1],n=a[2],l>=e||n>=t)return o;return i[i.length-1][0]},{image_best_fit_size:e}})}.call(this),function(){define("modules/clean/index_2015",["jquery","external/underscore","modules/clean/dbmodal","modules/clean/analytics","modules/clean/register_form"],function(e,t,n,r,o){var i,s;return s=r.UserActivityLogger,i=function(){function r(){var r,i,a;this._onScrollHandler(),e(window).scroll(t.throttle(this._onScrollHandler,33,{leading:!0,trailing:!0})),a=new n.DBModal({element_id:"sign-up-modal"}),e("#sign-up, .sign-up").on("click",function(e){return e.preventDefault(),s.log("","web_register"),a.show()}),i=new n.DBModal({element_id:"index-sign-in-modal",focus:"input[name='login_email']"}),e("#sign-in").on("click",function(e){return e.preventDefault(),i.show(),s.log("","web_login")}),e(document).on(o.USER_EXISTS,function(e){return i.show(e.focus,e.prefill)}),e(".get-dropbox-cta-v2__show-modal").length>0&&(r=new n.DBModal({element_id:"pro-plan-modal"}),e(".get-dropbox-cta-v2__show-modal").on("click",function(e){return r.show()}))}return r.prototype._onScrollHandler=function(){return e(window).scrollTop()>350?(e("#dropbox-logo").addClass("fade-out"),e(".button-toggler").addClass("show-sign-up")):(e("#dropbox-logo").removeClass("fade-out"),e(".button-toggler").removeClass("show-sign-up"))},r}()})}.call(this),function(){define("modules/clean/job_progress",["jquery","modules/core/dom"],function(e,t){var n,r,o;return o={make:function(t,n){var r,o,i,s,a,l,u;return null==n&&(n=300),u=n.toString()+"px",i=e("<div />",{class:"outer-progress-bar"}).css({width:u}),r=e("<div />",{class:"inner-progress-bar",id:"pb_"+t}).css({width:u}),a=e("<div />",{class:"under-pb progress-bar"}).css({width:u}),s=e("<div />",{class:"over-pb progress-bar",id:"pb_"+t+"_over"}).css({display:"none"}),l=e("<div />",{class:"pb-percentage",id:"pb_"+t+"_upct"}).css({width:u}),o=e("<div />",{class:"pb-percentage",id:"pb_"+t+"_opct"}).css({width:u}),a.append(l),s.append(o),r.append(a),r.append(s),i.append(r),s.data("progress-width",n),i},set:function(t,n){var r,o,i,s;return(r=e("#pb_"+t+"_over"))?(o=n.split("/").map(Number),n=o.length>1?o[0]/o[1]:o[0],n=isNaN(n)?0:n,i=100*Math.min(n,1),s=String(i)+"%",r.show(),r.css({backgroundColor:"#348DD3",overflow:"hidden",width:s})):void 0}},n={complete:{},handled:function(e){var t;return e?(t=!!n.complete[e],n.complete[e]=!0,t):!1},peek:function(e){return e?!!n.complete[e]:!1}},r={show:function(n){var r,i,s,a,l,u,c,_;if(n&&(null!=(c=__CONDITIONAL_JS__.DBModalStack)&&null!=(_=c.top())&&_.hide(),r=e("body"),i=e("<div />",{id:"modal-progress-overlay"}),i.hide(),i.appendTo(r),e("#browse-box").length?t.clone_position(i,e("#browse-box")):e("#gallery-view-media").length?t.clone_position(i,e("#gallery-view-media")):i.css({position:"fixed",width:"100%",height:"100%"}),i.width()))return l=e("<div />",{id:"modal-progress-content"}),a=e("<div />",{id:"modal-progress-container"}),s=e("<div />",{id:"modal-progress-bar",opacity:1,html:o.make("modal-progress",150,"")}),u=e("<div />",{id:"modal-progress-text",text:n}),l.hide(),a.append(s,u),l.append(a),r.append(l),i.fadeTo(250,.7),l.fadeIn(250)},update:function(e){var t;return t="progress",e.indexOf(t)>-1&&(e=e.substring(t.length),isNaN(e))?void 0:o.set("modal-progress",e)},hide:function(){return e("#modal-progress-overlay").fadeOut(250,function(){return e("#modal-progress-overlay").remove()}),e("#modal-progress-content").fadeOut(250,function(){return e("#modal-progress-content").remove()})}},{ModalProgress:r,Job:n}})}.call(this),function(){define("modules/clean/js_environment",[],function(){return{isBrowser:function(){return"undefined"!=typeof window&&null!==window},isTest:function(){return"undefined"!=typeof jasmine&&null!==jasmine}}})}.call(this),function(){define("modules/clean/keycode",[],function(){var e;return e=function(){function e(){}return e.A=65,e.BACKSPACE=8,e.TAB=9,e.ENTER=13,e.SHIFT=16,e.CONTROL=17,e.ALT=18,e.ESC=27,e.SPACE=32,e.PAGE_UP=33,e.PAGE_DOWN=34,e.END=35,e.HOME=36,e.LEFT=37,e.UP=38,e.RIGHT=39,e.DOWN=40,e.INSERT=45,e.DELETE=46,e.TWO_KEY=50,e.EQUALS=61,e.COMMAND=91,e.PLUS_EQUALS_FF=107,e.MINUS_FF=109,e.F1=112,e.F2=113,e.F3=114,e.F4=115,e.F5=116,e.F6=117,e.F7=118,e.F8=119,e.F9=120,e.F10=121,e.F11=122,e.F12=123,e.PLUS_EQUALS_FF_GERMAN=171,e.MINUS_FF_MAC=173,e.PLUS_CHROME=187,e.MINUS_CHROME=189,e.FORWARD_SLASH=191,e.AT_SIGN=64,e.PROCESSING=229,e}()})}.call(this),function(){define("modules/clean/legacy_ui_button",["jquery"],function(e){var t;return t=function(){var t;return t=e(document),e(document).on("mouseover.ui-button",".ui-button",function(){return e(this).addClass("over")}).on("mouseout.ui-button",".ui-button",function(){return e(this).removeClass("over")}).on("mousedown.ui-button",".ui-button",function(){return e(this).addClass("down")}).on("click.ui-button",".ui-button",function(){var n;return n=e(this),n.hasClass("ui-button-dropdown")&&(n.hasClass("active")?t.trigger("dropdownClosed",[1]):t.trigger("dropdownOpened",[1])),n.toggleClass("active")}),t.on("click.ui-button",function(n){var r,o,i;return r=e(n.target),o=r.closest(".ui-button.active"),i=0,e(".ui-button.active").not(o).each(function(){var t;return t=e(this),t.hasClass("active")&&t.hasClass("ui-button-dropdown")&&(i+=1),t.removeClass("active")}),t.trigger("dropdownClosed",[i])}).on("mouseup.ui-button",function(){return e(".ui-button.down").removeClass("down")})}})}.call(this),function(){define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(e,t,n){var r,o;return o=n._,r=function(){function e(e,t,n){var r;this.$input=e,this.$suggestion_container=t,null==n&&(n={}),this.checkInput(),r=n.livecheck===!0?"keyup blur":"blur",this.$input.on(r,this.checkInput.bind(this))}return e.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],e.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],e.THRESHOLD=2,e.prototype.checkInput=function(){var e;e=this.suggest(this.$input.val()),e?this.populate(e):this.clear()},e.prototype.populate=function(e){var n,r,i;return i=t.escape(e.local).toHTML(),n=t.escape(e.domain).toHTML(),r=i+"@<span class='email_warning_area'>"+n+"</span>",this.$suggestion_container.html(new t(o("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:r})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",function(t){return function(){return t.$input.val(e.full),t.clear()}}(this))},e.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},e.prototype.suggest=function(e){var t,n,r,o;return null==e&&(e=""),e.length?(e=e.toLowerCase(),(o=this.splitEmail(e))?(r=o.local,n=o.domain,this.whitelistedDomain(n)?!1:(t=this.findClosestDomain(n),t?{local:r,domain:t,full:r+"@"+t}:!1)):!1):void 0},e.prototype.whitelistedDomain=function(t){var n,r,o,i;for(i=e.WHITELIST_REGEXS,n=0,r=i.length;r>n;n++)if(o=i[n],o.test(t))return!0;return!1},e.prototype.splitEmail=function(e){var t;return t=e.split("@"),2!==t.length?!1:{local:t[0],domain:t[1]}},e.prototype.findClosestDomain=function(t){var n,r,o,i,s,a,l;for(a=99,r=null,l=e.DOMAINS,i=0,s=l.length;s>i;i++)n=l[i],o=this.stringDistance(t,n),a>o&&(a=o,r=n);return r&&r!==t&&a<=e.THRESHOLD?r:!1},e.prototype.stringDistance=function(e,t){var n,r,o,i,s,a;if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(n=0,s=0,a=0,o=0,i=5;n+s<e.length&&n+a<t.length;){if(e.charAt(n+s)===t.charAt(n+a))o++;else for(s=0,a=0,r=0;i>r;){if(n+r<e.length&&e.charAt(n+r)===t.charAt(n)){s=r;break}if(n+r<t.length&&e.charAt(n)===t.charAt(n+r)){a=r;break}r++}n++}return(e.length+t.length)/2-o},e}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/marketing_tracker",["modules/core/exception"],function(t){var n,r;return n="https://marketing.dropbox.com",new(r=function(){function r(){this._load=e(this._load,this),this.push=e(this.push,this)}return r.prototype.el=!1,r.prototype.ready=!1,r.prototype.push=function(e){var r;return this.src=e.src,r=e.dataLayer,t.assert(this.src,"MarketingTracker.push requires src"),this.el||(this.el=this._load(this.src)),this.ready?this.el.contentWindow.postMessage(r,n):this.el.addEventListener("load",function(e){return function(){return e.ready=!0,e.el.contentWindow.postMessage(r,n)}}(this)),this},r.prototype._load=function(e){var t;return t=document.createElement("iframe"),t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},r}())})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},t=[].slice;define("modules/clean/notserver",["jquery","external/underscore","modules/constants/env","modules/core/exception","modules/core/uri","modules/clean/viewer"],function(n,r,o,i,s,a){var l,u,c,_,d,h,p,f,m;d=i.assert,l={},u=!1,_="/subscribe",c=function(){function o(){}return o.prototype.add_notclient=function(e,t,n){return this.new_notclient(e),setTimeout(function(){return l[e].init(t,n)},2e3)},o.prototype.new_notclient=function(o){var i,a,c,h,p,f,m,g,v,y,w,b,x,E,S,T,C,k,R,A,N,L,I,O,D,P,$,M,F,U,j,q,B,H,W,G,z,V,J,X,Y,K;return d(e.call(l,o)<0,"cannot create more than one notclient per user"),A=function(e){return r.isNumber(e)&&e%1===0&&e>0},R=function(e){return r.isNumber(e)&&e%1===0&&e>=0},d(A(o),"user_id must be a positive integer"),N=function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],u?console.log.apply(console,e):void 0},i=9e4,h=8096,f="user",p="list",T=!1,a=1e3,c=3e5,$=0,V=function(){var e;return e=0===x?0:Math.min(a*Math.pow(2,x-1),c),Math.max(e,$)},D=null,M={},S={},O=1,C=!1,k=!1,K=null,v=!1,j=!1,X=[],z=null,b=null,L=null,I={},F=!1,x=0,J=0,Y=function(e,t){var n,r,o;r=[];for(n in t)o=t[n],n=parseInt(n,10),d(A(n),"ns_ids must be positive integers: "+n),d(R(o),"sjids must be nonnegative integers: "+o),null!=e[n]?r.push(e[n]=Math.min(e[n],o)):r.push(e[n]=o);return r},y=function(){var t,n,i,a;return d(null!=D&&!r.isEmpty(M),"expected nid and ns_map"),i={host_int:0,trace:window.location.pathname},t=r.pluck(r.values(S),"type"),e.call(t,f)>=0&&(i.user_id=o,i.nid=null!=D?D.replace(/^0+(.)/,"$1"):void 0),e.call(t,p)>=0&&(i.ns_map=function(){var e;e=[];for(n in M)a=M[n],e.push(n+"_"+a);return e}().join(",")),s.parse(_).updateQuery(i).toString().length>h&&delete i.ns_map,i},w=function(){var e;if(T)return e=V(),e>0?b=window.setTimeout(m,e):j?void 0:m()},m=function(){var e;return d(!C&&!k,"connect: invalid state"),d(D>=0||!r.isEmpty(M),"notclient: called connect with nothing to subscribe to"),N("###########################"),e=y(),null!=e.nid||e.ns_map?(N("connecting to notserver..."),C=!0,J+=1,K=n.ajax(_,{data:e,dataType:"json",error:function(){return v?void(v=!1):(x+=1,N("error connecting to notserver. bad rounds="+x+"."),C=!1,w())},success:function(e){return N("notserver connection closed. response:",e),C=!1,null!=e.chillout?($=1e3*parseInt(e.chillout,10),N("notserver told us to chill for "+$+"ms")):$>0&&(N("setting notserver chillout back to 0ms"),$=0),"punt"===e.ret?w():(d("new"===e.ret,"unknown notserver ret: "+e.ret),d("refresh"in e,"expected notserver ret:new to have refresh keyword"),G(e.refresh))}})):void N("nothing to subscribe to. skipping notserver connection.")},g=function(){return null!=K?(v=!0,K.abort(),K=null):void 0},U=function(){return j=!0,g()},W=function(){return U=!1,w()},q=function(){return $=0,C=!1,k=!1,g(),X=[],window.clearTimeout(z),window.clearTimeout(b),z=null,b=null,L=null,I={},F=!1,x=0,w()},H=function(){var e;return T=!1,$=0,D=null,M={},S={},e=0,O=1,C=!1,k=!1,K=null,v=!1,X=[],window.clearTimeout(z),window.clearTimeout(b),z=null,b=null,L=null,I={},F=!1,x=0,J=0},G=function(t){var n,o,s,a,l,u,c,_;for(d(!k&&!C,"run_handlers: invalid state"),d(null===L,"run_handlers: new_nid must start at null"),d(r.isEqual(I,{}),"run_handlers: new_ns_map must start at {}"),d(!F,"expected one_or_more_handler_failures=false"),k=!0,N("running handlers..."),c=r.filter(r.values(S),function(n){var r;return r=n.type,e.call(t,r)>=0}),d(!r.isEmpty(c),"notserver sent a ping for unsubscribed activity"),X=r.pluck(c,"handler_id"),s=0,a=c.length;a>s;s++)u=c[s],n=u.handler,o=u.handler_id,l=u.name,_=u.type,N("running id="+o+", name="+l+", type="+_),n();return r.isEmpty(X)?N("all handlers already finished running. no need for a slacker timeout."):(N("all handlers running. slacker timeout set."),z=window.setTimeout(B,i))},B=function(){var e,t,n,o;for(d(k&&!C,"called report_slackers in an invalid state."),d(!r.isEmpty(X,"report_slackers called w/ nothing slackin'")),N("found some slackers"),F=!0,o=[],t=0,n=X.length;n>t;t++)e=X[t],o.push(E(e));return o},E=function(t){return e.call(X,t)<0?void 0:(N("done handling: "+t),X=r.without(X,t),r.isEmpty(X)?(N("all handlers are done running."),k=!1,window.clearTimeout(z),null!=L&&(N("new nid: "+L),D=L),r.isEmpty(I)||(N("new ns_map:",I),M=I),F?(x+=1,N("one or more handler errors. bad_rounds="+x)):x=0,L=null,I={},F=!1,w()):void 0)},P={get_user_id:function(){return o},get_nid:function(){return D},get_ns_map:function(){return r.clone(M)},get_consecutive_bad_rounds:function(){return x},get_total_rounds:function(){return J},get_notserver_chillout_ms:function(){return $},get_sleep_ms:V,subscribe_user:function(t){var n,o,i,s,a,l,u;for(d(!k,"adding new handlers from inside handlers is not currently supported"),u=["name","handler"],i=0,s=u.length;s>i;i++)l=u[i],d(t[l],"subscribe_user requires this param be non-falsey: "+l);return d(r.isFunction(t.handler),"handler must be a function"),N("adding user handler "+t.name),o=r.pluck(r.values(S),"type"),a=e.call(o,f)<0,n=O++,S[n]={handler_id:n,handler:t.handler,name:t.name,type:f},a&&(N("first user handler added, reconnecting"),q()),n},subscribe_sfj:function(t){var n,o,i,s,a,l,u;for(d(!k,"adding new handlers from inside handlers is not currently supported"),u=["name","handler"],i=0,s=u.length;s>i;i++)l=u[i],d(t[l],"subscribe_sfj requires this param be non-falsey: "+l);return d(r.isFunction(t.handler),"handler must be a function"),N("adding sfj handler "+t.name),o=r.pluck(r.values(S),"type"),a=e.call(o,p)<0,n=O++,S[n]={handler_id:n,handler:t.handler,name:t.name,type:p},a&&(N("first sfj handler added, reconnecting"),q()),n},unsubscribe:function(e){return d(!k,"removing handlers from inside handlers is not supported"),d(e in S,"no subscribed handler with the given id"),delete S[e],r.isEmpty(S)?g():void 0},handler_success:function(t,n){var r;if(!(e.call(X,t)<0))return r=S[t].type,r===p?(d("ns_map"in n,"ns_map required param is missing"),d(!("nid"in n),"nid is disallowed from SFJ handlers"),Y(I,n.ns_map)):(d(r===f,"unknown handler type: "+r),d("nid"in n,"nid required param is missing"),d(!("ns_map"in n),"ns_map is disallowed from user handlers"),(null==L||n.nid<L)&&(L=n.nid)),E(t)},handler_failure:function(t){return N("handler failed. handler_id="+t),e.call(X,t)<0?void 0:(F=!0,E(t))},handle_visibility_change:function(){return window.document.hidden?g():q()},init:function(e,t){return d(!T,"error: init() has been called twice."),D=e,Y(M,t),T=!0,null==window.document.visibilityState?w():(document.addEventListener("visibilitychange",this.handle_visibility_change),window.document.hidden?void 0:w())},reset:H,abort:g,pause:U,resume:W,reconnect:q},l[o]=P,P},o}(),c=new c,f=a.get_viewer().get_users();for(h=0,p=f.length;p>h;h++)m=f[h],c.add_notclient(m.id,m.nid,m.ns_map);return{NotServer:c,NotClients:l}})}.call(this),function(){define("modules/clean/open_in_mobile_app",["jquery","modules/clean/analytics","modules/core/i18n","modules/core/uri"],function(e,t,n,r){var o,i;return i=n._,o=function(){function n(){}return n.vischange_listener=null,n.open_app_mode=!0,n.try_open_ios_9=function(e,t,r){var o;return n.vischange_listener||(o=r.text(),n.vischange_listener=function(e){return n.open_app_mode=!0,r.text(o)},document.addEventListener("visibilitychange",n.vischange_listener)),n.open_app_mode?(n.open_app_mode=!1,r.text(i("Install app?")),window.location=e):window.location=t},n.fallback_will_launch=!1,n.try_open=function(r,o,i){var s,a,l,u,c,_,d,h;if(!n.fallback_will_launch)return s=e("body"),h=function(){var t;return t=e("<iframe />",{src:r,style:"display: none;"}),s.append(t)},c=!1,d=function(e){return c=!0},document.addEventListener("visibilitychange",d),l=!1,u=function(e){return l=!0},window.addEventListener("pagehide",u),null!=i&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN","WEB_MOBILE",{scl_url:i}),h(),_=Date.now(),a=function(){return n.fallback_will_launch=!1,document.removeEventListener("visibilitychange",d),window.removeEventListener("pagehide",u),!l&&!c&&Date.now()<_+4700?(null!=i&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL","WEB_MOBILE",{scl_url:i}),window.location.replace(o)):void 0},setTimeout(a,3200),n.fallback_will_launch=!0},n.open_on_click=function(t,n,r,o,i,s){var a;return null==s&&(s=null),a=function(r){return function(a){return a.preventDefault(),i?(o||(o=e("<div/>")),r.try_open_ios_9(t,n,o)):r.try_open(t,n,s)}}(this),e(r).on("click",a)},n.redirect_on_load=function(e,t){return this.try_open(e,t)},n}()})}.call(this),function(){define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var t,n;return n=e.assert,new(t=function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return n("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return n("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,r,o,i;for(o=this._listeners,i=[],n=0,r=o.length;r>n;n++)t=o[n],t!==e&&i.push(t);return i}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,r,o,i;for(o=this._listeners.slice(),i=[],n=0,r=o.length;r>n;n++)t=o[n],i.push(t(e));return i},e}())})}.call(this),function(){define("modules/clean/payments/cash",[],function(){var e,t,n,r;return r=function(){function e(){}return e._groupSymbol=",",e._decimalSymbol=".",e._minusSignSymbol="-",e._currencyFormatMap={USD:"$%v"},e.set_locale_number_format=function(t,n,r){e._groupSymbol=null!=t?t:",",e._decimalSymbol=null!=n?n:".",e._minusSignSymbol=null!=r?r:"-"},e.set_currency_format_map=function(t){e._currencyFormatMap=t},e._formatAmountThousandsHelper=function(t){var n;return n=Math.abs(parseInt(t)).toFixed(0)+"",n.length<=3?n:e._formatAmountThousandsHelper(n.substr(0,n.length-3))+e._groupSymbol+n.substr(n.length-3)},e.roundCurrency=function(e,t,n){return null==t&&(t="USD"),null==n&&(n=2),e%1===0&&(n=0),this.formatCurrency(e,t,n)},e.formatCurrency=function(t,n,r,o){var i,s,a,l;return null==n&&(n="USD"),null==r&&(r=2),null==o&&(o=!1),"JPY"===n&&(r=0),s=e.formatNumber(t,r),a=(null!=(l=e._currencyFormatMap[n])?l.replace("%v",s):void 0)||s+" "+n,o?(i=a.indexOf(e._decimalSymbol),-1===i?[a,""]:[a.slice(0,i+1),a.slice(i+1)]):a},e.formatNumber=function(t,n){return null==n&&(n=2),(0>t?e._minusSignSymbol:"")+e._formatAmountThousandsHelper(t)+(n>0?e._decimalSymbol+t.toFixed(n).split(".")[1]:"")},e}(),t=function(){function e(e,t){this.cash1=e,this.cash2=t}return e}(),n=function(){function e(){}return e}(),e=function(){function e(e,t){if(this.currency=t,!e&&0!==e||!this.currency)throw new n;this.amount=parseFloat(e)}return e.prototype.add=function(n){if(this.currency!==n.currency)throw new t(self,n);return new e(this.amount+n.amount,this.currency)},e.prototype.subtract=function(t){return this.add(new e(-t.amount,t.currency))},e.prototype.multiply=function(t){return new e(this.amount*t,this.currency)},e.prototype.divide=function(t){return new e(this.amount/t,this.currency)},e.prototype.round=function(t){var n;return null==t&&(t=2),n=Math.pow(10,t),new e(Math.round(this.amount*n)/n,this.currency)},e.prototype.toString=function(e){return null==e&&(e=2),"JPY"===this.currency&&(e=0),r.roundCurrency(this.amount,this.currency,e)},e.prototype.formatCurrency=function(e){return null==e&&(e=2),r.formatCurrency(this.amount,this.currency,e)},e.fromObject=function(t){return new e(t.amount,t.currency)},e}(),{CashUtil:r,CashCurrenciesDoNotMatch:t,CashNeedsAmountAndCurrency:n,Cash:e}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/payments/dfb_util",["external/underscore","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(t,n,r,o,i){
var s,a,l,u,c;return s=r.Cash,c=i.assert,u=function(){function e(e,t,n,r,o,i,s){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=n,this.currencies=r,this.country_code=o,this.zip_code=i,this.vat_id=s,this.renew=!1,this.discount_ratio=0}return e.prototype.set_only_license_count=function(e){var t;return t=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[t]=e},e.prototype.get_only_license_count=function(){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]},e.prototype.set_country_code=function(e){this.country_code=e},e.prototype.set_zip_code=function(e){this.zip_code=e},e.prototype.set_currencies=function(e){this.currencies=e},e.prototype.set_renew=function(e){this.renew=e},e.prototype.set_discount_ratio=function(e){this.discount_ratio=e},e.prototype.set_vat_id=function(e){return""!==e&&o.validateVat(this.country_code,e)?this.vat_id=e:this.vat_id=""},e.prototype.cache_key=function(){var e;return this.currencies&&(e=this.currencies.join(",")),[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),e,this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},e.prototype.to_json=function(){var e;return e=this.renew?{renew:1}:{},e=t.extend(e,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:this.currencies?JSON.stringify(this.currencies):"",country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio)})},e.from_transition_view_models=function(n){var r,o,i,s,a,l,u,_,d,h,p,f,m,g,v,y,w,b,x,E,S,T,C,k;for(p=[],S=[],i=[],h=!1,o=!1,C=!1,k=!1,s=0,u=n.length;u>s;s++)if(T=n[s],p.push(T.state.plan.id),S.push(T.state.schedule.id),i.push(T.state.currency),h===!1){for(h={},f=T.state.allocated_licenses,a=0,_=f.length;_>a;a++)r=f[a],h[r.license_id]=r.license_count;o=null!=(m=T.read_only_invoice)?m.tax_country_code:void 0,C=null!=(g=null!=(v=T.read_only_invoice)?v.tax_exclusion_id:void 0)?g:null,k=null!=(y=T.read_only_invoice)?y.tax_zip_code:void 0}else{for(c(T.state.allocated_licenses.length===Object.keys(h).length,"License sets differ"),w=T.state.allocated_licenses,l=0,d=w.length;d>l;l++)r=w[l],c(r.license_id in h,"License sets differ"),c(h[r.license_id]===r.license_count,"License count must match");c(o===(null!=(b=T.read_only_invoice)?b.tax_country_code:void 0),"country codes must match"),c(k===(null!=(x=T.read_only_invoice)?x.tax_zip_code:void 0),"zip codes must match"),c(C===(null!=(E=T.read_only_invoice)?E.tax_exclusion_id:void 0),"VAT IDs must match")}return new e(t.uniq(p),t.uniq(S),h,t.uniq(i),o,k,C)},e}(),a=function(){function e(e){var t,n;this.transition_view_model=e,this.transition_view_model.read_only_invoice?this.current_total=s.fromObject(this.transition_view_model.read_only_invoice.total):this.current_total=new s(0,this.transition_view_model.state.currency),this.transition_view_model.state.per_license_prices.length?this.per_license_price=s.fromObject(this.transition_view_model.state.per_license_prices[0].price):this.per_license_price=new s(0,this.transition_view_model.state.currency),this.recurring_total=s.fromObject(this.transition_view_model.state.total_recurring_price),this.transition_view_model.prices?this.tax=s.fromObject(this.transition_view_model.prices.tax):this.tax=new s(0,this.recurring_total.currency),this.recurring_total_tax=this.recurring_total.add(this.tax),this.tax_percentage=0,this.transition_view_model.read_only_invoice&&(n=this.transition_view_model.read_only_invoice.line_items,t=n.length>0?n[0]:void 0,(null!=t?t.country_tax_percentage:void 0)?this.tax_percentage=t.country_tax_percentage:(null!=t?t.state_tax_percentage:void 0)&&(this.tax_percentage=t.state_tax_percentage))}return e}(),l=function(){function t(t){this.default_transition_view_models=t,this._get_transition_info_for=e(this._get_transition_info_for,this),this._add_to_cache=e(this._add_to_cache,this),this.has_inflight_request=e(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return t.prototype.get=function(e,t){var r,o,i;return i=u.from_transition_view_models(this.default_transition_view_models),t.total_users&&i.set_only_license_count(t.total_users),t.country_code&&i.set_country_code(t.country_code),t.currency&&i.set_currencies([t.currency]),t.remove_currency&&i.set_currencies(),t.zip_code&&i.set_zip_code(t.zip_code),t.renew&&i.set_renew(t.renew),(t.vat_id||""===t.vat_id)&&i.set_vat_id(t.vat_id),t.discount_ratio&&i.set_discount_ratio(t.discount_ratio),r=i.cache_key(),(o=this._get_transition_info_for(r))?void e(o):this.transition_view_model_requests[r]?void 0:(this.transition_view_model_requests[r]=!0,n.AuthenticatedRequest({url:"/business/transition-model",type:"GET",dataType:"json",data:i.to_json(),success:function(t){return function(n){var o;return delete t.transition_view_model_requests[r],o=t._add_to_cache(n),e(o)}}(this),error:function(e){return function(t){return delete e.transition_view_model_requests[r]}}(this)}))},t.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},t.prototype._add_to_cache=function(e){var t,n,r;return t=u.from_transition_view_models(e).cache_key(),n=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)r=e[t],o.push(new a(r));return o}(),this.transition_info_cache[t]=n,n},t.prototype._get_transition_info_for=function(e){return e in this.transition_info_cache?this.transition_info_cache[e]:null},t}(),{DfBTransitionInfo:a,DfBTransitionInfoFetcher:l}})}.call(this),define("modules/clean/payments/validation",["require","exports"],function(e,t){"use strict";function n(e,t){return t.trim().length?s[e]?s[e].regex.test(t):!1:!0}function r(e){return s[e]?s[e].prefix:""}function o(e){return s[e]?s[e].examples:[]}function i(e){if(e=e.replace(/\s+/g,""),e.length<2)return!1;var t=e.substring(0,2);switch(t){case"AT":return/^AT[0-9]{18}$/.test(e);case"BE":return/^BE[0-9]{14}$/.test(e);case"CY":return/^CY[0-9]{10}[0-9a-zA-Z]{16}$/.test(e);case"CZ":return/^CZ[0-9]{22}$/.test(e);case"DE":return/^DE[0-9]{20}$/.test(e);case"EE":return/^EE[0-9]{18}$/.test(e);case"ES":return/^ES[0-9]{22}$/.test(e);case"FI":return/^FI[0-9]{16}$/.test(e);case"FR":return/^FR[0-9]{12}[0-9a-zA-Z]{11}[0-9]{2}$/.test(e);case"GR":return/^GR[0-9]{9}[0-9a-zA-Z]{16}$/.test(e);case"HU":return/^HU[0-9]{26}$/.test(e);case"HR":return/^HR[0-9]{19}$/.test(e);case"IE":return/^IE[0-9]{2}[0-9a-zA-Z]{4}[0-9]{14}$/.test(e);case"IT":return/^IT[0-9]{2}[A-Z]{1}[0-9]{10}[0-9a-zA-Z]{12}$/.test(e);case"LU":return/^LU[0-9]{5}[0-9a-zA-Z]{13}$/.test(e);case"NL":return/^NL[0-9]{2}[A-Z]{4}[0-9]{10}$/.test(e);case"PL":return/^PL[0-9]{26}$/.test(e);case"PT":return/^PT[0-9]{23}$/.test(e);case"SE":return/^SE[0-9]{22}$/.test(e)}return!1}var s={AT:{prefix:"AT",regex:/^ATU[0-9]{8}$/,examples:["ATU12345678"]},BE:{prefix:"BE",regex:/^BE(0?|1)[0-9]{9}$/,examples:["BE0123456789","BE1123456789","BE1234567890"]},BG:{prefix:"BG",regex:/^BG[0-9]{9,10}$/,examples:["BG123456789","BG1234567890"]},CH:{prefix:"CH",regex:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,examples:["CHE123456789TVA","CHE123456789MWST","CHE123456789IVA"]},CY:{prefix:"CY",regex:/^CY[0-9]{8}[A-Z]$/,examples:["CY12345678X"]},CZ:{prefix:"CZ",regex:/^CZ[0-9]{8,10}$/,examples:["CZ12345678","CZ123456789","CZ1234567890"]},DE:{prefix:"DE",regex:/^DE[0-9]{9}$/,examples:["DE123456789"]},DK:{prefix:"DK",regex:/^DK[0-9]{8}$/,examples:["DK12345678"]},EE:{prefix:"EE",regex:/^EE[0-9]{9}$/,examples:["EE123456789"]},GR:{prefix:"EL",regex:/^EL[0-9]{9}$/,examples:["EL123456789"]},ES:{prefix:"ES",regex:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,examples:["ESX12345678","ES12345678X","ESX1234567X"]},FI:{prefix:"FI",regex:/^FI[0-9]{8}$/,examples:["FI12345678"]},FR:{prefix:"FR",regex:/^FR[0-9A-Z]{2}[0-9]{9}$/,examples:["FR12345678901","FRX1234567890","FR1X123456789","FRXX123456789"]},GB:{prefix:"GB",regex:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,examples:["GB123456789","GB123456789012","GBGD123","GBHA123"]},HR:{prefix:"HR",regex:/^HR[0-9]{11}$/,examples:["HR12345678901"]},HU:{prefix:"HU",regex:/^HU[0-9]{8}$/,examples:["HU12345678"]},IE:{prefix:"IE",regex:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]{1,2}|[0-9]{7}WI)$/,examples:["IE1X23456X","IE1X23456X","IE1234567XX"]},IT:{prefix:"IT",regex:/^IT[0-9]{11}$/,examples:["IT12345678901"]},LT:{prefix:"LT",regex:/^LT([0-9]{9}|[0-9]{12})$/,examples:["LT123456789","LT123456789012"]},LU:{prefix:"LU",regex:/^LU[0-9]{8}$/,examples:["LU12345678"]},LV:{prefix:"LV",regex:/^LV[0-9]{11}$/,examples:["LV12345678901"]},MT:{prefix:"MT",regex:/^MT[0-9]{8}$/,examples:["MT12345678"]},NL:{prefix:"NL",regex:/^NL[0-9]{9}B[0-9]{2}$/,examples:["NL123456789B01"]},NO:{prefix:"NO",regex:/^NO[0-9]{9}(MVA)?$/,examples:["NO123456789","NO123456789MVA"]},PL:{prefix:"PL",regex:/^PL[0-9]{10}$/,examples:["PL1234567890"]},PT:{prefix:"PT",regex:/^PT[0-9]{9}$/,examples:["PT123456789"]},RO:{prefix:"RO",regex:/^RO[0-9]{2,10}$/,examples:["RO12","RO1234567890"]},SE:{prefix:"SE",regex:/^SE[0-9]{12}$/,examples:["SE123456789012"]},SI:{prefix:"SI",regex:/^SI[0-9]{8}$/,examples:["SI12345678"]},SK:{prefix:"SK",regex:/^SK[0-9]{10}$/,examples:["SK1234567890"]}};t.validateVat=n,t.getVatPrefix=r,t.getVatExamples=o,t.validIBANForCountry=i}),function(){define("modules/clean/photos/batch_thumb_loader",["jquery","modules/clean/ajax","modules/core/uri","modules/constants/env"],function(e,t,n,r){var o;return o=function(){function o(e){var t,n;t=e.batch_size,n=e.max_parallel_requests,this.on_batch=e.on_batch,this.batch_logger=e.batch_logger,this.on_batch_success=e.on_batch_success,this.batch_size=t||this.DEFAULT_BATCH_SIZE,this.max_parallel_requests=n||this.DEFAULT_MAX_PARALLEL_REQUESTS,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.next_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={},this._request_callback_by_request_id={}}return o.prototype.DEFAULT_BATCH_SIZE=16,o.prototype.DEFAULT_MAX_PARALLEL_REQUESTS=6,o.prototype.MAX_URL_LENGTH=6e3,o.prototype.vend_request_id=function(){var e;return e=this.next_thumb_request_id,this.next_thumb_request_id++,e},o.prototype.queue_thumb=function(t,n,o){var i,s,a,l,u,c,_,d,h,p;if(null==o&&(o={}),h=o.request_id,c=o.onrequest,!t)return null;if(e.support.cors&&r.BATCH_THUMB_ENDPOINTS.length){if(null==h&&(h=this.vend_request_id()),(null!=(_=this.request_ids_by_url[t])?_.length:void 0)>0){a=!1;for(i in this.outstanding_batches)for(d=this.outstanding_batches[i].urls,l=0,u=d.length;u>l;l++)p=d[l],p===t&&(a=!0);a&&"function"==typeof c&&c()}else this.thumb_url_queue.push(t),this.request_ids_by_url[t]=[];return this.request_ids_by_url[t].push(h),this.callback_by_id[h]={url:t,callback:n},this._request_callback_by_request_id[h]=c,this.thumb_url_queue.length>=this.batch_size&&(this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),this._send_batch_requests()),h}return"function"==typeof c&&c(),s=!0,"function"==typeof n&&n(t,s),null},o.prototype.cancel_thumb=function(e){var t,n,r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x,E,S,T;if(null!=this.callback_by_id[e]){for(S=this.callback_by_id[e].url,delete this.callback_by_id[e],delete this._request_callback_by_request_id[e],g=this.request_ids_by_url[S],o=a=0,u=g.length;u>a;o=++a)if(i=g[o],i===e){this.request_ids_by_url[S].splice(o,1);break}if(0===this.request_ids_by_url[S].length){for(delete this.request_ids_by_url[S],v=this.thumb_url_queue,o=l=0,c=v.length;c>l;o=++l)if(E=v[o],E===S)return void this.thumb_url_queue.splice(o,1);for(y=this.batch_queue,o=p=0,_=y.length;_>p;o=++p)for(n=y[o],s=f=0,d=n.length;d>f;s=++f)if(E=n[s],E===S)return n.splice(s,1),void(0===n.length&&this.batch_queue.splice(o,1));this.cancelled_urls[S]=1,x=[];for(r in this.outstanding_batches){for(w=this.outstanding_batches[r],T=w.urls,b=w.request,t=!0,m=0,h=T.length;h>m;m++)S=T[m],t=null!=this.cancelled_urls[S]&&t;if(t){b.abort();break}x.push(void 0)}return x}}},o.prototype.flush=function(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));return this._send_batch_requests()},o.prototype.reset=function(e){var t;return t=e.batch_size,this.batch_logger=e.batch_logger,this.batch_size=t||this.DEFAULT_BATCH_SIZE},o.prototype.clear=function(){return this.thumb_url_queue=[]},o.prototype.pause=function(){return this.flushing=!1},o.prototype._send_batch_requests=function(){var e,n,r,o,i,s,a,l,u,c,_,d,h,p,f;if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests)){for(this.flushing=!0,p=this.batch_queue.shift(),c=this._generate_request_params(p),o=c[0],u=c[1],r=c[2],"function"==typeof this.on_batch&&this.on_batch(p),i=0,a=p.length;a>i;i++)for(f=p[i],_=this.request_ids_by_url[f],s=0,l=_.length;l>s;s++)h=_[s],"function"==typeof(e=this._request_callback_by_request_id)[h]&&e[h](),delete this._request_callback_by_request_id[h];return n=this.next_batch_id,this.next_batch_id++,this.num_requests_in_flight++,d=t.AuthenticatedRequest({xhrFields:{withCredentials:!0},url:o,type:u,data:r,success:this._success.bind(this,p),error:this._error.bind(this,p),complete:this._complete.bind(this,n)}),this.outstanding_batches[n]={urls:p,request:d},this._send_batch_requests()}},o.prototype._success=function(e,t){var n,r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v;for(_=t.split("\n"),d={},o=0,s=e.length;s>o;o++)v=e[o],d[v]=!1;for(c=i=0,a=_.length;a>i;c=++i)u=_[c],p=u.indexOf(":"),-1!==p&&(f=u.substring(0,p).split("-"),r=parseInt(f[0],10),n=u.substring(p+1),v=e[r],d[v]=!0,this._call_callback(v,n),"function"==typeof this.batch_logger&&this.batch_logger(c,e.length));for("function"==typeof this.on_batch_success&&this.on_batch_success(e),m=e.filter(function(e){return!d[e]}),g=[],h=0,l=m.length;l>h;h++)v=m[h],null==this.cancelled_urls[v]?g.push(this._call_callback(v,v)):g.push(void 0);return g},o.prototype._error=function(e){var t,n,r,o;for(r=[],t=0,n=e.length;n>t;t++)o=e[t],r.push(this._call_callback(o,o));return r},o.prototype._complete=function(e){var t,n,r,o,i,s;for(this.num_requests_in_flight--,r=this.outstanding_batches[e],s=r.urls,o=r.request,t=0,n=s.length;n>t;t++)i=s[t],delete this.cancelled_urls[i];return delete this.outstanding_batches[e],this.flushing?this._send_batch_requests():void 0},o.prototype._call_callback=function(e,t){var n,r,o,i,s;if(n=0===t.indexOf("data:image")?t:e,null!=this.request_ids_by_url[e])for(i=this.request_ids_by_url[e],r=0,o=i.length;o>r;r++)s=i[r],this.callback_by_id[s].callback(n,!1),delete this.callback_by_id[s];return delete this.request_ids_by_url[e]},o.prototype._generate_request_params=function(t){var o,i,s,a,l,u,c,_;return c=e.map(t,function(e){return n.parse(e).setScheme().setAuthority().toString()}),_=JSON.stringify(c),a=Math.abs(this._hash_string_to_int(_)),i=a%r.BATCH_THUMB_ENDPOINTS.length,o=r.BATCH_THUMB_ENDPOINTS[i],u={image_urls:_,parallel:!0},s=n.parse(o).setQuery(u).toString(),l=s.length>this.MAX_URL_LENGTH?"POST":"GET",[o,l,u]},o.prototype._hash_string_to_int=function(e){var t,n,r,o,i;if(n=0,0===e.length)return n;for(r=o=0,i=e.length;i>=0?i>o:o>i;r=i>=0?++o:--o)t=e.charCodeAt(r),n=(n<<5)-n+t;return n},o}()})}.call(this),function(){define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(e,t,n){var r;return r={MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(r,o,i,s){var a,l,u,c,_,d,h,p,f,m,g;for(g=e.grep(r,function(t){return e(t).data("src")}),this.img_map={},_=0,h=g.length;h>_;_++)u=g[_],f=String(e(u).data("src")),null==(l=this.img_map)[f]&&(l[f]=[]),this.img_map[f].push(u);for(this.instance?this.instance.reset({batch_size:o,batch_logger:s}):this.instance=new t({batch_size:o,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:function(t){return function(n){var r,o,i,s,a;for(s=[],o=0,i=n.length;i>o;o++)a=n[o],r=e(t.img_map[a]),r.data("src",null),s.push(r.data("loading-src",a));return s}}(this),batch_logger:s}),c=[],d=0,p=g.length;p>d;d++)u=g[d],a=e(u),m=a.data("src"),this.instance.queue_thumb(m,function(e,t,r,o){return o||t.data("loading-src")?(t.data("loading-src",null),0===r.indexOf("data:image")?(t.attr("src",r),"function"==typeof i?i(t[0]):void 0):(t.error(function(){return t.attr("src",t.data("fail-src")||n.SPACER)}),t.load(function(){return"function"==typeof i?i(t[0]):void 0}),t.attr("src",r))):void 0}.bind(this,m,a));return this.instance.flush(),g.length},clear_all_pending_batches:function(){var e;return null!=(e=this.instance)?e.clear():void 0}}})}.call(this),function(){define("modules/clean/profile_services/profile_services_constants",["modules/core/exception","modules/core/i18n"],function(e,t){var n,r,o;return o=e.assert,r=t._,n={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},importable_contact_services:function(){return[this.GOOGLE,this.YAHOO]},to_img:function(e){switch(e){case this.GOOGLE:return["/static/images/contacts/import_icon_gmail-vflFQwVYO.png","/static/images/contacts/import_icon_gmail@2x-vflO2fTFE.png"];case this.YAHOO:case this.YAHOO_LEGACY:return["/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case this.FACEBOOK:return["/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];default:return o(!1,"Should never get ProfileServicesConstants.to_img with service: "+e)}},to_name:function(e){switch(e){case this.GOOGLE:return r("Gmail");case this.YAHOO:return r("Yahoo! Mail");case this.FACEBOOK:return r("Facebook");case this.VARIOUS:return r("Email");case this.YAHOO_LEGACY:return r("Yahoo! Mail");default:return o(!1,"Should never get ProfileServicesConstants.to_name with service: "+e)}},logging_identifiers:function(e){switch(e){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";default:return o(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+e)}}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/profile_services/profile_services_link",["jquery","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/profile_services/profile_services_constants","modules/clean/user","modules/clean/viewer","modules/constants/viewer","modules/core/browser"],function(n,r,o,i,s,a,l,u,c,_,d){var h,p,f,m;return m=r.assert,f=o._,h=function(){function r(t,r){return this.user_id=t,null==r&&(r=null),this.service_was_connected=e(this.service_was_connected,this),this.service_is_connected=e(this.service_is_connected,this),this.has_unconnected_services=e(this.has_unconnected_services,this),this.has_connected_services=e(this.has_connected_services,this),this.connected_accounts_for_service=e(this.connected_accounts_for_service,this),this.get_or_update_connected_state=e(this.get_or_update_connected_state,this),this._update_on_auth_event=e(this._update_on_auth_event,this),m(this.user_id,"No user id provided"),this._connected_services={},this.is_updated=!1,this.get_or_update_connected_state(!0,r),this._service_change_callbacks={},n(document).on("db:profile_service:auth_complete",this._update_on_auth_event),n(document).on("db:profile_service:deauth_complete",this._update_on_auth_event),this}return r._LINKED_PROFILE_SERVICES={},r.get_linked_profile_services_for_user=function(e,t){var n;return null==t&&(t=null),m(e,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()"),n=this._LINKED_PROFILE_SERVICES[e],null!=n?n.get_or_update_connected_state(!1,t):(n=new r(e,t),this._LINKED_PROFILE_SERVICES[e]=n),n},r.prototype._update_on_auth_event=function(e){var t,n,r,o;if(e.user_id===this.user_id){this.is_updated=!1,this.get_or_update_connected_state(!0),r=this._service_change_callbacks,o=[];for(n in r)t=r[n],o.push(t(this));return o}},r.prototype.get_or_update_connected_state=function(e,t){return null==e&&(e=!1),null==t&&(t=null),this.is_updated&&!e?"function"==typeof t?t(this):void 0:a.BackgroundRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:function(e){return function(n,r,o){return e._connected_services=n,e.is_updated=!0,"function"==typeof t?t(e):void 0}}(this)})},r.prototype.connected_accounts_for_service=function(e){return this._connected_services[e]?n.map(this._connected_services[e],function(e){return e.source_id}):[]},r.prototype.has_connected_services=function(){var e,t,n,r;for(n=l.services(),e=0,t=n.length;t>e;e++)if(r=n[e],this.service_is_connected(r))return!0;return!1},r.prototype.has_unconnected_services=function(e){var t,n,r,o;for(null==e&&(e=!1),o=l.services(),e&&(o=l.contact_services()),t=0,n=o.length;n>t;t++)if(r=o[t],r!==l.YAHOO_LEGACY&&!this.service_is_connected(r))return!0;return!1},r.prototype.service_is_connected=function(e){var n,r,o,i;if(m(t.call(l.services(),e)>=0,"Not a valid profile service"),null==this._connected_services[e])return!1;for(i=this._connected_services[e],r=0,o=i.length;o>r;r++)if(n=i[r],n.connection_state===l.IS_CONNECTED)return!0;return!1},r.prototype.service_was_connected=function(e){var n,r,o,i;if(m(t.call(l.services(),e)>=0,"Not a valid profile service"),null==this._connected_services[e])return!1;for(i=this._connected_services[e],r=0,o=i.length;o>r;r++)if(n=i[r],n.connection_state===l.WAS_CONNECTED)return!0;return!1},r.prototype.register_for_service_changes=function(e,t){return this._service_change_callbacks[e]=t},r.prototype.unregister_for_service_changes=function(e){return t.call(Object.keys(this._service_change_callbacks),e)>=0?delete this._service_change_callbacks[e]:void 0},r}(),p=function(){function r(){return this.deauth_service=e(this.deauth_service,this),this._redirect_to_identity_provider=e(this._redirect_to_identity_provider,this),this._popup_window=null,this}return r.show_import_notifications=function(e){if(!e.success)return null!=e.err_msg?i.error(e.err_msg):i.error(f("There was a problem completing this request."));switch(e.provider){case l.GOOGLE:return i.success(f("Imported Gmail Contacts."));case l.YAHOO:return i.success(f("Imported Yahoo! Mail contacts."));case l.FACEBOOK:return i.success(f("Successfully connected to Facebook."))}},r.prototype._redirect_to_identity_provider=function(e,t,r,o,i,a,u){var c,_,h;return null==r&&(r=null),null==o&&(o=null),null==i&&(i=null),null==a&&(a=!1),null==u&&(u=!0),c=function(e){return function(t){var r;return e._popup_window===t.popup_window?(n(document).off("db:profile_service:auth_complete",c),null!=(r=e._popup_window)&&r.close(),e._popup_window=null,"function"==typeof o?o(t):void 0):void 0}}(this),n(document).on("db:profile_service:auth_complete",c),_="/profile_services/redirect_to_identity_provider",h={user_id:r,service:e,is_popup:u,referrer:i,action:t,remember_me:a,prompt_select:!0},u?this._popup_window=window.open(String(s({path:_,query:h})),l.to_name(e),"width=600,height=600,resizable=1,scrollbars=1"):d.redirect(String(s({path:_,query:h})))},r.prototype.auth_service_with_user=function(e,t,n,r){var o;return null==n&&(n=null),null==r&&(r=null),m(e,"No service provided"),m(t,"No user_id provided"),o=c.get_viewer().get_user_by_id(t),m(o,"No user for user_id "+t),this._redirect_to_identity_provider(e,"link_contacts",t,n,r)},r.prototype.auth_service_create_user_if_needed=function(e,t,n,r){return null==t&&(t=null),null==n&&(n=null),null==r&&(r=!0),m(e,"No service provided"),this._redirect_to_identity_provider(e,"create_user",null,t,n,null,r)},r.prototype.auth_service_login_user=function(e,t,n,r){return null==t&&(t=null),null==n&&(n=null),null==r&&(r=!1),m(e,"No service provided"),this._redirect_to_identity_provider(e,"login_user",null,t,n,r)},r.prototype.deauth_service=function(e,r,o,i){var s,u;return null==o&&(o=null),null==i&&(i=null),u=function(s){return function(s){return s.service_is_connected(e)?(null!=o&&m(t.call(s.connected_accounts_for_service(e),o)>=0,"Service is not currently connected"),a.WebRequest({url:"/profile_services/unlink",subject_user:r,data:{service:e,source_id:o},success:function(e,t,o){return n(document).trigger(n.Event("db:profile_service:deauth_complete",{user_id:r})),"function"==typeof i?i(!0):void 0},error:function(e,t,n){return"function"==typeof i?i(!1):void 0}})):void("function"==typeof i&&i(!0))}}(this),m(t.call(l.services(),e)>=0,"Not a valid profile service"),m(r,"No user_id provided"),r=parseInt(r),s=h.get_linked_profile_services_for_user(r,u)},r}(),{LinkedProfileServices:h,ProfileServicesLinkingHandler:p}})}.call(this),function(){define("modules/clean/profile_services/third_party_signup",["jquery","modules/clean/ajax","modules/clean/base64","modules/constants/env","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,r,o,i,s,a,l,u){var c,_,d;return d=a._,c=function(){function e(){}return e.download_picture=function(e,t){var n;if(null!=e&&e.length>0)try{return n=new XMLHttpRequest,n.open("GET",e,!0),n.responseType="blob",n.onload=function(){var e,r;return 200===n.status&&(e=n.getResponseHeader("content-type")||"",r=new Blob([n.response],{type:e}),null!=t)?t(r):void 0},n.send()}catch(e){}else if(null!=t)return t(null)},e.upload_account_picture=function(e,t,n){var i,a,l;return null!=t?(a=u({authority:r.BLOCK_CLUSTER,path:"/upload_account_photo",query:{t:s.read(o.JS_CSRF_COOKIE),_subject_uid:e}}),i=new FormData,i.append("file",t),l=new XMLHttpRequest,l.open("POST",a,!0),l.withCredentials=!0,null!=n&&(l.onload=function(){return n()},l.onerror=function(){return n()}),l.send(i)):void 0},e}(),_=function(){function t(){}return t.init=function(e,t,n){return this.handle_picture_url(e,t,n,!0)},t.handle_picture_url=function(t,n,r,o){var s,a;return s=null,a=function(t){return null!=t?(e("#profile-picture img").attr("src",URL.createObjectURL(t)),e("#profile-picture").show(),s=t):void 0},c.download_picture(t,a),e(document).on("db:register:success",function(e){return function(e,t){var a;return a=function(){var e,s;return o?(l.success(d("Registration successful! Your browser will be redirected in a few seconds.")),s=u.parse(t.redirect_url||"/"),n&&(s=u.parse(n)),e={success:!0},r&&(e.extra_data=r),s.setQuery(e),i.unsafeRedirect(s)):void 0},null!=s?c.upload_account_picture(t.id,s,a):a()}}(this))},t}(),{PictureURLHandler:c,ThirdPartySignup:_}})}.call(this),function(){define("modules/clean/react/button",["external/classnames","external/react","external/underscore"],function(e,t,n){var r,o,i;return i=t.DOM,r=t.createClass({displayName:"button",propTypes:{importance:t.PropTypes.string,variant:t.PropTypes.string,disabled:t.PropTypes.bool,className:t.PropTypes.string},render:function(){var t,r,o,s;return s=this.props.importance||"primary",o={},o["button-"+s]=!0,o["button-"+this.props.variant]=null!=this.props.variant&&"standard"!==this.props.variant,null!=this.props.className&&(o[this.props.className]=!0),r=n.clone(this.props),r.className=e(o),t=i.button(r,this.props.children)}}),o=t.createClass({displayName:"link_button",propTypes:{importance:t.PropTypes.string,variant:t.PropTypes.string,disabled:t.PropTypes.bool,className:t.PropTypes.string},render:function(){var t,r,o,s;return s=this.props.importance||"primary",o={},o["button-"+s]=!0,o["button-"+this.props.variant]=null!=this.props.variant&&"standard"!==this.props.variant,null!=this.props.className&&(o[this.props.className]=!0),r=n.clone(this.props),r.className=e(o),t=i.a(r,this.props.children)}}),{button:r,link_button:o,Button:r,LinkButton:o}})}.call(this),function(){define("modules/clean/react/css",["external/react","external/underscore","modules/clean/css","modules/clean/js_environment"],function(e,t,n,r){var o,i,s;return i=e.createElement,o={LOADING:"loading",SUCCESS:"success",FAILED:"failed",FORCE_RENDERED:"force-rendered"},s=function(s,a,l){var u,c,_,d,h,p,f,m,g,v,y,w,b,x,E;for(null==l&&(l=[]),m=null!=(x=s.displayName)?x:"UnnamedComponent",E="Css("+m+")",h={},f=0,y=a.length;y>f;f++)p=a[f],h[p]=!0;for(g=0,w=l.length;w>g;g++)if(u=l[g],_="function"==typeof u.getCombinedCssPaths?u.getCombinedCssPaths():void 0,(null!=_?_.length:void 0)>0)for(v=0,b=_.length;b>v;v++)c=_[v],h[c]=!0;return d=Object.keys(h),e.createClass({displayName:E,statics:{getCombinedCssPaths:function(){return d},wrappedClass:s},propTypes:{cssPlaceholder:e.PropTypes.node,onCssFail:e.PropTypes.func,onCssLoad:e.PropTypes.func,skipCssInTest:e.PropTypes.bool},getDefaultProps:function(){return{cssPlaceholder:null,onCssFail:function(e){return e()},onCssLoad:null,skipCssInTest:!0}},getInitialState:function(){var e;return e=r.isTest()&&this.props.skipCssInTest||n.is_loaded(d)?o.FORCE_RENDERED:o.LOADING,{cssMode:e}},componentWillMount:function(){return this._isMounted=!0,this.state.cssMode===o.LOADING?n.require_css_multi(d,this._handleCssLoaded,this._handleCssFailed):void 0},componentWillUnmount:function(){return this._isMounted=!1},render:function(){var e;return(e=this.state.cssMode)===o.FORCE_RENDERED||e===o.SUCCESS?i(s,t.extend({ref:"wrapped"},this.props),this.props.children):this.props.cssPlaceholder},getWrappedComponent:function(){return this.refs.wrapped},_handleCssLoaded:function(){return this._isMounted?this.setState({cssMode:o.SUCCESS},function(e){return function(){var t;return"function"==typeof(t=e.props).onCssLoad?t.onCssLoad():void 0}}(this)):void 0},_handleCssFailed:function(){return this._isMounted?this.setState({cssMode:o.FAILED},function(e){return function(){var t;return"function"==typeof(t=e.props).onCssFail?t.onCssFail(e._forceRender):void 0}}(this)):void 0},_forceRender:function(){return this.setState({cssMode:o.FORCE_RENDERED})}})}})}.call(this),function(){define("modules/clean/react/form_error_mixin",["external/react","external/underscore"],function(e,t){var n,r;return r=e.DOM,n={propTypes:{errorWrapperClassName:e.PropTypes.string,errorWrapperIdName:e.PropTypes.string,"disable-errors":e.PropTypes.bool,"error-after":e.PropTypes.bool,error:e.PropTypes.shape({message_text:e.PropTypes.string,message_html:e.PropTypes.string})},getInitialState:function(){return{errorWrapperIdName:this.props.errorWrapperIdName?this.props.errorWrapperIdName:t.uniqueId("error-message")}},renderErrorIfEnabled:function(){return this.props["disable-errors"]?void 0:this.renderError()},renderError:function(){var e,t;return null!=(null!=(e=this.props.error)?e.message_html:void 0)?r.div({id:this.state.errorWrapperIdName,className:this.props.errorWrapperClassName,dangerouslySetInnerHTML:{__html:this.props.error.message_html}}):r.div({id:this.state.errorWrapperIdName,className:this.props.errorWrapperClassName},null!=(t=this.props.error)?t.message_text:void 0)}}})}.call(this),function(){define("modules/clean/react/input",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/sprite","modules/core/browser","require"],function(e,t,n,r,o,i,s,a,l,u){var c,_,d;return c=t.createElement,_=t.DOM,d=function(d,h){return t.createClass({displayName:d+"."+h,propTypes:{expandable:t.PropTypes.bool,expandedWidthOffset:t.PropTypes.number,animationCurve:t.PropTypes.string,animationDuration:t.PropTypes.number,onCloseClick:t.PropTypes.func,defaultValue:t.PropTypes.string,value:t.PropTypes.string,autofocus:t.PropTypes.bool,autoresize:t.PropTypes.bool,inline:t.PropTypes.bool,
className:t.PropTypes.string,valueLink:t.PropTypes.object,variant:t.PropTypes.string,id:t.PropTypes.string,label:t.PropTypes.string,afterRender:t.PropTypes.func,onClick:t.PropTypes.func,onFocus:t.PropTypes.func,onBlur:t.PropTypes.func,onKeyDown:t.PropTypes.func,onChange:t.PropTypes.func,compatiblePlaceholder:t.PropTypes.bool,placeholder:t.PropTypes.string,measureStrength:t.PropTypes.bool,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},mixins:[s],getDefaultProps:function(){return{errorWrapperClassName:"text-input-error-wrapper",expandedWidthOffset:90,expandable:!1,animationCurve:"easeOutSine",animationDuration:300,compatiblePlaceholder:!1}},getInitialState:function(){return{inputWidth:0,expanded:!1,value:this.props.defaultValue,compatiblePlaceholderVisible:this.supportsCompatiblePlaceholder()}},supportsCompatiblePlaceholder:function(){return this.props.compatiblePlaceholder&&this.props.placeholder&&l.msie_version_at_most(9)},render:function(){var t,n,o,i,s,l,p,f,m,g,v,y,w,b,x;if(this.props.measureStrength&&u(["external/zxcvbn"]),i={"text-input-input":!0,autofocus:this.props.autofocus,"password-input":"password"===h},s={"text-input":!0,"text-input-expandable":this.props.expandable,"text-input-inline":this.props.inline,"textarea-input":"textarea"===d},s[this.props.variant||"standard"]=!0,null!=this.props.className)for(v=this.props.className.split(/\s/),p=0,m=v.length;m>p;p++)o=v[p],s[o]=!0;return l=this.renderErrorIfEnabled(),t=void 0,((null!=(y=this.props.error)?y.message_text:void 0)||null!=(null!=(w=this.props.error)?w.message_html:void 0))&&(t=this.state.errorWrapperIdName),n=r.omit(this.props,"className","onChange","onFocus","onKeyDown","value","valueLink","ref","defaultValue"),f=_[d](r.extend({"aria-describedby":t,className:e(i),type:h,value:this.props.value||(null!=(b=this.props.valueLink)?b.value:void 0)||this.state.value,onChange:this.onChangeInternal,onFocus:this.onFocusInternal,onBlur:this.onBlurInternal,onKeyDown:this.onKeyDownInternal,ref:"inputComponent",placeholder:this.props.placeholder||""},n)),g=_.div({className:"password-input-meter",ref:"meter"},_.div({className:"password-input-dot"}),_.div({className:"password-input-dot"}),_.div({className:"password-input-dot"}),_.div({className:"password-input-dot"})),_.div({className:e(s)},this.props["error-after"]?void 0:l,_.div({className:"text-input-wrapper"},this.props.measureStrength?g:void 0,f,this.supportsCompatiblePlaceholder()?_.span({ref:"textInputPlaceholder",className:"text-input-placeholder",style:{display:this.state.compatiblePlaceholderVisible?"block":"none"}},this.props.placeholder):void 0,this.props.expandable?_.a({href:"#",onClick:this.onCloseClick,ref:"closeButton",className:"close-button u-mar-left-xs"},c(a,{group:"web",name:"xclose",alt:""})):void 0,this.props.value||(null!=(x=this.props.valueLink)?x.value:void 0)||this.state.value?void 0:_.label({htmlFor:this.props.id},this.props.label)),this.props["error-after"]?l:void 0)},getValue:function(){return n.findDOMNode(this.refs.inputComponent).value},setValue:function(e){return n.findDOMNode(this.refs.inputComponent).value=e,this.setState({value:e})},resizeComponent:function(){var e,t;return t=n.findDOMNode(this.refs.inputComponent),e=o(t),e.css("height","1px"),e.css("height",t.scrollHeight+"px")},_renderFinished:function(){var e,t,r;return this.props.autoresize&&this.resizeComponent(),"function"==typeof(e=this.props).afterRender&&e.afterRender(),this.state.compatiblePlaceholderVisible?(r=o(n.findDOMNode(this.refs.textInputPlaceholder)),t=o(n.findDOMNode(this.refs.inputComponent)),r.css({position:"absolute","font-size":t.css("font-size"),color:"#aaa",left:t.css("padding-left"),top:parseInt(t.css("margin-top"))+t.outerHeight()/2-r.outerHeight()/2}),r.click(function(){return t.focus()})):void 0},componentDidMount:function(){var e;return this._renderFinished(),e=n.findDOMNode(this.refs.inputComponent).offsetWidth,this.setState({inputWidth:e})},componentDidUpdate:function(){return this._renderFinished()},onCloseClick:function(e){var t,r,i;return null!=e&&e.preventDefault(),r=o(n.findDOMNode(this.refs.closeButton)),i=o(n.findDOMNode(this.refs.inputComponent)),r.stop().animate({opacity:0},this.props.animationDuration),i.stop().animate({width:this.state.inputWidth},this.props.animationDuration,this.props.animationCurve),"function"==typeof(t=this.props).onCloseClick&&t.onCloseClick(e),this.setState({expanded:!1}),this.supportsCompatiblePlaceholder()?this.setState({compatiblePlaceholderVisible:!0}):void 0},onChangeInternal:function(e){var t,r;return"function"==typeof(t=this.props).onChange&&t.onChange(e),this.props.value||(this.props.valueLink?this.props.valueLink.requestChange(e.target.value):this.setState({value:e.target.value})),this.supportsCompatiblePlaceholder()&&this.setState({compatiblePlaceholderVisible:0===e.target.value.length}),this.props.measureStrength?(r=o(n.findDOMNode(this.refs.meter)),r.find(".password-input-dot").removeClass("password-input-dot-selected"),r.find(".password-input-dot").slice(4-this._score(e.target.value),4).addClass("password-input-dot-selected")):void 0},_score:function(e){return window.zxcvbn&&e?Math.max(1,zxcvbn(e).score):0},onFocusInternal:function(e){var t,r,i,s,a,l,u;return"function"==typeof(t=this.props).onFocus&&t.onFocus(e),this.props.expandable!==!1?(a=o(e.target),r=o(n.findDOMNode(this.refs.closeButton)),l=this.state.inputWidth,0===l&&(l=n.findDOMNode(this.refs.inputComponent).offsetWidth,this.setState({inputWidth:l})),s=l+this.props.expandedWidthOffset,u=parseInt(a.css("padding-right")),i=s-u+r.width()/2,r.css({left:i}),a.stop().animate({width:s},this.props.animationDuration,this.props.animationCurve,function(e){return function(){return r.stop().animate({opacity:1},e.props.animationDuration)}}(this)),this.setState({expanded:!0})):void 0},onBlurInternal:function(e){var t;return"function"==typeof(t=this.props).onBlur?t.onBlur(e):void 0},onKeyDownInternal:function(e){var t;if("function"==typeof(t=this.props).onKeyDown&&t.onKeyDown(e),null!=this.state.expanded!=!1)switch(e.keyCode){case i.ESC:return e.target.blur(),this.onCloseClick()}}})},{password:d("input","password"),text:d("input","text"),textarea:d("textarea","text")}})}.call(this),function(){define("modules/clean/react/locale_selector",["external/react","external/underscore","modules/core/i18n","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/sprite","modules/constants/locales","modules/constants/viewer","modules/core/browser","modules/core/notify","modules/core/uri"],function(e,t,n,r,o,i,s,a,l,u,c,_){var d,h,p,f,m,g,v,y,w;return m=n._,f=i.Modal,w=e.DOM,y=e.createElement,v=function(e,t,n){var o;return null==n&&(n=!1),o=n?"/team/admin/set_locale":"/set_locale",c.success(m("Changing language...")),r.AuthenticatedRequest({url:_({path:o}),data:{locale:e,locale_cont:t},success:function(){return u.redirect(t)}})},p=e.createClass({displayName:"LocaleTag",propTypes:{locale:e.PropTypes.shape({localeCode:e.PropTypes.string.isRequired,localeName:e.PropTypes.string.isRequired,decorator:e.PropTypes.string.isRequired}).isRequired},render:function(){var e;return e=this.props.locale.localeName,""!==this.props.locale.decorator&&(e+=" ["+this.props.locale.decorator+"]"),w.span({"data-locale":this.props.locale.localeCode},e)}}),g=e.createClass({displayName:"LocaleSelectorModal",propTypes:{isTeamAdminSettingsConsole:e.PropTypes.bool.isRequired,shouldAllowInternalLocales:e.PropTypes.bool.isRequired},handleLocaleSelected:function(e){return function(t){return function(n){return n.preventDefault(),f.close(),v(e,u.get_href(),t.props.isTeamAdminSettingsConsole)}}(this)},_renderLocaleList:function(){var e,t;return t=this.props.shouldAllowInternalLocales?a.LIST_OF_LOCALES_WITH_INTERNAL:a.LIST_OF_LOCALES_WITHOUT_INTERNAL,w.div({className:"react-locale-selector-modal"},w.ul({className:"react-locale-selector-modal__list u-unlist u-trim-padding"},function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(this._renderLocale(e));return o}.call(this)))},_renderLocale:function(e){return w.li({},w.button({className:"locale-option button-as-link react-locale-selector-modal__list-item-button",onClick:this.handleLocaleSelected(e.localeCode)},y(p,{locale:e})))},render:function(){return y(f,{ref:"modal",width:550,title:m("Choose a language"),acceptButtonText:null},this._renderLocaleList())}}),h=o(g,["/static/css/components/react_locale_selector-vflhGMsCx.css","/static/css/modal-vflESt9QA.css"]),d=e.createClass({displayName:"LocaleSelector",statics:{showModal:function(e,t){return null==e&&(e=!1),null==t&&(t=!0),f.showInstance(y(h,{isTeamAdminSettingsConsole:e,shouldAllowInternalLocales:t}))}},propTypes:{isTeamAdminSettingsConsole:e.PropTypes.bool,shouldAllowInternalLocales:e.PropTypes.bool},getDefaultProps:function(){return{isTeamAdminSettingsConsole:!1,shouldAllowInternalLocales:!0}},handleLocaleLinkClick:function(e){return e.preventDefault(),f.showInstance(y(h,{isTeamAdminSettingsConsole:this.props.isTeamAdminSettingsConsole,shouldAllowInternalLocales:this.props.shouldAllowInternalLocales}))},_renderLocaleLink:function(){return w.span({id:"locale-link"},y(s,{group:"web",name:"globe_gray_20x20",alt:""}),w.button({className:"button-as-link react-locale-selector-link",title:m("Choose a language"),onClick:this.handleLocaleLinkClick},y(p,{locale:t.find(a.LIST_OF_LOCALES_WITH_INTERNAL,function(e){return e.localeCode===l.USER_LOCALE})}),y(s,{class:"arrow",group:"web",name:"arrow-up-gray",alt:""})))},render:function(){return w.div({id:"locale-container"},this._renderLocaleLink())}}),{LocaleSelector:o(d,["/static/css/components/locale_selector-vflRu24eh.css"])}})}.call(this),function(){define("modules/clean/react/modal",["external/classnames","external/react","external/purify","jquery","modules/core/i18n","modules/core/dom","modules/clean/react/button","modules/clean/keycode"],function(e,t,n,r,o,i,s,a){var l,u,c,_,d,h,p,f;return _=o._,h=s.button,f=t.DOM,p=t.createElement,l="react-modal-root",d=function(e){var t,n;return null==e&&(e=!0),t=l,n=r("#"+t),!n.length&&e&&(n=r("<div />").attr({id:t}).prependTo("body")),n[0]},u=t.createClass({displayName:"Modal",statics:{showInstance:function(e,n){var o;return null==n&&(n=!0),o=d(),n&&(t.unmountComponentAtNode(o),r(o).siblings().not("#accessible-announce").attr("aria-hidden",!0)),t.render(e,o)},close:function(e){var n;n=d(),n&&(t.unmountComponentAtNode(n),r(n).siblings().removeAttr("aria-hidden"),null!=e&&e.focus())},unhide:function(){var e;return e=d(),e?r(e).show():void 0},hide:function(){var e;return e=d(),e?r(e).hide():void 0}},propTypes:{width:t.PropTypes.number,submitting:t.PropTypes.bool,title:t.PropTypes.string,acceptButtonText:t.PropTypes.string,dismissButtonText:t.PropTypes.string,acceptButtonImportance:t.PropTypes.string,additionalButtonsText:t.PropTypes.array,additionalButtonsHandler:t.PropTypes.func,altAction:t.PropTypes.node,headerId:t.PropTypes.string,onAccept:t.PropTypes.func,onDismiss:t.PropTypes.func,onDismissCompleted:t.PropTypes.func,onShow:t.PropTypes.func,buttonComponent:t.PropTypes.element,autoClose:t.PropTypes.bool,clickOutToClose:t.PropTypes.bool,showX:t.PropTypes.bool,showButtonDivider:t.PropTypes.bool,acceptButtonDisabled:t.PropTypes.bool,dismissButtonDisabled:t.PropTypes.bool,autoFocusPrimaryInput:t.PropTypes.bool,style:t.PropTypes.oneOf(["default","clean","simple","lightbox","bare"]),setMaxHeight:t.PropTypes.bool,className:t.PropTypes.string},close:function(){return u.close(this.elementToFocusOnClose)},_invokeCallbackAndClose:function(e,t,n){return null!=e&&"function"==typeof e.call&&e.call(this,t),t.isDefaultPrevented()?void 0:this.props.autoClose||n?this.close():void 0},_dismiss:function(e){var t;this._invokeCallbackAndClose(this.props.onDismiss,e,!0),null!=(t=this.props.onDismissCompleted)&&"function"==typeof t.call&&t.call(this,e)},_accept:function(e){this._invokeCallbackAndClose(this.props.onAccept,e,!1)},_additionalButtonPressed:function(e,t){var n;"function"==typeof(n=this.props).additionalButtonsHandler&&n.additionalButtonsHandler(t,e),this.close()},_onClickOnOverlay:function(e){this.props.clickOutToClose&&this._dismiss(e)},getDefaultProps:function(){return{acceptButtonText:_("OK"),acceptButtonImportance:"primary",dismissButtonText:null,buttonComponent:null,headerId:"db-modal-title",onAccept:function(){},onDismiss:function(){},onShow:function(){},autoClose:!0,clickOutToClose:!0,style:"default",showX:!0,acceptButtonDisabled:!1,dismissButtonDisabled:!1,autoFocusPrimaryInput:!0}},_focus:function(){var e,t,n,o,i,s;return this.elementToFocusOnClose=document.activeElement,e=r(this.refs.modal.getDOMNode()),this.props.autoFocusPrimaryInput&&(t=e.find("input:not(:disabled)").first(),n=r(null!=(i=this.refs.primaryButton)?i.getDOMNode():void 0),o=r(null!=(s=this.refs.tertiaryButton)?s.getDOMNode():void 0),t.length?e=t:n.length&&!n.is(":disabled")?e=r(this.refs.primaryButton.getDOMNode()):o.length&&!o.is(":disabled")&&(e=r(this.refs.tertiaryButton.getDOMNode()))),e.focus()},_keyDown:function(e){return e.which===a.ESC&&this._dismiss(e),e.which!==a.BACKSPACE||i.focus_in_input()||(e.preventDefault(),this._dismiss(e)),null!=this.refs.modal?i.keepFocusIn(this.refs.modal.getDOMNode(),e):void 0},_renderButtons:function(){var e,t,n,r,o,i;if(this.props.buttonComponent)return this.props.buttonComponent;if(n=[],this.props.submitting&&n.push(f.span({className:"dbmodal-loading",key:"loading"},f.img({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:_("Loading")}))),this.props.acceptButtonText&&n.push(p(h,{ref:"primaryButton",key:"primary",className:"dbmodal-button",importance:this.props.acceptButtonImportance,disabled:this.props.acceptButtonDisabled,onClick:this._accept},this.props.acceptButtonText)),this.props.dismissButtonText&&n.push(p(h,{ref:"tertiaryButton",key:"tertiary-dismiss",className:"dbmodal-button",importance:"tertiary",disabled:this.props.dismissButtonDisabled,onClick:this._dismiss},this.props.dismissButtonText)),this.props.additionalButtonsText)for(i=this.props.additionalButtonsText,e=r=0,o=i.length;o>r;e=++r)t=i[e],n.push(p(h({ref:"tertiaryButton",key:"tertiary-"+e,className:"dbmodal-button",importance:"tertiary",onClick:this._additionalButtonPressed.bind(this,e)},t)));return n.length?f.div({className:"db-modal-buttons"},this.props.showButtonDivider?f.hr({}):void 0,n):void 0},_renderAltAction:function(){return this.props.altAction?f.div({className:"db-modal__alt-action"},this.props.altAction):void 0},componentDidMount:function(){var e;return r(document).trigger("modalOpened",this),i.scroll_lock_document(),r(this.refs.modal.getDOMNode()).on("keydown",this._keyDown),this._focus(),"function"==typeof(e=this.props).onShow?e.onShow():void 0},componentWillUnmount:function(){return r(document).trigger("modalClosed",this),i.scroll_unlock_document(),r(this.refs.modal.getDOMNode()).off("keydown",this._keyDown)},render:function(){var t,n,r,o;return n={"db-modal-wrapper":!0,"db-modal--clean-style":"clean"===this.props.style,"db-modal--simple-style":"simple"===this.props.style,"db-modal--lightbox-style":"lightbox"===this.props.style,"db-modal--bare-style":"bare"===this.props.style},null!=this.props.className&&(n[this.props.className]=!0),t=e(n),r=this.props.width?{width:this.props.width+"px"}:{},f.div({className:t},f.div({className:"db-modal-overlay",onClick:this._onClickOnOverlay}),f.div({ref:"modal",className:"db-modal",tabIndex:0,style:r,role:"dialog","aria-labelledby":"lightbox"===this.props.style?"":this.props.headerId},f.div({className:"db-modal-box",ref:"modalBox"},"lightbox"===(o=this.props.style)||"bare"===o?f.div({className:"db-modal-"+this.props.style},this.props.children):f.div({},this.props.showX?f.button({className:"db-modal-x",onClick:this._dismiss,"aria-label":_("Close")}):void 0,f.h2({id:"db-modal-title",className:"db-modal-title"},f.div({className:"db-modal-title-text",ref:"title"},this.props.title)),f.div({className:"db-modal-content clearfix",ref:"content"},this.props.children,this._renderButtons(),this._renderAltAction())))))}}),c={show:function(e){var r,o;return o={acceptButtonText:e.confirm_text,onAccept:e.confirm_callback,dismissButtonText:e.cancel_text,onDismiss:e.cancel_callback,onDismissCompleted:e.cancel_completed_callback,title:e.title_text,width:e.width,className:"simple-modal",autoClose:e.autoclose,style:e.style,onShow:e.on_show},r=p(u,o,t.DOM.div({className:"simple-modal-content",dangerouslySetInnerHTML:{__html:n.sanitize(e.body_html)}})),u.showInstance(r)}},{Modal:u,SimpleModal:c,ReactModal:u}})}.call(this),function(){define("modules/clean/react/previews/preview_flippable",["external/react","jquery","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_video","modules/clean/react/sprite","modules/constants/comments_panel","modules/core/i18n","modules/core/uri"],function(e,t,n,r,o,i,s,a,l,u){var c,_,d,h,p,f,m;return d=r.PreviewImage,h=o.PreviewImageWithAnnotations,p=i.PreviewVideo,m=e.DOM,f=l._,c=100,_=e.createClass({statics:{isFlippable:function(e){return"photo"===e||"video"===e}},displayName:"PreviewFlippable",propTypes:{"preview-type":e.PropTypes.oneOf(["photo","video"]),"file-extension":e.PropTypes.string.isRequired,"thumbnail-url-tmpl":e.PropTypes.string.isRequired,"preview-url":e.PropTypes.string,onLoad:e.PropTypes.func,onError:e.PropTypes.func,index:e.PropTypes.number,count:e.PropTypes.number,totalFiles:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,onContextMenu:e.PropTypes.func,"preview-url":e.PropTypes.string,"video-metadata-url":e.PropTypes.string,"file-meta":e.PropTypes.shape({filename:e.PropTypes.string,mtime:e.PropTypes.number,formattedSize:e.PropTypes.string}).isRequired},getDefaultProps:function(){return{onContextMenu:null}},onImageLoad:function(){var e;return null!=(e=this.refs.previewImageWithAnnotations)?e._onImageLoad():void 0},componentWillMount:function(){return this.isImagePreviewAnnotationCreationEnabled=a.ALLOW_ANNOTATION_IMAGE_PREVIEWS},_onPrevious:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_onNext:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},_flipLabelText:function(){var e;return e=this.props.totalFiles===c?"+":"",f("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})+e},_reactElementForPreviewType:function(r){var o,i;switch(r){case"photo":return i={"preview-url":this.props["preview-url"],"file-extension":this.props["file-extension"],"file-meta":this.props["file-meta"],onLoad:this.props.onLoad,onError:this.props.onError,onContextMenu:this.props.onContextMenu},this.isImagePreviewAnnotationCreationEnabled?(i=t.extend(i,{ref:"previewImageWithAnnotations",index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,"should-display-annotations-toolbar":!0,onContextMenu:this.props.onContextMenu}),e.createElement(h,i)):e.createElement(d,i);case"video":return e.createElement(p,{"preview-url":this.props["preview-url"],"thumbnail-url-tmpl":this.props["thumbnail-url-tmpl"],onLoad:this.props.onLoad,index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,shouldDisplayAnnotationsToolbar:this.isImagePreviewAnnotationCreationEnabled});default:return o=this.props["file-meta"],e.createElement(n,{filename:o.filename,created:new Date(1e3*o.mtime),size:o.formattedSize})}},render:function(){return m.div({className:"preview-flip-container"},[this._reactElementForPreviewType(this.props["preview-type"]),this.props.count>1&&!this.isImagePreviewAnnotationCreationEnabled?m.div({className:"flip-controls"},m.button({className:"flip-button-prev",onClick:this._onPrevious},e.createElement(s,{group:"web",name:"s_flip_left",alt:f("Flip left",{comment:"Flip to the previous file in a series of files"})})),m.div({className:"flip-label"},this._flipLabelText()),m.button({className:"flip-button-next",onClick:this._onNext},e.createElement(s,{group:"web",name:"s_flip_right",alt:f("Flip right",{comment:"Flip to the next file in a series of files"})}))):void 0])}}),{PreviewFlippable:_}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/radio",["external/classnames","external/react","modules/clean/teams/prop_types"],function(t,n,r){var o,i,s,a,l,u,c,_;return c=n.DOM,_=n.PropTypes,u=n.addons.cloneWithProps,s={Normal:"normal",Large:"large"},l=Object.keys(s).map(function(e){return s[e]}),a=_.oneOfType([_.string,_.number,_.bool]),i=n.createClass({displayName:"RadioItem",propTypes:{className:_.string,value:a,_radioGroupData:_.shape({variant:_.oneOf(l),name:_.string.isRequired,radioGroupValue:a,onSelect:_.func})},_handleClick:function(){var e;this._isSelected()||(this.refs.input.getDOMNode().focus(),"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value))},_handleChange:function(){var e;"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value)},_getId:function(){return this.props._radioGroupData.name+"_"+this.props.value},_isSelected:function(){return this.props._radioGroupData.radioGroupValue===this.props.value},render:function(){var r,o,i,a;return o=this.props._radioGroupData,a=["c-radio-wrapper",this.props.className],r={"c-radio":!0},i=o.variant,e.call(l,i)>=0&&o.variant!==s.Normal&&(r["c-radio--"+o.variant]=!0),n.createElement("div",{className:t(a),onClick:this._handleClick},n.createElement("input",{id:this._getId(),ref:"input",type:"radio",name:o.name,value:this.props.value,checked:this._isSelected(),onChange:this._handleChange}),n.createElement("div",{className:t(r)},n.createElement("div",{className:"c-radio__inner"})),n.createElement("label",{className:"c-radio-content",htmlFor:this._getId()},this.props.children))}}),o=n.createClass({displayName:"RadioGroup",propTypes:{className:_.string,variant:_.oneOf(l),name:_.string,legend:_.string.isRequired,align:_.oneOf(["top","bottom","middle","baseline"]),displayLegend:_.bool,valueLink:r.valueLink(a).isRequired},getDefaultProps:function(){return{className:null,type:s.Normal,align:"middle",displayLegend:!1}},_onRadioItemSelect:function(e){var t;null!=(t=this.props.valueLink)&&t.requestChange(e)},render:function(){var e,r,o,i,s,a,l;for(o=this.props.name||"radio-"+Math.floor(1e9*Math.random()),l=this.props.children,r=0,s=l.length;s>r;r++)e=l[r],e.props._radioGroupData={variant:this.props.variant,name:o,radioGroupValue:this.props.valueLink.value,onSelect:this._onRadioItemSelect};return i={"c-radio-group__legend":!0,"ax-visually-hidden":!this.props.displayLegend},a=["c-radio-group","align-"+this.props.align,this.props.className],n.createElement("fieldset",{className:t(a)},n.createElement("legend",{className:t(i)},this.props.legend),this.props.children)}}),{RadioGroup:o,RadioItem:i,RadioItemVariant:s}})}.call(this),function(){var e={}.hasOwnProperty,t=[].slice;define("modules/clean/react/react_i18n",["external/purify","external/react","external/underscore","modules/core/i18n","modules/clean/react/util"],function(n,r,o,i,s){var a,l,u,c,_;return u=r.DOM,c=function(t,n){var r,i,s;if(!o.isEmpty(n)){r={};for(i in n)e.call(n,i)&&(s=n[i],r[i]=o.escape(s));t=t.format(r)}return t},l=r.createClass({displayName:"R_",propTypes:function(){return{project:r.PropTypes.string,comment:r.PropTypes.string}},render:function(){var e,t,r,s;if(t=this.props.children,"string"!=typeof t)throw new Error("R_ can only take a single string child");return s=i._(t,{project:this.props.project,comment:this.props.comment}),r=o.omit(this.props,"children","project","comment"),e=c(s,r),u.span({dangerouslySetInnerHTML:{__html:n.sanitize(e)}})}}),a=r.createClass({displayName:"RP_",propTypes:function(){return{n:r.PropTypes.number,project:r.PropTypes.string,comment:r.PropTypes.string}},render:function(){var e,a,l,_;if(a=[],"number"!=typeof this.props.n)throw new Error("RP_ requires a number prop for @props.n, got "+this.props.n);return r.Children.forEach(this.props.children,function(e){return a.push(s.getText(e))}),_=i.ungettext.apply(i,t.call(a).concat([this.props.n],[{project:this.props.project,comment:this.props.comment}])),l=o.omit(this.props,"children","n","project","comment"),e=c(_,l),u.span({dangerouslySetInnerHTML:{__html:n.sanitize(e)}})}}),_=function(e){var n,o;return o=r.createFactory(l),n=r.createFactory(a),{R_:function(){var n,r;return r=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],r.project||(r.project=e),o(r,1===n.length?n[0]:n)},RP_:function(){var r,o;return o=arguments[0],r=2<=arguments.length?t.call(arguments,1):[],o.project||(o.project=e),n(o,1===r.length?r[0]:r)}}},{R_:r.createFactory(l),RP_:r.createFactory(a),setReactI18nDefaultProject:_}})}.call(this),function(){define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/input","modules/core/i18n","modules/clean/react/react_i18n","modules/clean/static_urls"],function(e,t,n,r,o,i,s){var a,l,u,c,_,d,h;return c=o._,l=i.R_,h=s.static_url,a=r.text,d=t.DOM,_=t.createElement,u=t.createClass({displayName:"RecaptchaChallenge",mixins:[n],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard",onInputChange:null}},componentDidMount:function(){var t;return t=this.props.public_key,e.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(t,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return d.div({className:this.props.variant+" recaptcha-buttons"},d.a({className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},d.img({src:h("/static/images/icons/captcha-reload-vflqH90Ce.png")})),d.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},d.img({src:h("/static/images/icons/captcha-audio-vfl_VBPgQ.png")})),d.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},d.img({src:h("/static/images/icons/captcha-words-vfl-bt9Xw.png")})),d.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},d.img({src:h("/static/images/icons/captcha-help-vfleUYtSD.png")})))},_renderRecaptchaResponseInput:function(){return _(a,{id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,placeholder:c("Type the text"),onChange:this.props.onInputChange})},_renderDummyInput:function(){return d.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var e;return e=this.renderErrorIfEnabled(),d.div({id:"recaptcha_widget",className:"standard recaptcha-container"},e,d.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var e;return e=this.renderErrorIfEnabled(),d.div({id:"recaptcha_widget",className:"small recaptcha-container"},e,d.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(){return Recaptcha.reload()}})})}.call(this),function(){define("modules/clean/react/sprite",["external/classnames","external/react","modules/clean/static_urls"],function(e,t,n){var r,o,i,s;return s=n.static_url,i=t.DOM,r=t.PropTypes,o=t.createClass({displayName:"Sprite",propTypes:{group:r.string.isRequired,name:r.string.isRequired,alt:r.string.isRequired,className:r.string,onClick:r.func,onDragStart:r.func,onMouseDown:r.func,title:r.string,"data-src":r.string},getDefaultProps:function(){return{onClick:function(){},onDragStart:function(){},onMouseDown:function(){}}},render:function(){var t;return t=this.props.alt||"",i.img({className:e(["sprite","sprite_"+this.props.group,"s_"+this.props.group+"_"+this.props.name,this.props.className]),src:s("/static/images/icons/icon_spacer-vflN3BYt2.gif"),"data-src":this.props["data-src"],onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown,alt:t,title:this.props.title})}})})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/util",["external/react","external/underscore","external/rsvp"],function(n,r,o){var i,s,a,l,u;return i=o.Promise,s=function(e){var t;return"string"==typeof e?e:"string"==typeof e.props?e.props:e.props.text?e.props.text:(t=[],n.Children.forEach(e.props.children,function(e){return t.push(s(e))}),t.join(""))},l=function(e,t,r){var o,i;return t(e)?r(e):(o=!1,i=[],n.Children.forEach(e.props.children,function(e){return function(e){var n;return n=l(e,t,r),i.push(n),n!==e?o=!0:void 0}}(this)),o?n.addons.cloneWithProps(e,{children:i}):e)},a=function(){var n,r,o,i,s,a,l,u;for(n=1<=arguments.length?e.call(arguments,0):[],a={},r=[],o=0,s=n.length;s>o;o++){l=n[o];for(i in l)t.call(l,i)&&(u=l[i],"className"===i?r.push(u):a[i]=u)}return null!=r.length&&(a.className=r.join(" ")),a},u=function(e,t){return new i(function(n,r){return e.setState(t,n)})},{getText:s,mergeProps:a,replaceSubtree:l,setStatePromise:u}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/register_form",["jquery","external/cyfd","external/underscore","modules/clean/abuse/event_watcher","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/em_string","modules/clean/form_util/name_parser","modules/clean/mailcheck","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/constants/login_and_register","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,n,r,o,i,s,a,l,u,c,_,d,h,p,f,m,g){var v,y,w,b,x,E;return v=d.ProfileServicesLinkingHandler,b=f._,h.SPECTER_TELEMETRY_COLLECTION&&(E=o.getInstance(),E.start()),x=function(){return n.cfsubmit()},w=function(){function e(e,n,r){var o;this.$form=t(n),this.$captcha_component=new s(this.$form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_business_signup_captcha","email",e),r&&(o={message_text:r}),this.$captcha_component.captcha_display_handler(o),this.$form.on("submit",function(e){return function(e){return x()}}(this))}return e}(),y=function(){function n(r,o,i,u,d,h,f,y){var w,x,E,S,T,C;this.$register_form_container=r,this.can_redirect=i,this.show_form=u,this.client_side_validation=d,this.custom_error_handler=h,this.combined_name=f,this.last_name_goes_first=y,this._combined_name_handler=e(this._combined_name_handler,this),this._index_error_handler=e(this._index_error_handler,this),this._animate_form=e(this._animate_form,this),this._on_register_error=e(this._on_register_error,this),this._on_register_success=e(this._on_register_success,this),this._before_submit=e(this._before_submit,this),this.$register_form=this.$register_form_container.find(".register-form"),S={client_side_validation:this.client_side_validation,error_handler:!1},"index"===this.custom_error_handler&&(S.error_handler=this._index_error_handler,this.$register_form.on("click change","input",this._index_clear_error_handler)),this.register_controller=new a(this.$register_form,this._before_submit,S),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button, .auth-google").prop("disabled",!1),this.$register_form.find(".login-button.disabled-button").prop("disabled",!0),
this.$captcha_component=new s(this.$register_form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",o),w=this.$register_form.find("label[for='tos_agree']"),E=parseInt(w.css("font-size")),C=200,new l(w.text()).length*E>C&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(a.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(a.ERROR_EVENT,this._on_register_error),this.show_form?(x=this.$register_form.find("input[type='hidden'][name='is_third_party_auth']").val(),x&&(T=function(e,n){return!t(n).val()},this.$register_form_container.find("input").filter(":visible").filter(T).first().focus()),this.$register_form.is(":visible")&&this.$captcha_component.captcha_display_handler()):this.$register_form.find(".login-button").on("click",function(e){return function(t){return e.$register_form_container.hasClass("form_shown")?void 0:(t.preventDefault(),e._animate_form())}}(this)),this.$register_form.find(".auth-google").click(function(e){return function(r){var o,i,s;return o=function(r){var o;return r.success?(o={fname:r.profile.given_name,lname:r.profile.family_name,email:r.profile.email,picture_url:r.profile.picture_url,email_sig:r.email_sig,refresh_token:r.refresh_token,extra_data:r.extra_data,signup_tag:e.$register_form.find("input[type='hidden'][name='signup_tag']").val(),cont:e.$register_form.find("input[type='hidden'][name='cont']").val(),k:e.$register_form.find("input[type='hidden'][name='k']").val(),eh:e.$register_form.find("input[type='hidden'][name='eh']").val()},e.$register_form.trigger(n.NEW_ACCOUNT_FROM_3RD_PARTY,o),e.can_redirect?p.redirect(g({path:"/third_party_signup",query:o})):void 0):"user_exists"===r.err_msg?(m.error(b("This email address is already taken. Please sign in.")),r=t.Event(n.USER_EXISTS,{focus:"input[name=login_password]",prefill:{".login-email":r.profile.email,"input[type='hidden'][name=refresh_token]":r.refresh_token,"input[type='hidden'][name=email_sig]":r.email_sig}}),t(e.$register_form).trigger(r)):m.error(b("Sorry, we couldnt link to Google. Please refresh the page to try again."))},s="true"===r.target.getAttribute("data-third-party-no-popup"),i=new v,i.auth_service_create_user_if_needed(_.GOOGLE,o,"register_form",!s)}}(this)),"small"===o?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new c(this.$register_form.find(".input-email"),this.$register_form.find(".email-suggestion"),{livecheck:!1})}return n.REGISTER_SUCCESS="db:register:success",n.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",n.USER_EXISTS="db:register:user_exists",n.prototype._before_submit=function(){return this.combined_name===!0&&this._combined_name_handler(),x(),h.SPECTER_TELEMETRY_COLLECTION?this.register_controller.add_additional_data({specter_signup_tm:E.toJSON()}):void 0},n.prototype._on_register_success=function(e,t){if(this.$register_form.trigger(n.REGISTER_SUCCESS,t),this.can_redirect){if(this.cont)return p.redirect(this.cont);if(t.redirect_url)return p.redirect(t.redirect_url)}},n.prototype._on_register_error=function(e,t){return this.$captcha_component.captcha_display_handler(null!=t?t.recaptcha_response:void 0)},n.prototype._animate_form=function(){return this.$register_form_container.hasClass("form_shown")?void 0:t.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done(function(e){return function(){return e.$register_form_container.addClass("form_shown"),e.$register_form_container.filter(":input").filter(":visible").first().focus(),e.$captcha_component.captcha_display_handler()}}(this))},n.prototype.fill=function(e){return r.each(e,function(e){return function(t,n){return e.$register_form.find("[name="+n+"]").val(t)}}(this))},n.prototype._index_error_handler=function(e){var n,r,o,i;this.$register_form_container.find(".register-form__errors").remove(),n=t("<ul />").addClass("register-form__errors");for(o in e)r=e[o],i=r.message_text||r.message_html,t("<li />").addClass("register-form__error").html(i).appendTo(n),this.$register_form.find(".input-"+o).addClass("text-input--error"),"tos_agree"===o&&this.$register_form.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combined_name&&"fname"===o&&(this.$register_form.find(".input-fullname").addClass("text-input--error"),this.$register_form.find("input[name='fullname']").addClass("input-error")),this.$register_form.find("input[name='"+o+"']").addClass("input-error");return this.$register_form_container.append(n)},n.prototype._index_clear_error_handler=function(e){var n;return n=t(e.target),n.removeClass("input-error"),"checkbox"===n.attr("type")?n.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):n.parents(".text-input--error").removeClass("text-input--error")},n.prototype._combined_name_handler=function(){var e,t,n,r,o,i;if(e=this.$register_form_container.find('input[name="fullname"]'),t=this.$register_form_container.find('input[name="fname"]'),n=this.$register_form_container.find('input[name="lname"]'),o=u.splitFullName(e.val()),r=o[0],i=o[1],this.last_name_goes_first!==!0){if(t.val(r),void 0!==i&&i!==r)return n.val(i)}else if(n.val(r),void 0!==i&&i!==r)return t.val(i)},n}(),{RegisterNamesAndCredentialsWithCaptcha:w,RegisterForm:y}})}.call(this),function(){define("modules/clean/search/search_type",function(){var e;return e={COMPLETION:"completion",DELETED:"deleted",FULLTEXT:"full-text"}})}.call(this),function(){define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(e,t){var n;return n=function(){function n(){e("#broken-share-article").on("click",function(){return t.WebRequest({url:"/shared_link_error_log",data:{evt:r}})})}var r;return r="click-sharing-article",n}()})}.call(this),function(){define("modules/clean/sharing/shared_content_link_sync_modal",["external/classnames","external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/filepath","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/clean/viewer","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,r,o,i,s,a,l,u,c,_,d,h,p,f){var m,g,v,y,w,b,x,E,S;return v=n.ShareTibEventLogger,b=i.button,m=s.File,g=a.Modal,S=c.static_url,w=p.i18n_default_project("sharing")._,E=t.DOM,x=t.createElement,y=t.createClass({statics:{showInstance:function(e){return g.showInstance(e)}},displayName:"SharedContentLinkSyncModal",ASK:"ask",ASKING:"asking",propTypes:{accessLevel:t.PropTypes.string.isRequired,folderName:t.PropTypes.string.isRequired,folderSize:t.PropTypes.string.isRequired,syncSharedFolderCallback:t.PropTypes.func.isRequired,previewCallback:t.PropTypes.func,outOfQuotaQP:t.PropTypes.string,ownerName:t.PropTypes.string,senderName:t.PropTypes.string,usageRemaining:t.PropTypes.string,usageShortage:t.PropTypes.string,targetFile:t.PropTypes.instanceOf(m),syncNSId:t.PropTypes.string},getInitialState:function(){return{state:this.ASK}},componentWillMount:function(){var e,t,n,r;return n=d.start_time(),e=(new Date).getTime(),r=_.get_viewer().get_users()[0].id,t="SYNC_MODAL",v.log(r,"SYNC_MODAL_RENDER",t,{timing:e-n,ns_id:this.props.syncNSId})},_renderTopPanelIcon:function(){return this.props.targetFile?x(l,{alt:"",group:"web",name:this.props.targetFile.icon}):x(l,{alt:"",group:"web",name:"folder_user_32"})},_renderTopPanelTitle:function(){return this.props.targetFile?r.em_snippet(o.filename(this.props.targetFile.fq_path,15)):r.em_snippet(this.props.folderName,15)},_renderTopPanelSubtitle:function(){return this.props.targetFile?null!=this.props.ownerName?w("Owned by %(name)s").format({name:this.props.ownerName}):w("Not currently owned"):this.props.folderSize},_renderAccessText:function(){return E.div({className:"content-link-sync-modal__access-text"},this.props.outOfQuotaQP?w("Not enough space"):null!=this.props.senderName?"can_view"===this.props.accessLevel?w("%(name)s gave you access to view this folder").format({name:this.props.senderName}):w("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):w("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder"))},_renderSharedFolderInfo:function(){return E.div({className:"content-link-sync-modal__shared-folder-info"},E.div({className:"content-link-sync-modal__shared-folder-text"},w("This file is part of a shared folder:")),E.div({},x(l,{alt:"",group:"web",name:"folder_user_32"})),E.p({className:"u-font-meta"},this.props.folderName,E.br({}),this.props.folderSize))},_renderTipBody:function(){return this.props.outOfQuotaQP?this.props.usageRemaining?w("To add this folder, youll need %(shortage)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:this.props.usageRemaining,shortage:this.props.usageShortage}):w("To add this folder, youll need %(shortage)s of space in your Dropbox. You currently have no space left.").format({shortage:this.props.usageShortage}):this.state.state===this.ASKING?E.img({src:S("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:w("Loading")}):w("can_view"===this.props.accessLevel?this.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":this.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first.")},render:function(){return x(g,{autoClose:!1,buttonComponent:this.renderButtons(),className:"content-link-sync-modal",clickOutToClose:!1,ref:"modal",showX:!1,title:""},E.div({className:"content-link-sync-modal__content u-mar-bottom-xs"},E.div({className:"content-link-sync-modal__top-panel u-pad-s"},E.div({className:"content-link-sync-modal__icon"},this._renderTopPanelIcon()),E.div({className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},E.h3({className:"u-font-strong"},this._renderTopPanelTitle()),E.h4({className:"u-trim-margin u-font-meta"},this._renderTopPanelSubtitle())),E.div({className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},x(u,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)}))),E.div({className:"content-link-sync-modal__tip-panel"},this.props.targetFile?this._renderSharedFolderInfo():this._renderAccessText(),E.div({className:"content-link-sync-modal__tip-body"},this._renderTipBody()))))},renderButtons:function(){var e;return E.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},x(b,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},w(this.props.outOfQuotaQP?"Upgrade to add folder":this.props.targetFile?"Add folder to Dropbox":"Add to Dropbox")),"can_view"===this.props.accessLevel?E.div({},E.span({className:"content-link-sync-modal__or"},w("Or")),E.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},w((null!=(e=this.props.targetFile)?e.is_dir:void 0)===!1?"preview this file":"preview this folder"))):void 0)},onSyncButtonClicked:function(){return this.setState({state:this.ASKING}),this.props.outOfQuotaQP?h.redirect(f({path:"/pro/buy"}).updateQuery({oqa:this.props.outOfQuotaQP})):this.props.syncSharedFolderCallback()},onPreviewButtonClicked:function(){var e;return null!=this.props.previewCallback?this.props.previewCallback():(e=h.get_uri().removeQuery("sm"),e.updateQuery({from_sync_modal:!0}),h.redirect(e))}})})}.call(this),function(){define("modules/clean/sharing/wizard/share_a_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/radio","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,r,o,i,s,a,l){var u,c,_,d,h,p,f,m,g,v,y;return y=n.text,u=r.Modal,d=o.RadioGroup,h=o.RadioItem,p=o.RadioItemVariant,c=l.ROLE_PERSONAL,_=l.ROLE_WORK,g=e.createElement,v=e.DOM,m=i.i18n_default_project("sharing")._,f=e.createClass({displayName:"ShareAFolderWizardModal",propTypes:{onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{option:"new-folder"}},render:function(){return g(u,{autoClose:!1,className:"shared-folder-wizard",buttonComponent:v.span(),title:function(){switch(this.props.user.role){case _:return m("Share a folder from your %(team_name)s Dropbox").format({team_name:a.get_viewer().team_name});case c:return m("Share a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return v.form({className:"shared-folder-wizard__contents",onSubmit:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},this._renderHeader(),this._renderRadio(),this._renderButtons())},_renderHeader:function(){return v.div({className:"shared-folder-wizard__header u-mar-bottom-s"},m("What would you like to do?"))},_renderRadio:function(){var e;return e={value:this.state.option,requestChange:this._handleChange},v.div({className:"radio-input"},g(d,{variant:p.Normal,legend:m("Share a Folder options"),displayLegend:!1,valueLink:e},this._renderRadioItems()))},_renderRadioItems:function(){var e,t;return t=g(h,{className:"u-pad-m",value:"new-folder",key:"new-folder-option"},v.div({className:"new-folder_title u-l-ib u-pad-left-xxs"},m("Id like to create and share a new folder"))),e=g(h,{className:"u-pad-m",value:"existing-folder",key:"existing-folder-option"},v.div({className:"existing-folder_title u-l-ib u-pad-left-xxs"},m("Id like to share an existing folder"))),[t,e]},_handleChange:function(e){return this.setState({option:e})},_renderButtons:function(){return v.div({className:"u-mar-top-m clearfix"},v.div({className:"u-l-fr"},v.button({className:"c-btn c-btn--primary",onClick:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},m("Next"))))}}),f=t(f,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareAFolderWizardModal:f}})}.call(this),function(){define("modules/clean/sharing/wizard/share_existing_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/tree_view","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,r,o,i,s,a,l){var u,c,_,d,h,p,f,m,g;return g=n.text,c=r.Modal,u=o.FolderTreeView,_=l.ROLE_PERSONAL,d=l.ROLE_WORK,f=e.createElement,m=e.DOM,p=i.i18n_default_project("sharing")._,h=e.createClass({displayName:"ShareExistingFolderWizardModal",propTypes:{onBack:e.PropTypes.func,onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{folderPath:null,errorMsg:null}},render:function(){return f(c,{autoClose:!1,className:"existing-shared-folder-wizard",buttonComponent:m.span(),onDismissCompleted:function(){return c.close()},title:function(){switch(this.props.user.role){case d:return p("Choose a folder from your %(team_name)s Dropbox").format({team_name:a.get_viewer().team_name});case _:return p("Choose a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return m.form({className:"existing-shared-folder-wizard__contents",onSubmit:function(e){return function(){return e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},this._renderError(),this._renderTreeView(),this._renderButtons())},_renderError:function(){var e;return null!=this.state.folderPath&&(null!=(e=this.state.errorMsg)?e.length:void 0)>0?m.div({className:"text-input-error-wrapper"},m.div({className:"text-input-error-text u-font-danger"},this.state.errorMsg)):void 0},_renderTreeView:function(){return m.div({className:"wizard-tree-view"},f(u,{user:this.props.user,onFolderSelected:this._setFolderPath}))},_renderButtons:function(){return m.div({className:"u-mar-top-m clearfix"},m.div({className:"u-l-fr"},m.button({className:"c-btn c-btn--primary",disabled:!this._isValid(),onClick:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},p("Next"))),m.div({className:"u-l-fl"},m.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:function(e){return function(t){var n,r;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),c.close(),"function"==typeof(r=e.props).onBack?r.onBack():void 0}}(this)},p("Back"))))},_setFolderPath:function(e){return this.setState({folderPath:e,errorMsg:null})},_setError:function(e){var t;return this.setState({errorMsg:null!=e&&null!=(t=e.path)?t.message_text:void 0})},_isValid:function(){return null!=this.state.folderPath&&null==this.state.errorMsg}}),h=t(h,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareExistingFolderWizardModal:h}})}.call(this),function(){define("modules/clean/sharing/wizard/share_new_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,r,o,i,s,a){var l,u,c,_,d,h,p,f;return f=n.text,l=r.Modal,u=a.ROLE_PERSONAL,c=a.ROLE_WORK,h=e.createElement,p=e.DOM,d=o.i18n_default_project("sharing")._,_=e.createClass({displayName:"ShareNewFolderWizardModal",propTypes:{onBack:e.PropTypes.func,onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{newFolderName:"",errorMsg:""}},render:function(){return h(l,{autoClose:!1,className:"new-shared-folder-wizard",buttonComponent:p.span(),onDismissCompleted:function(){return l.close()},title:function(){switch(this.props.user.role){case c:return d("Create a shared folder in your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name});case u:return d("Create a shared folder in your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return p.form({className:"new-shared-folder-wizard__contents",onSubmit:function(e){return function(){return e.props.onSubmit(e.state.newFolderName,e._setError)}}(this)},this._renderHeader(),this._renderInput(),this._renderButtons())},_renderHeader:function(){return p.div({},d("What is the name of your new shared folder?"))},_renderInput:function(){return p.div({className:"text-input"},this._renderError(),p.div({className:"text-input-wrapper"},h(f,{label:d("New folder name"),onChange:this._handleChange})))},_renderButtons:function(){return p.div({className:"u-mar-top-m clearfix"},p.div({className:"u-l-fr"},p.button({type:"submit",className:"c-btn c-btn--primary",disabled:!this._isValid(),onClick:function(e){return function(t){var n;t.preventDefault(),"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.newFolderName,e._setError)}}(this)},d("Next"))),p.div({className:"u-l-fl"},p.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:function(e){return function(t){var n,r;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),l.close(),"function"==typeof(r=e.props).onBack?r.onBack():void 0}}(this)},d("Back"))))},_setError:function(e){var t;return this.setState({errorMsg:null!=e&&null!=(t=e.folder_name)?t.message_text:void 0})},_renderError:function(){var e;return this.state.newFolderName.length>0&&(null!=(e=this.state.errorMsg)?e.length:void 0)>0?p.div({className:"text-input-error-wrapper"},p.div({className:"text-input-error"},this.state.errorMsg)):void 0},_handleChange:function(e){return this.setState({newFolderName:e.target.value,errorMsg:""})},_isValid:function(){var e;return this.state.newFolderName.length>0&&!(null!=(e=this.state.errorMsg)?e.length:void 0)>0}}),_=t(_,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareNewFolderWizardModal:_}})}.call(this),function(){define("modules/clean/sprite",["jquery","modules/core/html"],function(e,t){var n;return n={SPACER:"/static/images/icons/icon_spacer-vflN3BYt2.gif",CLASS_PREFIX:"s_",_make_class:function(e,t){return this.CLASS_PREFIX+e+"_"+t},src:function(t,n,r){return this.clear(t),e(t).addClass(this._make_class(n,r))},replace:function(t,n,r,o){return e(t).removeClass(this._make_class(n,r)).addClass(this._make_class(n,o))},clear:function(t){var n;return n=t.className.split(" "),n=e.grep(n,function(e){return function(t){return t&&0!==t.indexOf(e.CLASS_PREFIX)}}(this)),t.className=n.join(" ")},make:function(t,n,r){var o;return r=this._prep_attrs(t,n,r),o=e("<img />",r),o[0]},html:function(e,n,r){var o,i;r=this._prep_attrs(e,n,r),o=["<img "];for(i in r)o.push(i,'="',t._raw_escape(r[i]),'" ');return o.push("/>"),new t(o.join(""))},_prep_attrs:function(e,t,n){var r;return null==n&&(n={}),n.src=n.src||this.SPACER,r=["sprite","sprite_"+e,this._make_class(e,t)],n.class&&r.push(n.class),n.class=r.join(" "),n},_get:function(e){return e.className},_set:function(e,t){return e.className=t,e.src=this.SPACER}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(t){var n;return n=function(){function n(t,n,r){this.$email_input=t,this.show_sso_fn=n,this.hide_sso_fn=r,this._check_sso_state=e(this._check_sso_state,this),this._check_sso_state(),this.$email_input.on("input keyup change",this._check_sso_state)}return n._sso_check_in_flight={},n._sso_check_cache={},n.prototype._check_sso_state=function(){var e,r,o;return o=this.$email_input.val(),r=o.trim(),r.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(e=r.toLowerCase(),e in n._sso_check_cache?this._handle_sso_state(n._sso_check_cache[e]):n._sso_check_in_flight[e]?void 0:(n._sso_check_in_flight[e]=!0,t.WebRequest({url:"/sso_state",data:{email:r},success:function(t){return function(r){return r=JSON.parse(r),delete n._sso_check_in_flight[e],n._sso_check_cache[e]=r.user_sso_state,t.$email_input.val()!==o?t._check_sso_state():t._handle_sso_state(r.user_sso_state)}}(this),error:function(t){return function(){return delete n._sso_check_in_flight[e],t.hide_sso_fn()}}(this)}))):this.hide_sso_fn()},n.prototype._handle_sso_state=function(e){return"required"===e?this.show_sso_fn(!1):"optional"===e?this.show_sso_fn(!0):this.hide_sso_fn()},n}()})}.call(this),function(){define("modules/clean/static_urls",["modules/clean/filepath","modules/constants/env","modules/core/exception","modules/core/uri"],function(e,t,n,r){var o,i,s,a;return s=e.filename_without_extension,i=e.file_extension,o=n.assert,a=function(e){var n,a;return o(0===e.indexOf("/static/"),e+" is not a /static url"),t.IS_PROD||-1!==e.indexOf("-vfl")||(n=s(e),a=i(e,!0),e=a?n+"-vflDEVHASH."+a:n+"-vflDEVHASH"),r({scheme:"https",authority:t.STATIC_CONTENT_HOST,path:e}).toString()},{static_url:a,UrlConstants:{MOXIE_SWF_URL:a("/static/swf/Moxie-vflz978zN.swf")}}})}.call(this),function(){var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/storage",[],function(){var t,n,r;return t=function(){function e(){}return e.storage=void 0,e.get=function(e){return this.storage&&window.JSON?JSON.parse(this.storage.getItem(e)):void 0},e.set=function(e,t){var n,r;if(this.storage&&window.JSON)try{return null===t?this.delete(e):this.storage.setItem(e,JSON.stringify(t))}catch(e){if(n=e,!(n instanceof DOMException&&22===n.code))throw n}},e.delete=function(e){var t;return null!=(t=this.storage)?t.removeItem(e):void 0},e.reset=function(){var e;return null!=(e=this.storage)?e.clear():void 0},e}(),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.storage=function(){try{return window.sessionStorage}catch(e){}}(),n}(t),n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.storage=function(){try{return window.localStorage}catch(e){}}(),n}(t),{SessionStorage:r,LocalStorage:n}})}.call(this),function(){define("modules/clean/teams/modals/suggest_team_invite_modal",["external/react","external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/ajax","modules/clean/contacts/data","modules/clean/contacts/types","modules/clean/teams/limited_team_invite_form","modules/clean/react/modal","modules/clean/react/input","modules/clean/viewer"],function(e,t,n,r,o,i,s,a,l,u,c,_,d){var h,p,f,m,g,v,y,w;return g=r._,m=i.TeamsWebActionsLogger,h=a.Contact,p=c.Modal,v=e.DOM,y=e.PropTypes,w=d.get_viewer(),f=e.createClass({displayName:"SuggestTeamInviteModal",statics:{showIfNeeded:function(n,r){return f.showInviteModal(function(o){return o?f.validateSuggestions(n,function(o){var i;return o.length>0?("function"==typeof r.onCheckCompleted&&r.onCheckCompleted(!0),r=t.extend({},r,{usersSharedOnFolder:n.emails,suggestedUsersToInviteToTeam:o}),i=e.createElement(f,r),p.showInstance(i)):"function"==typeof r.onCheckCompleted?r.onCheckCompleted(!1):void 0}):"function"==typeof r.onCheckCompleted?r.onCheckCompleted(!1):void 0})},validateSuggestions:function(e,t){return s.WebRequest({url:"/team/validate_emails_to_suggest_inviting",data:{emails_to_verify:JSON.stringify(e.emails)},success:function(e){return e=JSON.parse(e),t(e)}})},showInviteModal:function(e){var t;return(null!=(t=w.work_user)?t.is_team:void 0)?f._getShouldShowInviteModalData(function(t){return e(t.isOnLimitedTeam&&!t.hasSeenSuggestTeamInviteModal)}):e(!1)},_getShouldShowInviteModalData:function(e){return s.WebRequest({url:"/team/should_show_invite_modal",success:function(t){return t=JSON.parse(t),e(t)}})}},propTypes:{sharingType:y.string.isRequired,suggestedUsersToInviteToTeam:y.arrayOf(y.string).isRequired,usersSharedOnFolder:y.arrayOf(y.string),teamName:y.string,onDidAccept:y.func,onDidDismiss:y.func,onDidClose:y.func},getDefaultProps:function(){return{onDidAccept:function(){},onDidDismiss:function(){},teamName:w.team_name}},getInitialState:function(){return{canAccept:this.props.suggestedUsersToInviteToTeam.length>0,submitting:!1,errors:null}},_canAccept:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onAccept:function(e){return this.refs.members.getFinalData(function(e){return function(r){var i,a,l;return l=r.emails,a=r.custom_message,i=e._canAccept(),e.setState({canAccept:i}),i?(e.setState({submitting:!0}),s.WebRequest({url:"/account/team/add_users",subject_user:w.work_user,data:{emails:l,custom_message:a,team_id:w.team_id},complete:function(){return null!=e.refs.modal?e.setState({submitting:!1}):void 0},success:function(n){var r,i,s,a,u;return n=JSON.parse(n),a=t.values(n.users),u=void 0,1===a.length?u=g("Member invited."):a.length>1&&(u=g("Members invited.")),u?(o.success(u),m.log("team_member_invited_to_team_while_sharing",s={sharing_type:e.props.sharingType,num_users_invited_to_team:null!=l?l.length:void 0}),"function"==typeof(r=e.props).onDidAccept&&r.onDidAccept(),e.refs.modal.close(),"function"==typeof(i=e.props).onDidClose?i.onDidClose():void 0):o.error()},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?o.error(new n(g('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:w.team_name}))):o.error()}})):void 0}}(this))},onDidDismiss:function(){var e,t;return"function"==typeof(e=this.props).onDidDismiss&&e.onDidDismiss(),"function"==typeof(t=this.props).onDidClose?t.onDidClose():void 0},onMembersFormChange:function(){return this.setState({canAccept:this._canAccept()})},componentDidMount:function(){var e,t,n;return m.log("team_member_saw_suggestions_while_sharing",e={sharing_type:this.props.sharingType,num_users_shared:null!=(t=this.props.usersSharedOnFolder)?t.length:void 0,num_users_suggested_to_team:null!=(n=this.props.suggestedUsersToInviteToTeam)?n.length:void 0}),s.WebRequest({url:"/team/saw_suggest_team_invite_modal"})},render:function(){var t,n;return n=function(){var e,n,r,o;for(r=this.props.suggestedUsersToInviteToTeam,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(new h({email:t,type:l.EMAIL}));return o}.call(this),e.createElement(p,{className:"suggest-team-invite-modal",title:g("Do you want to invite these people to join your %(team_name)s team?").format({team_name:this.props.teamName}),acceptButtonText:g("Invite"),dismissButtonText:g("No thanks"),acceptButtonDisabled:!this.state.canAccept,submitting:this.state.submitting,onAccept:this.onAccept,onDismissCompleted:this.onDidDismiss,autoClose:!1,ref:"modal"},e.createElement(u,{ref:"members",errorMessageSpaceFixed:!0,invitationContext:u.InvitationContexts.existingTeam,onChange:this.onMembersFormChange,user:w.work_user,populatedContacts:n,autofocusTokenizer:!0}))}})})}.call(this),function(){define("modules/clean/teams/prop_types",["external/react"],function(e){var t;return t=e.PropTypes,{joinableTeam:t.shape({team_id:t.number,team_name:t.string,num_members:t.number,is_invite:t.bool,is_limited:t.bool,join_request_state:t.number,signup_key:t.string,inviting_user_name:t.string,approver_display_name:t.string,members_to_display:t.arrayOf(t.shape({display_name:t.string.isRequired,avatar_url:t.string}))}),suggestedMember:t.shape({id:t.number,email:t.string,display_name:t.string,avatar_url:t.string}),valueLink:function(e){return null==e&&(e=t.any),t.shape({value:e,requestChange:t.func.isRequired})}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(n,r,o){var i,s;return i=o.DBModal,s=function(o){function i(){return this.on_confirm_button_click=e(this.on_confirm_button_click,this),this._$form=e(this._$form,this),i.__super__.constructor.apply(this,arguments)}return t(i,o),i.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},i.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this._$form().submit()},i.prototype.on_show=function(){var e;return e=this._$form(),new r(e),e.on(r.SUCCESS_EVENT,function(e){return function(t,r){return e.options.open_created_folder?n.redirect(r.sf_info.href):n.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn(t,e)}}(this)):void 0},i}(i)})}.call(this),function(){define("modules/clean/top_notif",["jquery","modules/clean/ajax"],function(e,t){var n,r,o,i,s;return s={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return e("#top-notification-bar-container").hide(),e("body").removeClass("top-notification-bar"),e(document).trigger(this.HIDE_EVENT)}},n={init:function(){return e(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_eu_cookie_notification"})})}},r={init:function(){return e(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_expired_ios_notification"})})}},o={init:function(){return e("#locale-switch-banner-dismiss").on("click",function(e){
return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_locale_switch_banner"})})}},i={init:function(){return e("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_super_inactive_recover_bar"})})}},{TopNotificationBar:s,EUCookieNotificationBar:n,ExpiredIOSNotificationBar:r,LocaleSwitchBar:o,SuperInactiveRecoverBar:i}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/uirequest",["jquery","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/css","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(t,n,r,o,i,s,a){var l,u;return l=a.DBModal,u=function(){function a(t,n,r){return this.$node=t,this.url=n,this.options=null!=r?r:{},this.complete=e(this.complete,this),this.handle_errors=e(this.handle_errors,this),this.error=e(this.error,this),this.perform_actions=e(this.perform_actions,this),this.success=e(this.success,this),this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading")?!1:(this.$node.addClass("ajax-loading"),void new o.FormWebRequest({url:this.url,type:null!=this.options.type?this.options.type:void 0,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user}))}return a.prototype.success=function(e,t,n){var r,o,a;return(a=s.extract_errors(n.responseText))?(this.handle_errors(a),void("function"==typeof(r=this.options).error&&r.error(n,t))):(e=JSON.parse(n.responseText),e.redirect?void(window.location.href=e.redirect):e.reload?void window.location.reload():(this.shouldDelayComplete=e.js||e.css,this.shouldDelayComplete?i.require_css_multi(e.css,function(r){return function(){var o,i;return r.perform_actions(e.actions||[]),"function"==typeof(o=r.options).success&&o.success(e,t,n),r.$node.removeClass("ajax-loading"),"function"==typeof(i=r.options).complete?i.complete(n,t):void 0}}(this)):(this.perform_actions(e.actions||[]),void("function"==typeof(o=this.options).success&&o.success(e,t,n)))))},a.prototype.perform_actions=function(e){var o,i,s,a,u,c,_,d,h,p,f,m;for(p=[],u=0,c=e.length;c>u;u++)switch(i=e[u],a=i[0],s=i[1],m=i[2],o=this.$node,m&&"modal"!==a&&("^"===m.charAt(0)&&(d=m.split(" "),o=o.closest(d[0].substr(1)),m=d.slice(1).join(" ")),m&&(o=o.find(m).filter(":first"))),a){case"modal":h="db-modal-response-modal-placeholder",t("#"+h).remove(),f=t(s),f.attr("id",h),t("body").append(f),_=new l({element_id:"response-modal-placeholder"}),p.push(_.show());break;case"html":p.push(o.html(s));break;case"replaceWith":p.push(o.replaceWith(s));break;case"after":s?p.push(o.after(s)):p.push(void 0);break;case"before":s?p.push(o.before(s)):p.push(void 0);break;case"toggleClass":p.push(o.toggleClass(s));break;case"addClass":p.push(o.addClass(s));break;case"removeClass":p.push(o.removeClass(s));break;case"notify":p.push(r.success(s));break;case"notifyError":p.push(r.error(new n(s),this.options.errorDuration||null));break;default:p.push(void 0)}return p},a.prototype.error=function(e,t,n){var r,o;return o=s.extract_errors(e.responseText),"abort"!==t&&this.handle_errors(o),"function"==typeof(r=this.options).error?r.error(e,t,n):void 0},a.prototype.handle_errors=function(e){var t;return e===!1?r.error():"string"==typeof e?(t=this.options.html_in_error_msg?new n(e):e,r.error(t)):s.fill_errors(this.$node,e)},a.prototype.complete=function(e,t){var n;if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof(n=this.options).complete?n.complete(e,t):void 0},a}()})}.call(this),function(){define("modules/clean/undo",["jquery","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,n,r){var o,i;return i=n._,o=function(){function t(){}return t.perform_undo=function(){return null!=this.undo_handler?(this.undo_handler(this.undo_info),this.undo_handler=this.undo_info=null):void 0},t.notifyWithUndo=function(n,o,s,a,l){var u,c;return a=a||30,l=l||i("Undo"),o&&Object.keys(o).length>0?(this.undo_info=o,this.undo_handler=s,u=e("<span />"),null!=n.toHTML?u.html(n.toHTML()):u.text(n),c=e('<button class="button-as-link"/>').text(l),c.on("click",function(e){return e.preventDefault(),t.perform_undo(),r.clear()}),u.append("&nbsp;").append(c),this.undo_notification=r.success(u,a)):r.success(n)},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/upsell/ha",["jquery","modules/clean/upsell/upsell_controller","modules/constants/viewer"],function(t,n,r){var o;return o=function(){function o(t,r){this.$ha=t,this.options=r,this._show_if_possible=e(this._show_if_possible,this),this.$ha.find(".dismiss-button").on("click",function(e){return function(){return e.$ha.hide()}}(this)),this.upsell_controller=new n(this.$ha.find(".confirm-button"),this.$ha.find(".dismiss-button"),this.options),this._maybe_show()}return o.prototype._maybe_show=function(){var e;return this.has_been_shown=!1,this.$ha_container=t("#ha-container"),this.$footer=t("#page-footer"),this.$window=t(window),this.$ha_clone=null,r.prompt_ha_hiding?(this.$ha_clone=this.$ha.clone(),this.$ha_container.append(this.$ha_clone),this._show_if_possible(),t(window).resize(this._show_if_possible),e=this.$ha_clone.find("img"),e.load(function(e){return function(){return e._show_if_possible()}}(this))):this._show()},o.prototype._log_first_impression=function(){return this.has_been_shown?void 0:(this.upsell_controller.log_impression(),this.has_been_shown=!0)},o.prototype._element_or_parent_is_fixed=function(e){return e.add(e.parents()).is(function(){return"fixed"===t(this).css("position")})},o.prototype._can_fit=function(){var e,t,n,r;return n=this.$ha.offset().top+this.$ha_clone.outerHeight(),t=this.$footer.outerHeight(),r=this.$window.height(),e=r>n+5+t,e||!this._element_or_parent_is_fixed(this.$ha)},o.prototype._can_fit_without_image=function(){return this.$ha_clone.addClass("no-image"),this._can_fit()},o.prototype._show_without_image=function(){return this.$ha.addClass("no-image"),this._show()},o.prototype._can_fit_with_image=function(){return this.$ha_clone.removeClass("no-image"),this._can_fit()},o.prototype._show_with_image=function(){return this.$ha.removeClass("no-image"),this._show()},o.prototype._show=function(){return this.$ha.css("visibility","visible"),this._log_first_impression()},o.prototype._hide=function(){return this.$ha.css("visibility","hidden")},o.prototype._show_if_possible=function(){return this._can_fit_with_image()?this._show_with_image():this._can_fit_without_image()?this._show_without_image():this._hide()},o}()})}.call(this),function(){var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/upsell/header_bubble_or_link",["modules/clean/header_bubble","modules/clean/upsell/upsell_controller"],function(t,n){var r;return r=function(t){function r(e,t){var o;this.$el=e,this.options=t,o=new n(this.$el.find(".confirm-button"),this.$el.find(".dismiss-button"),this.options),o.log_impression(),r.__super__.constructor.apply(this,arguments)}return e(r,t),r}(t)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/upsell/upsell_controller",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/core/dom","modules/core/exception","modules/core/uri"],function(t,n,r,o,i,s){var a,l,u,c;return a=r.DBModal,l=r.DBModalStack,c=i.assert,u=function(){function r(n,o,i){this.options=i,this.post_confirm=e(this.post_confirm,this),this.post_dismiss=e(this.post_dismiss,this),this.confirm=e(this.confirm,this),this.dismiss=e(this.dismiss,this),this._keydown=e(this._keydown,this),n.length>0&&n.one("click",function(e){return function(t){return e.confirm(t)}}(this)),o.length>0&&o.one("click",function(e){return function(n){var r;return r=t(n.target).hasClass("remind-me-later"),e.dismiss(n,r)}}(this)),this.options.dismissWithKeys&&t(document).on("keydown",this._keydown),r.add_tk_params(n,{addTkParams:this.options.addTkParams,campaignName:this.options.campaignName,campaignLocationId:this.options.campaignLocationId})}return r.ON_SHOW_EVENT_NAME="db:prompt:show",r.ON_CONFIRM_EVENT_NAME="db:prompt:confirm",r.ON_DISMISS_EVENT_NAME="db:prompt:dismiss",r.PRE_CONFIRM_EVENT_NAME="db:prompt:pre-confirm",r.PRE_DISMISS_EVENT_NAME="db:prompt:pre-dismiss",r.CONFIRM="confirm",r.DISMISS="dismiss",r.LOG_IMPRESSION="log_impression",r.prototype._keydown=function(e){return 27===e.keyCode||8===e.keyCode&&!o.focus_in_input()?(e.preventDefault(),t(document).off("keydown",this._keydown),this.dismiss(e)):void 0},r.prototype._campaignUrl=function(e,t){var n,o;return n=e===r.CONFIRM?"/upsell/confirm":e===r.DISMISS?"/upsell/dismiss":e===r.LOG_IMPRESSION?"/upsell/log_impression":void 0,this.options&&this.options.campaignId?(o=s({path:n}).updateQuery({campaign_id:this.options.campaignId}),e===r.DISMISS&&t&&o.updateQuery({remind_me_later:!0}),o.toString()):void 0},r.prototype._confirmOrDismiss=function(e,r,o,i){return"keydown"===e.type||o||(e.stopImmediatePropagation(),e.preventDefault()),n.AuthenticatedRequest({type:"POST",url:r,success:function(n){return function(r){return"keydown"===e.type||o||e.target.click(),t(document).trigger(i,{campaignName:n.options.campaignName})}}(this)})},r.prototype.dismiss=function(e,n){var o;return o=this._campaignUrl(r.DISMISS,n),o&&this._confirmOrDismiss(e,o,!1,r.ON_DISMISS_EVENT_NAME),t(document).trigger(r.PRE_DISMISS_EVENT_NAME,{campaignName:this.options.campaignName})},r.prototype.confirm=function(e){var n;return n=this._campaignUrl(r.CONFIRM),n&&this._confirmOrDismiss(e,n,this.options.confirmInNewTab,r.ON_CONFIRM_EVENT_NAME),t(document).trigger(r.PRE_CONFIRM_EVENT_NAME,{campaignName:this.options.campaignName})},r.prototype.log_impression=function(){var e;return e=this._campaignUrl(r.LOG_IMPRESSION),e?n.AuthenticatedRequest({type:"POST",url:e}):void 0},r.prototype.log_event=function(e){var t;return this.options&&this.options.campaignId?(t=s({path:"/upsell/log_event"}).updateQuery({event_name:e,campaign_id:this.options.campaignId}),n.AuthenticatedRequest({type:"POST",url:t.toString()})):void 0},r.prototype.post_dismiss=function(){var e;return e=this._dismissUrl(),e?n.AuthenticatedRequest({type:"POST",url:e}):void 0},r.prototype.post_confirm=function(){var e;return e=this._confirmUrl(),e?n.AuthenticatedRequest({type:"POST",url:e}):void 0},r.add_tk_params=function(e,n){return n.addTkParams?(c(n.campaignName),c(n.campaignLocationId),e.each(function(e,r){var o,i,a,l;return o=t(r),o.is("a")?a="href":(o=o.closest("form"),a="action"),l=o.attr(a),o.length>0&&l?(i=s.parse(l),i.updateQuery({_tk:n.campaignLocationId,_camp:n.campaignName}),o.attr(a,i.toString())):void 0})):void 0},r.register_custom_controller=function(e,n,o,i,s){return t(document).on(r.ON_SHOW_EVENT_NAME,e),t(document).on(r.ON_CONFIRM_EVENT_NAME,n),t(document).on(r.ON_DISMISS_EVENT_NAME,o),t(document).on(r.PRE_CONFIRM_EVENT_NAME,i),t(document).on(r.PRE_DISMISS_EVENT_NAME,s)},r}()})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/user",[],function(){var t;return t=function(){function t(t){var n;for(n in t)e.call(t,n)&&"string"==typeof n&&"_"!==n[0]&&(this[n]=t[n])}return t.prototype.toString=function(){return String(this.id)},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/ux_analytics",["external/modernizr","external/underscore","jquery","modules/clean/analytics","modules/core/browser"],function(t,n,r,o,i){var s,a,l;return l=o.UXAnalyticsLogger,s=500,a=function(){function o(t,o){var i,s;this.request_id=t,this.org_referrer=o,this._trackScrolling=e(this._trackScrolling,this),this._storeLinkClick=e(this._storeLinkClick,this),this._delayed_init=e(this._delayed_init,this);try{this._init_time=(new Date).getTime(),this._throttledScrolling=n.throttle(this._trackScrolling,2e3),r(window).on("scroll",this._throttledScrolling),this._heartbeat(),setTimeout(this._delayed_init,50)}catch(e){i=e}}return o.prototype._linkClickKey="clicked_link",o.prototype._localStorageAvailable=t.localstorage,o.prototype._lastScrollOffset=0,o.prototype._init_time=0,o.prototype._delayed_init=function(){return this._logPageViewEvent(),this._logClickEvent(),r("a").on("mousedown",this._storeLinkClick)},o.prototype._logPageViewEvent=function(){var e,t;try{return this._log("page_view")}catch(t){e=t}},o.prototype._storeLinkClick=function(e){var t,n,o,s,a,l,u;try{if(!this._localStorageAvailable)return void this._log_on_page("link_no_local_storage");s=e.currentTarget,t=r(s),l=t.offset(),u=t.text().substring(0,50),a={link_id:t.attr("data-trackingid"),origin_href:s.href,link_text:u,url:i.get_href(),vertical_offset:this._get_vertical_offset(),time_on_page:this._get_time_on_page(),top:Math.round(l.top),left:Math.round(l.left),link_rank:this._get_link_rank(s,t,l),request_id:this.request_id},this.org_referrer&&(a.org_referrer=this.org_referrer),localStorage.setItem(this._linkClickKey,JSON.stringify(a))}catch(e){n=e}return!0},o.prototype._logClickEvent=function(){var e,t,n,r;try{if(!this._localStorageAvailable)return;return(e=localStorage.getItem(this._linkClickKey))&&(r=JSON.parse(e),r.destination_url=i.get_href(),this._log("link_click",r)),localStorage.removeItem(this._linkClickKey)}catch(e){t=e}},o.prototype._trackScrolling=function(){var e,t;try{return clearTimeout(r.data(this,"scrollTimer")),r.data(this,"scrollTimer",setTimeout(function(e){return function(){var t;return t=e._get_vertical_offset(),e._lastScrollOffset!==t?(e._lastScrollOffset=t,e._log_on_page("scroll_event")):void 0}}(this),s))}catch(t){e=t}},o.prototype._heartbeat=function(e){var t,n;null==e&&(e=0);try{return setTimeout(function(t){return function(){return t._log_on_page("heartbeat"),t._heartbeat(e+1)}}(this),1e3*Math.pow(3,e)+1e3)}catch(e){t=e}},o.prototype._get_vertical_offset=function(){return r(window).scrollTop()},o.prototype._get_time_on_page=function(){var e;return e=(new Date).getTime(),Math.round((e-this._init_time)/1e3)},o.prototype._get_link_rank=function(e,t,n){var o,i,s,a,l,u;for(u=r("a[href='"+t.attr("href")+"']"),s=a=0,l=u.length;l>a;s=++a)if(o=u[s],i=r(o).offset(),o===e&&i.top===n.top&&i.left===n.left)return s+1;return-1},o.prototype._log_on_page=function(e,t){return null==t&&(t={}),t.vertical_offset||(t.vertical_offset=this._get_vertical_offset()),t.time_on_page||(t.time_on_page=this._get_time_on_page()),this._log(e,t)},o.prototype._log=function(e,t){return null==t&&(t={}),"link_click"!==e&&(t.url||(t.url=i.get_href()),t.request_id||(t.request_id=this.request_id),this.org_referrer&&(t.org_referrer=this.org_referrer)),l.log(e,t)},o}()})}.call(this),function(){var e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].slice;define("modules/clean/validators/validators",["jquery","external/underscore","modules/core/i18n"],function(t,r,o){var i,s,a,l,u,c,_,d,h,p,f,m,g;return d=o._,h={},m=function(e,t){return h[e]=t},f=function(e){var t,n,r;if(r=e[0],n=e.slice(1),!h[r])throw new Error("Cannot find validator of type "+r);return t=h[r],function(e,t,n){n.prototype=e.prototype;var r=new n,o=e.apply(r,t);return Object(o)===o?o:r}(t,n,function(){})},_=function(){function e(e){this.messages=r.extend({},this.constructor.messages,null!=e?e.messages:void 0)}return e}(),s=function(t){function o(){var e,t,i;i=1<=arguments.length?n.call(arguments,0):[],t=null,r.isArray(r.last(i))||(t=r.last(i),i=r.initial(i)),this.validators=function(){var t,n,r;for(r=[],t=0,n=i.length;n>t;t++)e=i[t],null!==e&&r.push(f(e));return r}(),o.__super__.constructor.call(this,t)}return e(o,t),o.prototype.validate=function(e,t){var n,r,o,i,s;for(o=this.validators,i=[],n=0,r=o.length;r>n;n++)s=o[n],i.push(s.validate(e,t));return i},o}(_),m("AllValidator",s),i=/^[\x00-\x7f]*$/,a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.messages={asciiOnly:d("Only basic ASCII characters allowed")},n.prototype.validate=function(e){if(!i.test(e))throw new Error(this.messages.asciiOnly)},n}(_),m("AsciiOnlyValidator",a),c=function(n){function r(e){r.__super__.constructor.call(this,e),this.not_empty=e.not_empty,this.strip=e.strip}return e(r,n),r.messages={empty:d("Please enter a value for %(field)s")},r.prototype.validate=function(e,n){if(this.strip&&(e=t.trim(e)),this.not_empty&&!e)throw new Error(this.messages.empty.format({field:null!=n?n.field:void 0}))},r}(_),m("StringValidator",c),u=function(t){function n(e){n.__super__.constructor.call(this,e),this.lastname_goes_first=null!=e?e.lastname_goes_first:void 0}return e(n,t),n.messages={empty:d("Please enter your name")},n.prototype.validate=function(e,t){var n;if(!t.data.lname&&!t.data.fname)if(this.lastname_goes_first){if("lname"===t.field)throw new Error(this.messages.empty)}else if("fname"===t.field)throw new Error(this.messages.empty);return"fname"===t.field?(n=f(["StringValidator",{not_empty:!0,strip:!0,messages:{empty:d("Please enter your first name")}}]),n.validate(e,t)):void 0},n}(_),m("NameValidator",u),l=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.messages={empty:d("Please enter an email address"),noAt:d("An email address must contain a single @"),badUsername:d("The username portion of the email address is invalid (the portion before the @: %(username)s)"),badDomain:d("The domain portion of the email address is invalid (the portion after the @: %(domain)s)")},r.username_re=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,r.domain_re=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i"),r.prototype.validate=function(e){var n,o,s;if(e=t.trim(e),!e)throw new Error(this.messages.empty);if(o=e.split("@"),2!==o.length)throw new Error(this.messages.noAt);if(s=o[0],n=o[1],!r.username_re.test(s))throw new Error(this.messages.badUsername.format({username:s}));if(i.test(n)&&!r.domain_re.test(n))throw new Error(this.messages.badDomain.format({domain:n}))},r}(_),m("EmailValidator",l),p=function(e){return function(t,n){var r;r=!0;try{e.validate(t,n)}catch(e){r=!1}return r}},g={create:f,register:m,check:p}})}.call(this),function(){define("modules/clean/video_util",["jquery","modules/core/browser","modules/core/i18n","external/flash_detect","external/videojs/video","external/videojs/videojs_hls","modules/clean/ajax","modules/constants/static","modules/constants/viewer"],function(e,t,n,r,o,i,s,a,l){var u,c,_;return c=n._,u={_video_counter:0,embed:function(n,r){var o,i,u,d,h,p,f,m,g,v,y,w,b;if(null==r&&(r={}),!this.can_embed_type(r.type))return null!=r.onError&&setTimeout(function(){return r.onError("needflash")},0),document.createElement("div");for(r.preload="undefined"!=typeof r.preload?r.preload:!0,r.preload&&(r.preload="auto"),d="video-"+this._video_counter,this._video_counter+=1,b=e("<video/>",{class:"video-js vjs-default-skin vjs-big-play-centered",id:d,controls:r.controls}),b=b[0],o=-1,g=["width","height","preload","poster","autoplay"],u=0,h=g.length;h>u;u++)f=g[u],r[f]&&b.setAttribute(f,r[f]);return v=e("<source/>",{src:r.src,type:r.type}),v=v[0],b.appendChild(v),n=e(n),n.empty(),n=n[0],n.appendChild(b),p=function(){var n,i,a,l;return l=this,"function"==typeof r.onReady&&r.onReady(),n=function(){return null!=l.hls?l.hls.fillBuffer():void 0},t&&(t.ipad&&(i=0,e(document).on("dropdownOpened modalOpened",function(t,n){return i+=n,e(l.el_).children("video").removeAttr("controls")}),e(document).on("dropdownClosed modalClosed",function(t,n){return i-=n,0===i?e(l.el_).children("video").attr("controls","controls"):void 0})),t.msie&&"9.0"===t.version&&l.on("playing",function(){return l.removeClass("vjs-seeking")})),"Hls"===l.techName&&l.on("seeked",function(){return l.controlBar.currentTimeDisplay.updateContent()}),l.on("pause",function(){return o=setInterval(n,500),l.ended()?l.removeClass("vjs-has-started"):void 0}),l.on("play",function(){return clearInterval(o),o=-1}),l.on("dispose",function(){return clearInterval(o)}),l.on("ended",function(){return l.src({type:r.type,src:r.src})}),"application/vnd.apple.mpegurl"===r.type&&_(l),a=function(){return l.addClass("show-truncated-bar")},!r.metadata&&r.metadata_link?s.AuthenticatedRequest({url:r.metadata_link,type:"GET",data:{},xhrFields:{withCredentials:!0},success:function(e){return"function"==typeof r.metadata_cb&&r.metadata_cb(e),e=JSON.parse(e),e.is_truncated?a.defer():void 0}}):r.metadata&&r.metadata.is_truncated?a.defer():void 0},w=c("The clip displayed here is a preview. To view the entire video, download or add it to your Dropbox."),l.transcoder_hls4web&&(videojs.Hls.GOAL_BUFFER_LENGTH=120),videojs.TruncatedBar=videojs.Component.extend(),videojs.TruncatedBar.prototype.options_={loadEvent:"play",components:{}},videojs.TruncatedBar.prototype.createEl=function(){var e;return e=videojs.createEl("div",{className:"truncated-bar",id:"truncated-video-message-bar"}),e.textContent=w,e},videojs.options.children.TruncatedBar={},i={swf:a.static_url_video_js_swf,flashVars:{contentType:r.type,hlsDebugLevel:l.hls_debug_level}},y=l.transcoder_hls4web?["html5","hls","flash"]:["flash"],m=videojs(b,{flash:i,techOrder:y},p),r.onError&&m.on("error",r.onError),m},can_embed_type:function(e){var t;return""!==("function"==typeof(t=document.createElement("video")).canPlayType?t.canPlayType(e):void 0)?!0:r.installed&&r.majorAtLeast(10)?"application/vnd.apple.mpegurl"===e||"video/flv"===e||"video/mp4"===e:!1}},_=function(e){var t,n,r,o,i,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x,E,S,T,C,k,R,A,N,L,I,O,D;for(E=[250,500,1500,3e3],m=null,b=null,w=null,N=0,v=-1,f=!1,y=null,p=-1,C=[],L=!0,O=0,h={},g=0,x=E.length;x>g;g++)k=E[g],h[k.toString()]=0;return I=null,D=[],T=100,R=function(){var t,n,r,o,i;for(t={},n=0,r=E.length;r>n;n++)k=E[n],i=h[k.toString()],t[k.toString()]=Math.round(i/O*100)||0;return o={duration:Math.round(1e3*e.duration()),initial_bitrate:E[v]||0,initial_play_wait:y||0,bitrate_percentages:JSON.stringify(t),stalls:N,quality_events:JSON.stringify(C),xhr_errors:JSON.stringify(D),percentage_watched:T},A(),s.AuthenticatedRequest({url:"/video_web_play_log",type:"POST",data:o})},A=function(){var e,t;for(m=null,b=null,w=null,N=0,v=-1,f=!1,y=null,p=-1,C=[],L=!0,O=0,h={},e=0,t=E.length;t>e;e++)k=E[e],h[k.toString()]=0;return I=null,D=[],T=100},r=function(){return _(),R()},u=function(){return _(),T=Math.round(e.currentTime()/e.duration()*100),isFinite(T)||(T=0),R()},d=function(){return L?(I=Date.now(),L=!1):void 0},_=function(){var e;if(!L)return e=Date.now()-I,O+=e,h[E[p].toString()]+=e,L=!0},i=function(){return null===m&&(w=m=Date.now()),b=Date.now()},t=function(){var t;return t=e.hls.selectPlaylist().attributes.BANDWIDTH/1e3,E.indexOf(t)},n=function(){return p=t(),v=p,d(),f?void 0:(y=null===m?0:Date.now()-m,f=!0)},o=function(){return _()},l=function(){return b=Date.now()},c=function(){return _(),Date.now()-b>5e3?N+=1:void 0},a=function(){var n;if(!(e.ended()||e.error()||e.paused()))return _(),n=p,p=t(),Date.now()-m<1e3?v=p:C.push([E[n],E[p],Date.now()-w]),w=Date.now(),d()},e.on("play",i),e.on("pause",o),e.on("canplay",n),e.on("waiting",c),e.on("seeking",l),e.on("ended",r),e.on("shutdown",u),e.on("mediachange",a),"Hls"===e.techName?(S=videojs.Hls.xhr,videojs.Hls.xhr=function(e,t){var n;return n=function(e,n){var r;return e&&(r="",""!==this.responseType&&"text"!==this.responseType||(r=this.responseText),D.push([this.status.toString(),r,n])),t.call(this,e,n)},S.call(this,e,n)}):void 0},u})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/viewer",["modules/constants/viewer","modules/core/exception","modules/core/i18n","modules/clean/user","modules/clean/ajax"],function(t,n,r,o,i){var s,a,l,u;return u=n.assert,l=r._,a=i.WebRequest,s=function(){function n(e){null==e&&(e={}),this.build(e)}return n._cached_viewer=null,n.get_viewer=function(){var e;return this._cached_viewer||(e=t._viewer_properties,this._cached_viewer=new n(e)),this._cached_viewer},n.get_role_title=function(e){var t;return t=this.get_viewer(),t.get_title_by_role(e.role)},n.get_root_name=function(e){var t;return t=this.get_viewer(),t.get_root_name_by_role(e.role)},n.prototype.build=function(t){var n,r,i,s,a,l;for(null==t&&(t={}),this._authed_users={},this._all_users={},a=t._user_data||[],n=0,i=a.length;i>n;n++)l=a[n],s=new o(l),this._all_users[s.id]=s,l._authed&&(this._authed_users[s.id]=s);for(r in t)e.call(t,r)&&"string"==typeof r&&"_"!==r[0]&&(this[r]=t[r]);return this.is_signed_in=a.length>0,this.is_paired=a.length>1,this.deprecated_first_user_in_the_cookie_id&&(this.deprecated_first_user_in_the_cookie=this.get_user_by_id(this.deprecated_first_user_in_the_cookie_id),delete this.deprecated_first_user_in_the_cookie_id),this._load_cached_users()},n.prototype.reload=function(e){return a({url:"/get_viewer",success:function(t){return function(n){var r;try{if(r=JSON.parse(n),t.build(r),e)return e()}catch(e){}}}(this)})},n.prototype.get_user_by_role=function(e,t){var n;return n=this.get_uid_by_role(e),void 0!==n?this.get_user_by_id(n,t):void 0},n.prototype.role_exists=function(e){return void 0!==this.get_uid_by_role(e)},n.prototype.get_user_by_id=function(e,t){var n,r;return u(this.is_uid_associated(e),"User "+e+" is not associated with this viewer"),r=t?this._all_users:this._authed_users,n=r[e],u(n,"User "+e+" is not signed in"),n},n.prototype.is_role_signed_in=function(e){return this.get_uid_by_role(e)in this._authed_users},n.prototype.is_uid_signed_in=function(e){return e in this._authed_users},n.prototype.is_user_signed_in=function(e){return!(!e||!this.is_uid_signed_in(e.id))},n.prototype.is_uid_associated=function(e){return e in this._all_users},n.prototype.get_users=function(e){var n,r,o,i;return o=e?this._all_users:this._authed_users,i=function(){var e;e=[];for(n in o)r=o[n],e.push(r);return e}(),i.sort(function(e,n){return e.role===t.ROLE_PERSONAL?-1:1}),i},n.prototype.get_user_ids=function(e){var t;return function(){var n,r,o,i;for(o=this.get_users(e),i=[],n=0,r=o.length;r>n;n++)t=o[n],i.push(t.id);return i}.call(this)},n.prototype.get_roles=function(e){var t;return function(){var n,r,o,i;for(o=this.get_users(e),i=[],n=0,r=o.length;r>n;n++)t=o[n],i.push(t.role);return i}.call(this)},n.prototype.get_account_ids=function(e){var t;return function(){var n,r,o,i;for(o=this.get_users(e),i=[],n=0,r=o.length;r>n;n++)t=o[n],i.push(t.account_id);return i}.call(this)},n.prototype.get_email_by_role=function(e){var t;return t=this.get_user_by_role(e,!0),t&&t.email},n.prototype.get_uid_by_role=function(e){var n,r,o;e===t.ROLE_PHOTOS&&(e=this._get_photos_role()),n=this._all_users;for(r in n)if(o=n[r],o.role===e)return r},n.prototype.get_title_by_role=function(e){return this.is_paired?e===t.ROLE_PERSONAL?l("Personal"):this.team_name:""},n.prototype.get_root_name_by_role=function(e){return this.get_title_by_role(e)||l("Dropbox")},n.prototype._get_photos_role=function(){return this.is_paired||!this.is_signed_in?t.ROLE_PERSONAL:this._values(this._all_users)[0].role},n.prototype._sign_in_all_users=function(){return this._authed_users=this._shallow_clone(this._all_users),this._load_cached_users()},n.prototype._sign_out_user_by_id=function(e){return delete this._authed_users[e],this._load_cached_users()},n.prototype.sign_in_user_by_id=function(e){return u(this.is_uid_associated(e),"User "+e+" is not associated with this viewer"),this._authed_users[e]=this._all_users[e],this._load_cached_users()},n.prototype._values=function(e){var t,n;n=[];for(t in e)n.push(e[t]);return n},n.prototype._shallow_clone=function(e){var t,n;n={};for(t in e)n[t]=e[t];return n},n.prototype._load_cached_users=function(){return this.personal_user=this._authed_users[this.get_uid_by_role(t.ROLE_PERSONAL)],this.photos_user=this._authed_users[this.get_uid_by_role(t.ROLE_PHOTOS)],this.work_user=this._authed_users[this.get_uid_by_role(t.ROLE_WORK)],this.personal_email=this.get_email_by_role(t.ROLE_PERSONAL),this.work_email=this.get_email_by_role(t.ROLE_WORK),this.is_personal_user_signed_in=this.is_role_signed_in(t.ROLE_PERSONAL),this.is_photos_user_signed_in=this.is_role_signed_in(t.ROLE_PHOTOS),this.is_work_user_signed_in=this.is_role_signed_in(t.ROLE_WORK)},n}()})}.call(this),function(){define("modules/clean/web_timing_logger",["jquery","external/react","modules/clean/ajax","modules/clean/devtools/perf_hub_actions","modules/clean/event_load","modules/constants/env","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/browser","modules/core/exception","modules/clean/web_module_timing"],function(e,t,n,r,o,i,s,a,l,u,c,_){var d;return d={init:function(e){var t,n,r,i,s,l,c,_;return n=null!=e?e:{},this.log_time_to_view=null!=(r=n.log_time_to_view)?r:!1,this.log_time_to_interactive=null!=(i=n.log_time_to_interactive)?i:!1,this.ttv_at_dom_interactive=null!=(s=n.ttv_at_dom_interactive)?s:!1,this.tti_at_dom_interactive=null!=(l=n.tti_at_dom_interactive)?l:!1,this.source_type=null!=(c=n.source_type)?c:"web",this.subtypes=null!=(_=n.subtypes)?_:{},u.performance()?("setResourceTimingBufferSize"in u.performance()&&u.performance().setResourceTimingBufferSize(300),this.initialized=!0,this.have_logged_web_timing=!1,t=0,a.LOG_JS_MODULE_TIMING&&a.LOG_TIMING_DELAY&&(t=600),o.window_load(function(){return setTimeout(d._log_navigation,t)})):void 0},reset:function(){return this.log_time_to_view=!1,this.log_time_to_interactive=!1,this.ttv_at_dom_interactive=!1,this.tti_at_dom_interactive=!1,this.source_type="web",this.initialized=!1,this.have_logged_web_timing=!1,this.time_to_view=null,this.time_to_interactive=null,this.subtypes={}},start_time:function(){var e,t;return(t=null!=(e=u.performance())?e.timing:void 0)?t.navigationStart||t.fetchStart:void 0},_log_navigation:function(){var e,t,n,r,o,i,c,_,h;if(d.initialized&&!d.have_logged_web_timing&&(c=null!=(o=u.performance())?o.timing:void 0)&&(i=d.start_time(),e=c.loadEventEnd,i&&e&&(d.ttv_at_dom_interactive&&(d.time_to_view=c.domInteractive),!(d.log_time_to_view&&null==d.time_to_view||(d.tti_at_dom_interactive&&(d.time_to_interactive=c.domInteractive),d.log_time_to_interactive&&null==d.time_to_interactive)))))return n=!d.have_logged_web_timing,d.have_logged_web_timing=!0,t={},s.IS_SPDY&&(t.is_spdy=!0),h=d.log_time_to_view?d.time_to_view-i:null,_=d.log_time_to_interactive?d.time_to_interactive-i:null,r={navigation_type:d._get_navigation_type(),server_request_start_time:s.REQUEST_START_TIME,browser_time:(c.redirectStart||c.fetchStart)-i,redirect_time:c.fetchStart-i,dns_time:c.domainLookupEnd-i,tcp_connect_time:(c.secureConnectionStart||c.requestStart)-i,ssl_connect_time:c.requestStart-i,time_to_first_byte:c.responseStart-i,time_to_last_byte:c.responseEnd-i,dom_load_time:c.domContentLoadedEventEnd-i,page_load_time:e-i,extra_columns:JSON.stringify(t),subtypes:JSON.stringify(d.subtypes)},a.LOG_RESOURCE_TIMING&&"getEntriesByType"in u.performance()&&d._add_resources_to_params(r),a.LOG_JS_MODULE_TIMING&&d._add_js_module_times_to_params(r),r.repo_rev=l.REPO_REV,d.log_time_to_view&&(r.time_to_view=h),d.log_time_to_interactive&&(r.time_to_interactive=_),d._log(r,null,n)},mark_time_to_view:function(){return this.time_to_view||this.ttv_at_dom_interactive?void 0:(this.time_to_view=(new Date).getTime(),null!=console.timeStamp&&console.timeStamp("TTV"),this._log_navigation())},mark_time_to_interactive:function(){return this.time_to_interactive||this.tti_at_dom_interactive?void 0:(this.time_to_interactive=(new Date).getTime(),null!=console.timeStamp&&console.timeStamp("TTI"),this._log_navigation())},log_ajax_transition:function(e,t,n,r,o,i){var s;return s={navigation_type:"ajax",page_load_time:e,url:i},null!=o&&(s.server_response_time=o),null!=n&&(s.extra_columns=JSON.stringify(n)),null!=r&&(s.stopwatch_suffix=r),d._log(s,t)},_log:function(t,o,a){return null==a&&(a=!1),t.url=t.url||u.get_href(),
t.request_id=s.REQUEST_ID,t.source_type=this.source_type,t.request_tracing_enabled=s.REQUEST_TRACING_ENABLED,o&&(t.url_info=o),n.AuthenticatedRequest({url:i.WEB_TIMING_LOG_ENDPOINT,type:"POST",data:t,success:function(t){var n,o;return n=e(".perf-hub-link-container"),a&&n.length&&(o=JSON.parse(t),"status"in o)?r.add_web_timing_details({details:o}):void 0}})},_add_resources_to_params:function(e){var t,n,r,o,i,s,a,l,c;if(i=[],s={},a=u.performance().getEntriesByType("resource"),a instanceof Array)for(n=0,r=a.length;r>n;n++)o=a[n],c=d._get_resource_type(o),c in s||(s[c]={count:0,total_time:0}),s[c].count++,s[c].total_time+=o.duration,i.push({type:c,name:o.name.substr(0,2e3),start:o.startTime,end:o.responseEnd,connectStart:o.connectStart,connectEnd:o.connectEnd,domainLookupStart:o.domainLookupStart,domainLookupEnd:o.domainLookupEnd});l=[];for(t in s)e["resource_"+t+"_count"]=s[t].count,e["resource_"+t+"_avg_time"]=s[t].total_time/s[t].count,l.push(e.resource_details=JSON.stringify(i));return l},_add_js_module_times_to_params:function(e){var t,n,r,o,i,s;if(null!=u.performance()&&"getEntriesByName"in u.performance()){for(s=_.get_module_times(),n=[],t=0,r=s.length;r>t;t++)i=s[t],!1 in i?c.raiseAndReport("Module with invalid map object fetched by requirejs",{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]}):(o=u.performance().getEntriesByName(i.url,"resource"),0!==o.length&&(i.start_time=o[0].responseEnd,n.push(i)));return e.js_module_times=JSON.stringify(n)}},_get_resource_type:function(e){var t,n,r,o;if(o=e.name,r=o.lastIndexOf("."),r>0){if(t=o.substring(r),".png"===t||".gif"===t||".jpg"===t||".svg"===t)return"img";if(".js"===t)return"script";if(".css"===t)return"css"}return n=e.initiatorType,"css"!==n&&"img"!==n&&"script"!==n&&"link"!==n?"xmlhttprequest"===n?"ajax":"other":n},_get_navigation_type:function(){var e;switch(e=u.performance().navigation,e.type){case e.TYPE_NAVIGATE:return"navigate";case e.TYPE_RELOAD:return"reload";case e.TYPE_BACK_FORWARD:return"back_forward"}}}})}.call(this),function(){define("modules/constants/debug",[],function(){return DebugConstants||{}})}.call(this),function(){define("modules/constants/env",[],function(){return EnvConstants||{}})}.call(this),function(){define("modules/constants/gandalf",[],function(){return window.GandalfConstants})}.call(this),function(){define("modules/constants/legacy",[],function(){return DropboxConstants||{}})}.call(this),function(){define("modules/constants/locales",[],function(){return LocalesConstants||{}})}.call(this),function(){define("modules/constants/mobile",[],function(){return window.MobileConstants||{}})}.call(this),function(){define("modules/constants/page_load",[],function(){return window.PageLoadConstants})}.call(this),function(){define("modules/constants/request",[],function(){return RequestConstants||{}})}.call(this),function(){define("modules/constants/viewer",[],function(){return ViewerConstants||{}})}.call(this),function(){define("modules/constants/webtiming",[],function(){return window.WebTimingConstants})}.call(this),function(){define("modules/core/accessible_announce",["jquery","external/purify","modules/clean/css"],function(e,t,n){var r,o;return o=n.require_css,r=function(){function n(){}return n.timeoutLength=50,n.polite=function(e,t){return null==t&&(t=10),this._announce("polite",e,t)},n.assertive=function(e,t){return null==t&&(t=10),this._announce("assertive",e,t)},n.clear=function(){return n._lastTimeout&&clearTimeout(n._lastTimeout),e("#accessible-announce").html("").attr("aria-live","off")},n._announce=function(t,n,r){return null==r&&(r=10),o("/static/css/accessibility-vfle8A-zy.css",function(o){return function(){return e("#accessible-announce").length?(o._setMessage(n,t),o._scheduleClear(r)):(e("body").append("<div id='accessible-announce' aria-live='assertive' class='ax-visually-hidden'></div>"),setTimeout(function(){return o._setMessage(n,t),o._scheduleClear(r)},o.timeoutLength))}}(this))},n._setMessage=function(n,r){var o;return this.clear(),o=e("#accessible-announce"),o.attr("aria-live",r),null!=n.toHTML?o.html(t.sanitize(n.toHTML())):n instanceof e?o.html(t.sanitize(n.html())):o.text(n)},n._scheduleClear=function(e){return this._lastTimeout=setTimeout(this.clear,1e3*e)},n}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/browser",["modules/constants/env","modules/core/exception","modules/core/uri"],function(t,n,r){var o,i,s,a,l;return i=n.assert,l=function(e){var t,n,r;return e=e.toLowerCase(),t=/(ipad)/.exec(e)||/(edge)[ \/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident).*? rv:([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=null!=(n=e.match(/version\/([\d.]+)/i))?n[1]:void 0,{browser:t[1]||"",version:r||t[2]||"0"}},s=l(navigator.userAgent),"trident"===s.browser&&(s.browser="msie"),a=t.REDIRECT_SAFE_ORIGINS,o={version:s.version,msie_version_at_most:function(e){return o.msie&&parseInt(o.version,10)<=e},safari_version_at_most:function(e){return o.safari&&parseInt(o.version,10)<=e},get_uri:function(e){return null==e&&(e=window),r.parse(this.get_href(e))},get_href:function(e){return null==e&&(e=window),e.location.href},get_hash:function(){return window.location.hash.split("#")[1]},set_hash:function(e){return window.location.hash=e},_parse_target:function(t,n){var r,o,s,l,u,c,_,d,h,p,f,m,g;return h=null!=n?n:{},g=null!=(p=h.target_window)?p:window,r=null!=(f=h.checkDomainWhitelist)?f:!0,l=null!=(m=h.httpsOnly)?m:!0,u=g.document.createElement("a"),u.href=t,d=":"===u.protocol?g.location.protocol:u.protocol||g.location.protocol,o=u.hostname||g.location.hostname,_=u.port||g.location.port,r&&i(!_,"Non-default port not legal when checking the whitelist."),c=0===u.pathname.indexOf("/")?u.pathname:"/"+u.pathname,l?i("https:"===d,"Target URI must be secure"):i("data:"!==d&&"javascript:"!==d,"Target URI can't use the data or javascript scheme"),r&&i(e.call(a,o)>=0,"Target URI must be in the domain whitelist"),s=o,_&&(s=s+":"+_),t=d+"//"+s+c+u.search+u.hash},open_tab:function(e){var t;return t=this._parse_target(e),window.open(t,"_blank")},unsafe_open_tab:function(e){return e=this._parse_target(e,{checkDomainWhitelist:!1,httpsOnly:!1}),window.open(e,"_blank")},redirect:function(e,t){var n;return null==t&&(t=window),n=this._parse_target(e,{target_window:t}),this._navigate(n,t)},replace_location:function(e){var t;return t=this._parse_target(e),window.location.replace(t)},reload:function(){return window.location.reload()},performance:function(){return window.performance||null},unsafeRedirect:function(e){return e=this._parse_target(e,{checkDomainWhitelist:!1,httpsOnly:!1}),this._navigate(e)},_navigate:function(e,t){return null==t&&(t=window),t.location.href=e},is_high_density_display:function(){var e;return window.matchMedia?(e="(-webkit-min-device-pixel-ratio: 1.1), (min-resolution: 192dpx), (min-resolution: 1.1dppx)",!!window.matchMedia(e).matches):window.devicePixelRatio?window.devicePixelRatio>1.1:!1},isOnline:function(){return window.navigator.onLine},subscribeConnectivityStatusChange:function(e){return window.addEventListener("online",e),window.addEventListener("offline",e)},unsubscribeConnectivityStatusChange:function(e){return window.removeEventListener("online",e),window.removeEventListener("offline",e)}},o[s.browser]=!0,o.browser_name=s.browser,o.mac=!!/(macintosh)/.exec(window.navigator.userAgent.toLowerCase()),o.iphone=!!/(iphone)/.exec(window.navigator.userAgent.toLowerCase()),o.ipod=!!/(ipod)/.exec(window.navigator.userAgent.toLowerCase()),o.iOS=o.ipad||o.ipod||o.iphone,o.ipad?(o.webkit=!0,o.safari=!0):o.chrome?o.webkit=!0:o.webkit&&(o.safari=!0),o})}.call(this),function(){define("modules/core/controller_helpers",["jquery","modules/core/controller_registry","modules/core/exception"],function(e,t,n){var r,o,i,s,a;return r=n.assert,s=function(e,t){return e.data("jscontroller",t)},a=function(e){return e.data("jscontroller")},o=function(n){var r,i,s,l;for(l=n.children(),i=0,s=l.length;s>i;i++)r=l[i],o(e(r));return!a(n)&&n.data("js-component-id")?t.bind_controller(n):void 0},i=function(e){var t;return r(e,"Trying to clone nonexistent element"),t=e.clone(),o(t),t},{deprecated_set_controller:s,get_controller:a,clone_element:i,bind_controllers:o}})}.call(this),function(){define("modules/core/controller_registry",["jquery","modules/core/exception"],function(e,t){var n,r,o;return o=t.raiseAndReport,r=function(t,n,r){var o,i,s,a;for(o=[t].concat(r),s=0,a=t.length;a>s;s++)i=t[s],e(i).data("jscontroller",function(e,t,n){n.prototype=e.prototype;var r=new n,o=e.apply(r,t);return Object(o)===o?o:r}(n,o,function(){}));return t},n=function(){function t(){}return t.controllers={},t.register_controller=function(e,t,n){return this.controllers[e]={constructor:t,args:n},this.find_and_bind_controller(e)},t.bind_controller=function(e){var t,n;return t=e.data("js-component-id"),this.controllers[t]?(n=this.controllers[t],r(e,n.constructor,n.args)):void o("No controller for "+t)},t.find_and_bind_controller=function(t){var n,i;return this.controllers[t]?(i=this.controllers[t],n=e("[data-js-component-id='"+t+"']"),r(n,i.constructor,i.args)):void o("No controller for "+t)},t}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/cookies",["modules/core/exception"],function(t){var n,r,o,i,s,a,l,u,c,_,d,h,p;return o=/^([0-9]{1,3}\.){3}[0-9]{1,3}$/,i=function(e){var t,n,r,i,s;if(e.match(o))return[e];for(t=e.split("."),s=[],n=r=0,i=t.length;i>=0?i>r:r>i;n=i>=0?++r:--r)s.push(t.slice(n).join("."));return s},s=function(e){var t,n,r,o,i,s;for(t=e.split("/"),s=[],n=r=0,o=t.length;o>=0?o>r:r>o;n=o>=0?++r:--r)i=t.slice(0,t.length-n).join("/"),""!==i&&s.push(i),s.push(i+"/");return s},a=function(t){var n,r,o,i;if(null==t)return!1;for(i=["=",";"],r=0,o=i.length;o>r;r++)if(n=i[r],e.call(t,n)>=0)return!0;return!1},p=function(e,n,r){null==r&&(r=!1),t.assert("string"==typeof e,n+" must be a string, but was "+typeof e),t.assert(r||(null!=e?e.length:void 0)>0,n+" must not be empty"),t.assert(!a(e),n+" contains illegal characters")},_=function(e){return p(e,"Cookie name",!1)},h=function(e){return p(e,"Cookie value",!0)},c=function(e){return p(e,"Cookie expiration date",!1)},u=function(e){return p(e,"Cookie domain",!1)},d=function(e){return p(e,"Cookie path",!1)},l=function(e,t,n){null==n&&(n={}),_(e),h(t),null!=n.expires&&c(n.expires),null!=n.domain&&u(n.domain),null!=n.path&&d(n.path),document.cookie=[e+"="+t,null!=n.expires?"expires="+n.expires:void 0,null!=n.domain?"domain="+n.domain:void 0,null!=n.path?"path="+n.path:void 0].join("; ")},r=new Date(1).toUTCString(),n={create:function(e,n,r){var o,i;null!=r&&(t.assert("number"==typeof r,"Cookie expiration must be a number"),o=new Date,o.setTime(o.getTime()+24*r*60*60*1e3),i=o.toUTCString()),l(e,n,{expires:i,path:"/"})},read:function(e){var t,n,r,o,i,s,a,l,u,c,d,h;for(_(e),h=[],c=document.cookie.split(";"),o=0,a=c.length;a>o;o++)t=c[o],s=t.split("=",1)[0],s.trim()===e&&h.push(t.substring(s.length+1,t.length).trim());for(n=!1,u=[],r=i=0,l=h.length;l>i;r=++i)d=h[r],""===d?n=!0:u.push(d);return 1===u.length?u[0]:u.length>1?(this.delete(e),null):n?"":null},delete:function(e){var t,n,o,a,u,c,_,d;for(n=[null].concat(i(window.location.hostname)),d=[null].concat(s(window.location.pathname)),o=0,u=n.length;u>o;o++)for(t=n[o],a=0,c=d.length;c>a;a++)_=d[a],l(e,"",{expires:r,domain:t,path:_})},are_enabled:function(){return null!=navigator.cookieEnabled?navigator.cookieEnabled:(document.cookie="this_is_a_test_cookie",-1!==document.cookie.indexOf("this_is_a_test_cookie"))}}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/dom",["jquery","modules/clean/keycode"],function(t,n){var r,o,i,s,a,l,u,c,_,d,h,p,f,m,g,v,y,w,b,x,E,S,T,C,k;return r="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",m=function(e){return e?1===e.nodeType?!0:e.length>=1&&1===e[0].nodeType:!1},d=function(){return g(document.activeElement)},g=function(e){var t,n;return("INPUT"===(t=null!=e?e.tagName:void 0)||"TEXTAREA"===t||"SELECT"===t)&&"submit"!==(n=null!=e?e.type:void 0)&&"button"!==n||f(e)},f=function(e){return(null!=e?e.hasAttribute:void 0)&&(null!=e?e.hasAttribute("contenteditable"):void 0)&&"false"!==(null!=e?e.getAttribute("contenteditable").toLowerCase():void 0)},k=function(e){var n,r,o;return n=t(e),o=n.offset(),r=t(window),{left:o.left-r.scrollLeft(),top:o.top-r.scrollTop()}},i=null,s=null,C=function(){return i||(i={height:t(window).height(),width:t(window).width()}),s||(s=t(window).on("resize",function(){return i=null})),i},c=function(){return Math.max(t(document).height(),t(window).height(),document.documentElement.clientHeight)},a=null,o=null,E=function(){var e,n;return a||(a=t(window).scroll(function(){return o=null})),v()?o||(n=t(window).scrollTop(),e=t(window).scrollLeft(),o={0:e,1:n,left:e,top:n}):(n=l.top,e=l.left,o={0:e,1:n,left:e,top:n}),o},w=function(){return o=null},v=function(){return!t(document.documentElement).hasClass("no-scroll")},x=0,l=null,b=function(){var e,n,r;return x++,e=t(document.documentElement),e.hasClass("no-scroll")?void 0:(l=E(),r=-1*l.top+"px",n=-1*l.left+"px",e.css({top:r,left:n}),e.addClass("no-scroll"))},T=function(){var e,n,r;return x>0&&x--,e=t(document.documentElement),0===x&&e.hasClass("no-scroll")?(r=l.top,n=l.left,e.css({top:"",left:""}),e.removeClass("no-scroll"),S(n,r+1),S(n,r-1),S(n,r)):void 0},S=function(e,n){var r,i,s;return e=Math.max(e,0),n=Math.max(n,0),n>E().top&&(n=Math.min(n,c()-_.viewport_dimensions().height)),v()?(window.scrollTo(e,n),o={0:e,1:n,left:e,top:n}):(l={0:e,1:n,left:e,top:n},s=-1*n+"px",i=-1*e+"px",r=t(document.documentElement),r.css({top:s,left:i}))},u=function(e,n,r){var o,i,s,a,l,u,c,_;return i=t(n),s=t(e),u={setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},r=t.extend({},u,r),_=k(i),c={top:0,left:0},o=null,"absolute"===s.css("position")&&(o=s.offsetParent(),c=k(o)),o&&o[0]===document.body&&(c.left-=document.body.offsetLeft,c.top-=document.body.offsetTop),r.setLeft&&(a=_.left-c.left+r.offsetLeft+"px",s.css("left",a)),r.setTop&&(l=_.top-c.top+r.offsetTop+"px",s.css("top",l)),r.setWidth&&s.width(i[0].offsetWidth),r.setHeight&&s.height(i[0].offsetHeight),s},k=function(e){var n,r,o;return n=t(e),o=n.offset(),r=t(window),{left:o.left-r.scrollLeft(),top:o.top-r.scrollTop()}},h=function(e,n){var o;return o=t(e).find(r).filter(function(){return!!(this.offsetWidth&&this.offsetHeight||this.getClientRects().length)}),n?o.not('*[tabindex="-1"]'):o},p=function(e){var t,n,r,o;return o=h(e,!0),t=o.filter('*:not([tabindex]), *[tabindex="0"]'),r=o.not(t).toArray(),r.length?(n=function(e,t){var n,r;return n=parseInt(e.getAttribute("tabindex"),10),r=parseInt(t.getAttribute("tabindex"),10),n-r},r.sort(n),r.concat(t.toArray())):t.toArray()},y=function(t,r){var o,i,s,a,l,u,c,d,h;if(r.which===n.TAB&&(d=_.getTabbableElementsIn(t),d.length)){if(h=d.indexOf(r.target),-1===h){if(r.preventDefault(),s=_.getFocusableElementsIn(t).toArray(),r.shiftKey&&s.reverse(),a=s.indexOf(r.target),-1===a)return d[0].focus();for(i=null,c=s.slice(a),l=0,u=c.length;u>l;l++)if(o=c[l],e.call(d,o)>=0){i=o;break}return i?i.focus():r.shiftKey?d[d.length-1].focus():d[0].focus()}if(r.shiftKey){if(0===h)return r.preventDefault(),d[d.length-1].focus()}else if(h===d.length-1)return r.preventDefault(),d[0].focus()}},_={clone_position:u,document_height:c,focus_in_input:d,is_input:g,is_content_editable:f,is_page_scrollable:v,scroll_clear_cache:w,scroll_lock_document:b,scroll_offsets:E,scroll_to:S,scroll_unlock_document:T,is_element:m,viewport_offset:k,viewport_dimensions:C,getFocusableElementsIn:h,getTabbableElementsIn:p,keepFocusIn:y}})}.call(this),function(){define("modules/core/exception",["external/underscore","modules/constants/env","modules/constants/legacy","modules/constants/page_load","modules/core/exception_tag_registry","external/tracekit"],function(e,t,n,r,o,i){var s,a,l;return a=o.get_registered_tags,l=0,s=function(){function o(){}return o.SEVERITY={CRITICAL:"critical",NONCRITICAL:"non-critical"},o.strip_comments=function(e){return e.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")},o.fn_body=function(e){var t;return t=o.strip_comments(e.toString()),t=t.replace(/[\s]+/g," "),"("===t[0]&&(t=t.substr(1)),")"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t=t.replace("function (","function(")},o.stackTrace=function(){var e,t,n,r,i,s;for(i=[],s={},e=arguments.callee.caller;e;){if(e.__tb_ajax_info__){i.unshift("Ajax.DBRequest: "+e.__tb_ajax_info__);break}if(e.__tb__){i=e.__tb__.concat(i);break}if(r=o.fn_body(e),r in s)break;s[r]=!0,i.unshift(r);try{e=e.caller}catch(n){t=n,e=null;break}}return i},o.__callbacks=[],o.registerOnFailedAssert=function(e){return this.__callbacks.push(e)},o.reportException=function(e){var t,n,r,s,a,l,u,c;return t=e.err,r=e.force,c=e.tags,a=e.severity,n=e.exc_extra,u=i.computeStackTrace(t),l=null!=(s=null!=u?u.stack:void 0)?s:[],o._reportException({msg:t.message,stack:l,force:r,tags:c,severity:a,exc_extra:n})},o._reportException=function(e){var t,i,s,u,c,_,d,h,p,f,m;if(_=e.msg,h=e.stack,u=e.force,p=e.tags,d=e.severity,s=e.exc_extra,__CIRCULAR_DEPENDENCY__.active_user_loaded?__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading=!0:__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading=!0,!o.reported_exception||u){p||(p=[]),p=p.concat(a()),null==s&&(s={}),s.client_time=(new Date).toString(),s.client_utc_time=(new Date).toUTCString(),l+=1,s.exception_number=l,s.page_repo_rev=r.REPO_REV,t={e:_,loc:window.location.href,ref:n.referrer,stack:JSON.stringify(h.reverse()),tags:JSON.stringify(p),sev:d||"",exc_extra:null!=s?JSON.stringify(s):void 0},m=new XMLHttpRequest,m.open("POST","/jse"),i=[];for(c in t)f=t[c],null!=f&&""!==f&&i.push(encodeURIComponent(c)+"="+encodeURIComponent(f));return i=i.join("&"),m.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),m.send(i),o.reported_exception=_}},o.assert=function(e,n,r){var s,a,l,u,c,_,d,h,p,f,m,g;if(null==n&&(n="An assertion failed but no message was provided"),null==r&&(r={}),!e){for(g=null!=(_=r.tags)?_:[],l=null!=(d=r.exc_extra)?d:null,n="Assertion Error: "+n,t.IS_PROD||alert(n),a=new Error(n),m=i.computeStackTrace(a),o._reportException({msg:n,stack:null!=(h=null!=m&&null!=(p=m.stack)?p.slice(1):void 0)?h:[],force:!0,tags:g.concat("module:exception","assert"),exc_extra:l}),f=o.__callbacks,u=0,c=f.length;c>u;u++)(s=f[u])(m);throw a}},o.raiseAndReport=function(n,r){var i;return null==n&&(n="Raise and report was called without a message"),null==r&&(r={}),r=e.defaults({},r,{severity:o.SEVERITY.NONCRITICAL,tags:[],exc_extra:{}}),i=new Error(n),o.reportException({err:i,force:!0,tags:r.tags.concat("module:exception","raiseAndReport"),severity:r.severity,exc_extra:r.exc_extra}),t.IS_PROD?void 0:r.severity===o.SEVERITY.CRITICAL?(alert(n),"undefined"!=typeof console&&null!==console&&"function"==typeof console.error?console.error(i):void 0):"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn?console.warn(i):void 0},o}()})}.call(this),function(){var e={}.hasOwnProperty;define("modules/core/exception_tag_registry",[],function(){var t,n;return n={},t={},t.get_registered_tags=function(){var t,r;return function(){var o;o=[];for(r in n)e.call(n,r)&&(t=n[r],o.push(r));return o}()},t.register_tag=function(e){return n[e]=!0},t.unregister_tag=function(e){return delete n[e]},t})}.call(this),function(){define("modules/core/html",["jquery","external/underscore","modules/constants/page_load"],function(e,t,n){var r;return r=function(){function e(e){this._str_DONT_TOUCH=e}return e.prototype.toHTML=function(){return this._str_DONT_TOUCH},e.prototype.toString=function(){return"[object HTML]"},e}(),function(){var o,i,s,a;return r.tmpl=function(o,i){var s,a,l,u;return/[^\w:.-]/.test(o)||(a=document.getElementById(o),o=a.innerHTML,null!=n.CSP_SCRIPT_NONCE&&n.CSP_SCRIPT_NONCE!==a.getAttribute("nonce")&&(o="")),u=o.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.*?)%>/g,"',__no_conflict_HTML__._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('"),s=new Function("__no_conflict_HTML__","__no_conflict_jQuery__","TEMPLATE_DATA","var p=[],print=function(){p.push.apply(p,arguments);}; p.push('"+u+"'); return new __no_conflict_HTML__(__no_conflict_jQuery__.trim(p.join('')));"),l=t.partial(s,r,e),i?l(i):l},i=/[^\w@\.\ \-\(\)\,\$~%#\[\]\{\}\!\^]/g,a=function(e){return"&#"+e.charCodeAt(0)+";"},s=function(e){return(""+e).replace(i,a)},r.escape=function(e){return e instanceof r?e:new r(s(e))},r._raw_escape=o=function(e){return e instanceof r?e.toHTML():"number"==typeof e?e:s(e)}}(),r})}.call(this),function(){define("modules/core/i18n",["external/underscore","langpack","modules/core/exception","modules/constants/viewer","external/sha1","require"],function(e,t,n,r,o,i){var s,a,l,u,c,_,d,h,p,f,m,g,v;for(m=n.assert,u="abcdefghijklmnopqrstuvwxyz",c="",p="ABCDEFGHIJKLMNOPQRSTUVWXYZ",f="",s={},g=v=0;26>v;g=++v)s[u.charAt(g)]=c.charAt(g),s[p.charAt(g)]=f.charAt(g);return a=function(){function n(){}return n.messages={},n.emessages={},n.RAND=0,n.NUM_MISSED=0,n.add_i18n_message=function(e,t,n,r){return t=t.strip_tags().friendly_format(),n=n.strip_tags(),this.messages[t]=e,this.emessages[t]=n,r?(delete this.messages[r],delete this.emessages[r]):void 0},n.PLURAL_RULES={SINGULAR_1:function(e){return 1===e?0:1},SINGULAR_01:function(e){return 1>=e?0:1},SINGULAR_ALL:function(e){return 0},RUSSIA_UKRAINE:function(e){return e%10===1&&e%100!==11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2},POLAND:function(e){return 1===e?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2}},n.PLURAL_RULES_BY_LOCALE={en:n.PLURAL_RULES.SINGULAR_1,en_GB:n.PLURAL_RULES.SINGULAR_1,da_DK:n.PLURAL_RULES.SINGULAR_1,de:n.PLURAL_RULES.SINGULAR_1,es_ES:n.PLURAL_RULES.SINGULAR_1,es:n.PLURAL_RULES.SINGULAR_1,fr:n.PLURAL_RULES.SINGULAR_01,id:n.PLURAL_RULES.SINGULAR_ALL,it:n.PLURAL_RULES.SINGULAR_1,ja:n.PLURAL_RULES.SINGULAR_ALL,ko:n.PLURAL_RULES.SINGULAR_ALL,ms:n.PLURAL_RULES.SINGULAR_ALL,nb_NO:n.PLURAL_RULES.SINGULAR_1,nl_NL:n.PLURAL_RULES.SINGULAR_1,pl:n.PLURAL_RULES.POLAND,pt_BR:n.PLURAL_RULES.SINGULAR_01,ru:n.PLURAL_RULES.RUSSIA_UKRAINE,sv_SE:n.PLURAL_RULES.SINGULAR_1,th_TH:n.PLURAL_RULES.SINGULAR_ALL,tr:n.PLURAL_RULES.SINGULAR_ALL,uk_UA:n.PLURAL_RULES.RUSSIA_UKRAINE,xx_AC:n.PLURAL_RULES.SINGULAR_1,xx_LS:n.PLURAL_RULES.SINGULAR_1,xx_HA:n.PLURAL_RULES.SINGULAR_1,xx_RL:n.PLURAL_RULES.SINGULAR_1,xx_AE:n.PLURAL_RULES.SINGULAR_1,xx_SL:n.PLURAL_RULES.SINGULAR_1,zh_CN:n.PLURAL_RULES.SINGULAR_ALL,zh_TW:n.PLURAL_RULES.SINGULAR_ALL},n.PERCENT_FORMAT={SUFFIX:function(e){return"%(percent)s%".format({percent:e})},PREFIX:function(e){return"%"+"%(percent)s".format({percent:e})},SUFFIX_SPACE:function(e){return"%(percent)s%".format({percent:e})}},n.PERCENT_FORMAT_BY_LOCALE={en:n.PERCENT_FORMAT.SUFFIX,en_GB:n.PERCENT_FORMAT.SUFFIX,da_DK:n.PERCENT_FORMAT.SUFFIX_SPACE,de:n.PERCENT_FORMAT.SUFFIX_SPACE,es_ES:n.PERCENT_FORMAT.SUFFIX,es:n.PERCENT_FORMAT.SUFFIX,fr:n.PERCENT_FORMAT.SUFFIX_SPACE,id:n.PERCENT_FORMAT.SUFFIX,it:n.PERCENT_FORMAT.SUFFIX,ja:n.PERCENT_FORMAT.SUFFIX,ko:n.PERCENT_FORMAT.SUFFIX,ms:n.PERCENT_FORMAT.SUFFIX,nb_NO:n.PERCENT_FORMAT.SUFFIX_SPACE,nl_NL:n.PERCENT_FORMAT.SUFFIX,pl:n.PERCENT_FORMAT.SUFFIX,pt_BR:n.PERCENT_FORMAT.SUFFIX,ru:n.PERCENT_FORMAT.SUFFIX_SPACE,sv_SE:n.PERCENT_FORMAT.SUFFIX_SPACE,th_TH:n.PERCENT_FORMAT.SUFFIX,tr:n.PERCENT_FORMAT.PREFIX,uk_UA:n.PERCENT_FORMAT.SUFFIX,xx_AC:n.PERCENT_FORMAT.SUFFIX,xx_LS:n.PERCENT_FORMAT.SUFFIX,xx_HA:n.PERCENT_FORMAT.SUFFIX,xx_RL:n.PERCENT_FORMAT.SUFFIX,xx_AE:n.PERCENT_FORMAT.SUFFIX,zh_CN:n.PERCENT_FORMAT.SUFFIX,zh_TW:n.PERCENT_FORMAT.SUFFIX},n.get_langpack=function(){return t},n._convert_project_comment=function(t,n,r){return null==r&&(r="web"),e.isObject(t)||(t={project:t}),e.isObject(n)||(n={comment:n}),e.defaults({},t,n,{project:r,comment:null})},n._=function(e,t,o){var s,a,u,c,_;return c=n._convert_project_comment(t,o),t=c.project,o=c.comment,n.locale_is_fake(r.USER_LOCALE)?u=n.fake_translate(e,r.USER_LOCALE):(_=l.get_string_key(e,t,o),s=n.get_langpack(),a=s[_]||s[e],a?u=a instanceof String||"string"==typeof a?a:a[0]||e:(0===n.RAND&&"en"!==r.USER_LOCALE&&(n.RAND=Math.floor(20*Math.random()+1)),1===n.RAND&&n.NUM_MISSED<4&&(n.NUM_MISSED+=1,i(["jquery"],function(n){return n.ajax({url:"/missed_translation_log",type:"POST",data:{message:e,comment:o,project:t}})})),u=e)),n.add_i18n_message(e,u,e),u},n.fake_translate=function(e,t){var n,r,o,i,a,l,u;if("xx_LS"===t&&(e+="SSSSSSSSSSSSSSSSSSSSSSSSS"),"xx_AC"!==t||/</.test(e)||(e=e.toUpperCase()),"xx_HA"===t&&(e="[javascript]"+e),"xx_RL"===t&&!/</.test(e)&&!/%/.test(e)){for(a=97,o=1488,l="",e=e.toLowerCase(),g=i=0,u=e.length;u>=0?u>i:i>u;g=u>=0?++i:--i)n=e.charCodeAt(g)-a,l+=n>=0&&26>n?String.fromCharCode(o+n):e[g];e=l}return"xx_AE"!==t||/</.test(e)||/%/.test(e)||(e=function(){var t,n,o,i;for(i=[],g=t=0,n=e.length;n>=0?n>t:t>n;g=n>=0?++t:--t)r=e.charAt(g),i.push(null!=(o=s[r])?o:r);return i}().join("")),e},n.locale_is_fake=function(e){return-1!==e.indexOf("xx_")},n.ungettext=function(e,t,o,i,s){var a,u,c,_,d,h,p,f;if(h=n._convert_project_comment(i,s),i=h.project,s=h.comment,m(null!=o,"missing number parameter for ungettext"),c=r.USER_LOCALE)if(n.locale_is_fake(c))e=n.fake_translate(e,c),t=n.fake_translate(t,c);else if(f=l.get_string_key(e,i,s),u=n.get_langpack(),_=u[f]||u[e]){if(_ instanceof String||"string"==typeof _)return _;d=n.PLURAL_RULES_BY_LOCALE[c](o),d in _&&(p=_[d])}return a=1===o?e:t,null==p&&(p=a),n.add_i18n_message(e,p,a),p},n.N_=function(e,t,r){var o;return o=n._convert_project_comment(t,r),t=o.project,r=o.comment,new _(e,t,r)},n.E_=function(e){return n._(e.msg,e.project,e.comment)},n.render_sentences=function(e){var t,r,o,i,s,a;if(o=e.length,1===o)return e[0];if(2===o)return n._("%s %s",{comment:"Two sentences"}).format(e);if(3===o)return n._("%s %s %s",{comment:"Three sentences"}).format(e);if(4===o)return n._("%s %s %s %s",{comment:"Four sentences"}).format(e);for(i="",a=0,t=0,r=e.length;r>t;t++)s=e[t],i+=s,a!==o-1&&(i+=n._(" ",{comment:"Sentence separator character"})),a+=1;return i},n.format_percent=function(e){var t;return t=r.USER_LOCALE,t?n.PERCENT_FORMAT_BY_LOCALE[t](e):n.PERCENT_FORMAT.SUFFIX(e)},n.i18n_default_project=function(e){return{_:function(t,r,o){var i;return i=n._convert_project_comment(r,o,e),r=i.project,o=i.comment,n._(t,r,o)},ungettext:function(t,r,o,i,s){var a;return a=n._convert_project_comment(i,s,e),i=a.project,s=a.comment,n.ungettext(t,r,o,i,s)},N_:function(t,r,o){var i;return i=n._convert_project_comment(r,o,e),r=i.project,o=i.comment,n.N_(t,r,o)},E_:n.E_}},n.case_insensitive_comparator=function(){var e,t;return null!=(null!=(t=window.Intl)?t.Collator:void 0)?(e=r.USER_LOCALE.replace("_","-")||"en",new window.Intl.Collator(e).compare):function(e,t){var n,r;return n=e.toLowerCase(),r=t.toLowerCase(),r>n?-1:n>r?1:t>e?-1:e>t?1:0}},n}(),_=function(){function e(e,t,n){this.msg=e,this.project=t,this.comment=n}return e}(),l=function(){function e(){}return e.get_message_context=function(e,t){var n,r,i;return r="","web"!==e&&(r="project:"+e),null!=t&&(i=new o(t,"TEXT"),n=i.getHash("SHA-1","HEX"),r?r+=" "+n:r=n),r},e.CONTEXT_DELIMITER="",e.get_string_key=function(t,n,r){var o;return o=e.get_message_context(n,r),null!=o?o+e.CONTEXT_DELIMITER+t:t},e}(),h=function(e){return"undefined"==typeof Array.isArray?"[object Array]"===Object.prototype.toString.call(e):Array.isArray(e)},d=function(){var e,t,n;return e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},String.prototype.format_sub=function(e){return this.replace(/%(\([a-zA-Z0-9_\-]+\))?(.\d+)?(.)/g,d(e,this))},String.prototype.format=function(){var e,t,n,o,i,s;return 0===arguments.length?this.toString():(t=void 0,e=0,t=1===arguments.length&&arguments[0]instanceof Object?arguments[0]:Array.prototype.slice.call(arguments,0),i=function(n,o,i,s){var a,l,u,c;if(o?(o=o.slice(1,-1),m(0>=e,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),e=-1,a="xx_AC"===r.USER_LOCALE,m(o in t||a&&o.toLowerCase()in t,"Key '"+o+"' not present during string substitution for string '"+this+"'"),c=t[o],a&&(c=t[o.toLowerCase()])):(h(t)||(t=[t]),m(e>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),m(e<t.length,"Insufficient number of items in format for string '"+this+"'"),c=t[e],e++),m("undefined"!=typeof c,"value for key '"+(o||"")+"' is undefined"),u=void 0,"s"===s||"S"===s)u=c.toString();else if("d"===s||"D"===s)u=parseInt(c,10).toString();else if("f"===s||"F"===s)u=Number(c).toString();else{if("%"===s)return"%";m(!1,"Unexpected format character '"+s+"' for string '"+this+"'.")}return i?(i=parseInt(i.slice(1),10),"f"===s||"F"===s?(u.indexOf(!1)&&(u+=".0"),l=u.split("."),l[0]+"."+l[1].slice(0,i)):u.slice(0,i)):u},s=this.format_sub(i),a.messages&&this in a.messages&&(e=0,o=a.emessages[this],n=String.prototype.format_sub.call(o,i),a.add_i18n_message(o,s,n,this)),s)},String.prototype.friendly_format=function(){var e,t,n;return t=function(t,r,o,i){return r?"["+r.slice(1,1).replace("-","_")+"]":"s"===i||"S"===i?"[word"+n++ +"]":"[number"+e++ +"]"},e=1,n=1,this.format_sub(t)},String.prototype.blank_format=function(){var e;return e=function(){return""},this.format_sub(e)},String.prototype.strip_tags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},a})}.call(this),function(){define("modules/core/notify",["jquery","external/purify","modules/core/accessible_announce","modules/core/html","modules/core/i18n","modules/clean/gandalf_util"],function(e,t,n,r,o,i){var s,a,l,u;return u=t.sanitize,a=o._,l=i.getGandalfRule,s=function(){function t(){}return t.DEFAULT_ERROR=a("There was a problem completing this request."),t.DEFAULT_SUCCESS=a("Your request completed successfully."),t.success=function(e,t){return null==t&&(t=10),e=e||this.DEFAULT_SUCCESS,n.polite(e,t+1),this._show(e,t,"server-success"),this.current()},t.error=function(e,t){return null==t&&(t=10),e=e||this.DEFAULT_ERROR,l("db_readonly_maintenance")&&e===this.DEFAULT_ERROR&&(e+=a(" Dropbox might be undergoing maintenance.<br>Check <a href='http://status.dropbox.com'>status.dropbox.com</a>."),e=new r(u(e)),t=60),n.assertive(e,t+1),this._show(e,t,"server-error"),this.current()},t.warning=function(e,t){return null==t&&(t=10),n.polite(e,t+1),this._show(e,t,"server-warning"),this.current()},t.info=function(e,t){return null==t&&(t=10),n.polite(e,t+1),this._show(e,t,"server-info"),this.current()},t.clear=function(){return this._last_timeout&&clearTimeout(this._last_timeout),this._last_animation&&this._last_animation.stop(),this._last_timeout=null,this._last_animation=null,e("#notify").removeClass("server-error server-info server-success server-warning").hide()},t.isShown=function(){return e("#notify").is(":visible")},t.current=function(){return this._last_timeout},t._show=function(e,t,n){return this._buildElement(),this.clear(),this._setMessage(e),this._showElement(n),this._scheduleHide(t),this.current()},t._buildElement=function(){var t;if(!e("#notify").length)return t='<div id="notify-wrapper"> <span id="notify"> <span id="notify-msg" /> </span> </div>',e("body").append(t)},t._setMessage=function(t){var n;return n=e("#notify-msg"),null!=t.toHTML?n.html(t.toHTML()):t instanceof e?n.html(t):n.text(t)},t._showElement=function(t){var n;return n=e("#notify"),n.addClass(t),this._last_animation=n.fadeIn(500);
},t._scheduleHide=function(e){return this._last_timeout=setTimeout(this._hide,1e3*e)},t._hide=function(){var n;return n=e("#notify"),t._last_animation=n.fadeOut(1e3),t._last_timeout=null},t}(),INLINE_JS.Notify=s,s})}.call(this),function(){define("modules/core/ordered_dictionary",[],function(){var e;return e=function(){function e(e,t){this.list=e,this.dict=t}return e.list=[],e.dict={},e.prototype.push=function(e,t){this.list.push(e),this.dict[e]=t},e.prototype.remove=function(e){this.list.removeItem(e),delete this.dict[e]},e.prototype.indexOfKey=function(e){return this.list.indexOf(e)},e.prototype.keyAtIndex=function(e){return this.list[e]},e.prototype.valueFromKey=function(e){return this.dict[e]},e.prototype.valueAtIndex=function(e){return this.dict[this.list[e]]},e.prototype.getValues=function(){var e;return function(){var t,n,r,o;for(r=this.list,o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(this.dict[e]);return o}.call(this)},e.prototype.length=function(){return this.list.length},e.prototype.insertAtIndex=function(e,t,n){return this.list.splice(e,0,t),this.dict[t]=n},e}()})}.call(this),function(){define("modules/core/uri",["modules/constants/env","modules/core/exception"],function(e,t){var n,r,o;return o=t.assert,r=function(){function t(r,o){var i,s,a,l;if(!(this instanceof t))return new t(r,o);if(this._query=new n,a={},"string"==typeof r||r instanceof t){if(!e.IS_PROD)throw new Error("URI/uri string passed into URI constructor.  Use URI.parse instead.");a=t.parse(r).toObject()}else"object"==typeof r&&(a=r);if(o&&!e.IS_PROD)throw new Error("Multiple arguments passed into URI constructor.");s=o||{};for(i in s)l=s[i],a[i]=l;this.initFromObject(a)}return t.prototype.initFromObject=function(e){var t,n,r;return n=null!=e?e:{},r=n.scheme,this.authority=n.authority,this.path=n.path,t=n.query,this.fragment=n.fragment,this.setScheme(r),this.setQuery(t)},t.parse=function(e){var r,i,s,a,l,u,c,_;return o(null!=e,"must pass in a valid url-encoded string",{exc_extra:{uri_string_param:e}}),c=String(e).match(t.REGEXP)||[],u=c[0],l=c[1],r=c[2],s=c[3],a=c[4],i=c[5],_=new t,_.setScheme(l),_.setAuthority(t.decode(r)),_.setPath(t.decode(s)),_.setQuery(n.parse_string(a)),_.setFragment(t.decode(i)),_},t.prototype.getScheme=function(){return this.scheme||""},t.prototype.setScheme=function(e){return o(!e||e.match(t.SCHEME_REGEXP),"Invalid scheme",{exc_extra:{scheme_param:e}}),this.scheme=e,this},t.prototype.getAuthority=function(){return this.authority||""},t.prototype.setAuthority=function(e){return this.authority=e,this},t.prototype.getPath=function(){return this.path||""},t.prototype.setPath=function(e){return this.path=e,this},t.prototype.getFragment=function(){return this.fragment||""},t.prototype.setFragment=function(e){return this.fragment=e,this},t.prototype.getQuery=function(){return this._query.dict},t.prototype.setQuery=function(e){return null==e&&(e={}),this._query=new n(e),this},t.prototype.updateQuery=function(e,t){return null==t&&(t=null),this._query.add(e,t),this},t.prototype.removeQuery=function(e){return this._query.remove(e),this},t.prototype.clone=function(){return t(this.toObject())},t.prototype.toObject=function(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}},t.prototype.toString=function(){var e,n;return n="",this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+t.encode(this.authority,":@[]")),this.path&&(o(!this.authority||!this.path.length||"/"===this.path[0],'Path must start with a "/" if URI is not relative'),n+=t.encode(this.path,"/")),e=this._query.toString(),e&&(n+="?"+e),this.fragment&&(n+="#"+t.encode(this.fragment,":@[]/&=+?#!")),n},t.REGEXP=/^(?:([^:\/\\?#]+):)?(?:[\/\\]{2}([^\/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,t.SCHEME_REGEXP=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/,t.decode=function(e){return e?decodeURIComponent(e):""},t.encode=function(e,t){var n,r,o,i;if(null==t&&(t=""),!e)return"";for(e=encodeURIComponent(e),t+="~",r=0,o=t.length;o>r;r++)i=t[r],n=encodeURIComponent(i),e=e.replace(new RegExp(n,"g"),i);return e},t.encode_parts=function(e,n){var r;return null==n&&(n="/"),function(){var o,i,s,a;for(s=e.split(n),a=[],o=0,i=s.length;i>o;o++)r=s[o],a.push(t.encode(r));return a}().join(n)},t}(),n=function(){function e(e){this.dict={},this.add(e)}return e.parse_string=function(t){var n,r,o,i,s,a,l,u;if(!t)return null;for(s={},a=t.split("&"),n=0,o=a.length;o>n;n++)i=a[n],""!==i&&(l=i.split("="),r=e.decode(l[0]),u=e.decode(l.slice(1).join("=")),r in s?(Array.isArray(s[r])||(s[r]=[s[r]]),s[r].push(u)):s[r]=u);return s},e.prototype.add=function(e,t){var n,r,o,i;if(null==t&&(t=null),"string"==typeof e)null!=t&&(Array.isArray(t)?this.dict[e]=function(){var e,r,o;for(o=[],e=0,r=t.length;r>e;e++)n=t[e],o.push(String(n));return o}():this.dict[e]=String(t));else{o=e||{};for(r in o)i=o[r],null!=i&&(Array.isArray(i)?this.dict[r]=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)n=i[e],r.push(String(n));return r}():this.dict[r]=String(i))}return this},e.prototype.remove=function(e){return delete this.dict[e]},e.prototype.replace=function(e){return this.dict=e||{},this},e.prototype.toString=function(){var t,n,r,o;r=[],n=this.dict;for(t in n)o=n[t],Array.isArray(o)?o.forEach(function(n){return r.push(e.encode(t)+"="+e.encode(n))}):r.push(e.encode(t)+"="+e.encode(o));return r.length?r.join("&"):""},e.decode=function(e){return null===e?"":r.decode(e.replace(/\+/g,"%20"))},e.encode=function(e){return null===e?"":r.encode(e).replace(/%20/g,"+")},e}(),INLINE_JS.URI=r,r})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/clean/sharing/signup_modal_proxy","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/components/login_form","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/profile_services/third_party_signup","modules/clean/register_form"],function(t,n,r,o,i,s,a,l,u,c,_,d,h,p){var f,m,g,v,y,w,b;return v=t.SharingModel,b=s._,w=u.WebMiscActivityLogger,f=_.DBModal,y=h.ThirdPartySignup,g=p.RegisterForm,m=function(){function t(t){this.kind=t,this.register_success=e(this.register_success,this),this.show_login_form=e(this.show_login_form,this),this.save_to_dropbox=e(this.save_to_dropbox,this),this.direct_download=e(this.direct_download,this),this.handle_default_modal_cancel=e(this.handle_default_modal_cancel,this),this.handle_default_modal_authenticate=e(this.handle_default_modal_authenticate,this),this.handle_direct_download_cancel=e(this.handle_direct_download_cancel,this),this.handle_direct_download=e(this.handle_direct_download,this),this.on_request_default_signup=e(this.on_request_default_signup,this),this.on_request_direct_download=e(this.on_request_direct_download,this),this.show_create_password_modal=e(this.show_create_password_modal,this),this.show_welcome_modal=e(this.show_welcome_modal,this),this.before_create_password_modal=e(this.before_create_password_modal,this),this.before_download_signup_modal=e(this.before_download_signup_modal,this),this.before_default_signup_modal=e(this.before_default_signup_modal,this),this.before_signup_modal=e(this.before_signup_modal,this),this.init_modals=e(this.init_modals,this),this.init_modals(),o.connectModal(this),"immediate"===this.kind&&(w.log("signup_modal-show-upfront",{auth_google:null!=n.find(".auth-google")}),this.default_signup_modal.show()),"download"!==this.kind?n("#download_button_link, #default_content_download_button").click(this.direct_download):n("#download_button_link, #default_content_download_button").click(function(e){return function(){return e.has_seen_modal?e.direct_download():(e.has_seen_modal=!0,w.log("signup_modal-show-download",{auth_google:null!=n.find(".auth-google")}),e.download_type="direct_download",e.download_signup_modal.show())}}(this)),n(".add_to_my_dropbox_link, #default_content_a2md").click(function(e){return function(){return e.download_type="add_to_dropbox",e.download_signup_modal.show()}}(this))}return t.prototype.init_modals=function(){return this.default_signup_modal=new f({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.default_signup_modal.on_hide=function(e){return function(){return e._has_authenticated?void 0:"function"==typeof e._on_default_modal_cancel?e._on_default_modal_cancel():void 0}}(this),this.download_signup_modal=new f({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.download_signup_modal.on_hide=function(e){return function(){return e._direct_download_started?void 0:"function"==typeof e._on_direct_download_cancel?e._on_direct_download_cancel():void 0}}(this),this.welcome_modal=new f({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new f({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},t.prototype.before_signup_modal=function(e){var t,n;return e.find(".toggle-form-link").click(function(t){return function(){return t.toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&(n.on(g.NEW_ACCOUNT_FROM_3RD_PARTY,function(t){return function(n,r){return t.profile_info=r,t.show_create_password_modal(e,t.profile_info)}}(this)),n.on(g.USER_EXISTS,function(t){return function(n){return t.show_login_form(e,n)}}(this)),n.on(g.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))),t=e.find(".login-form"),t.length?t.on(c.LOGIN_SUCCESS,function(e){return function(t,n){return e.user_info=n,a.success(b("Successfully signed in to Dropbox")),e.download_type?"direct_download"===e.download_type?(e.direct_download(),e.reload()):"add_to_dropbox"===e.download_type?e.save_to_dropbox(!1):void 0:e.reload()}}(this)):void 0},t.prototype.before_default_signup_modal=function(e){return this.before_signup_modal(e),e.find(".close-link").click(function(e){return function(){return e.default_signup_modal.hide()}}(this))},t.prototype.before_download_signup_modal=function(e){return this.before_signup_modal(e),this._direct_download_started=!1,"add_to_dropbox"===this.download_type&&(e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(e){return function(){return e.direct_download(),e.download_signup_modal.hide()}}(this))},t.prototype.before_create_password_modal=function(e){var t,n;return e.find(".close-link").click(function(e){return function(){return e.create_password_modal.hide()}}(this)),t=e.find(".create-password-form-component"),y.handle_picture_url(this.profile_info.picture_url,null,null,!1),n=t.find(".register-form"),n.on(g.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))},t.prototype.before_welcome_modal=function(e){return d.log("sharing","shared_link_welcome_modal_view"),e.find(".go-to-dropbox-button").click(function(){return d.log("sharing","shared_link_welcome_modal_button_click")}),e.find(".welcome-modal-no-thanks a").click(function(){return i.reload()})},t.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},t.prototype.show_create_password_modal=function(e,t){var n,r,o;return this.default_signup_modal.hide(),this.download_signup_modal.hide(),o={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token},this.create_password_modal.show(n="input[name=password]",r=o)},t.prototype.on_request_direct_download=function(){return this.has_seen_modal?this.direct_download():(this.has_seen_modal=!0,w.log("signup_modal-show-download",{auth_google:null!=n.find(".auth-google")}),this.download_type="direct_download",this.download_signup_modal.show())},t.prototype.on_request_default_signup=function(){return this.download_type="add_to_dropbox",this._has_authenticated=!1,this.default_signup_modal.show()},t.prototype.handle_direct_download=function(e){return this._direct_download_override_callback=e},t.prototype.handle_direct_download_cancel=function(e){return this._on_direct_download_cancel=e},t.prototype.handle_default_modal_authenticate=function(e){return this._on_default_modal_authenticate=e},t.prototype.handle_default_modal_cancel=function(e){return this._on_default_modal_cancel=e},t.prototype.direct_download=function(){var e;return this._direct_download_started=!0,null!=this._direct_download_override_callback?void this._direct_download_override_callback():(e=i.get_uri().updateQuery({dl:1}),i.redirect(e))},t.prototype.reload=function(){return i.reload()},t.prototype.save_to_dropbox=function(e){var t;return null!=this._on_default_modal_authenticate?(this._on_default_modal_authenticate(this.user_info.id),this._has_authenticated=!0,void this.default_signup_modal.hide()):(e||a.success(b("Saving to your Dropbox ...")),t=v.c2d_vars,t.job=v.is_folder,r.WebRequest({url:v.c2d_url,data:t,subject_user:this.user_info.id,success:function(t){return e?void 0:(a.success(b("Successfully saved to your Dropbox.")),i.redirect(t))}}))},t.prototype.show_login_form=function(e,t){var n,r,o,i,s;r=e.find(".login-form-component"),o=r.find(".login-form"),i=t.prefill;for(n in i)s=i[n],o.find(n).val(s);return o.find(t.focus).focus(),r.is(":visible")?void 0:this.toggle_form(e,!0)},t.prototype.toggle_form=function(e,t){var r,o;return o=e.find(".register-form-component"),r=e.find(".login-form-component"),o.is(":visible")?o.fadeOut({complete:function(){return r.show(),null!=t?setTimeout(function(){return n(r.find(".login-form .login-password input[name='login_password']")[0]).focus()},0):void 0}}):r.fadeOut({complete:function(){return o.show()}})},t.prototype.register_success=function(e){return a.success(b("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.direct_download(),this.show_welcome_modal()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},t}()})}.call(this),function(){define("modules/dirty/react/file_viewer/container",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/dirty/react/file_viewer/share_helpers"],function(e,t,n,r){var o;return o=e.createClass({displayName:"FileViewerContainer",propTypes:{files:e.PropTypes.array.isRequired,currentIndex:e.PropTypes.number.isRequired,user:e.PropTypes.object,fileViewerProps:e.PropTypes.object.isRequired,sharedLinkInfo:e.PropTypes.object,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object},componentWillMount:function(){var e;return e={sharedLinkInfos:[this.props.sharedLinkInfo],shareTokens:[this.props.shareToken],sharePermissions:[this.props.sharePermissions],disableFlipping:!1},t.setup(this.props.files,this.props.currentIndex,this.props.user,e)},componentWillUnmount:function(){return t.cleanup()},render:function(){var t;return t=this.props.fileViewerProps,t.shareHelpers=r,e.createElement(n,t)}})})}.call(this),function(){var e=[].slice;define("modules/dirty/sharing/wizard_modals",["require","external/react","modules/core/notify","modules/clean/analytics","modules/clean/components/ajax_form","modules/clean/react/modal","modules/clean/sharing/api","modules/clean/sharing/constants","modules/clean/sharing/wizard/share_new_folder_wizard_modal","modules/clean/sharing/wizard/share_existing_folder_wizard_modal","modules/clean/sharing/wizard/share_a_folder_wizard_modal","modules/clean/sharing/ui_util","modules/dirty/sharing/browse_ui_util"],function(t,n,r,o,i,s,a,l,u,c,_,d,h){var p,f,m,g,v,y,w,b,x,E,S,T,C,k,R,A,N,L;return w=o.SharingExperimentsLogger,p=s.Modal,v=a.SharingApi,g=u.ShareNewFolderWizardModal,m=c.ShareExistingFolderWizardModal,f=_.ShareAFolderWizardModal,y=d.SharingExperiments,L=h.showTiburonUIIfAllowed,S=h.showNewFolderTiburonUIIfAllowed,b=n.createElement,N=function(e,t){return l.TIBURON.WIZARD_UI[e]?(A(e,t.show),!0):!1},E=function(e,t,n,o){var s,a,l;return l=function(){if(!L(e,{fqPath:"/"+t,isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:o}))throw new Error("Tiburon UI must be allowed")},s=function(e){var t;return t=i.extract_errors(e.responseText),t!==!1?"string"==typeof t?r.error(t):"function"==typeof n?n(t):void 0:void 0},a=new v(e),a.validate_new_sf_path(t,l,s)},x=function(e,t,n,o){var s,a,l;return l=function(){if(!L(e,{fqPath:t,isFolder:!0,exists:!0,origin:"WIZARD",shouldFetchNsId:!0,modalSessionId:null!=o?o:void 0}))throw new Error("Tiburon UI must be allowed")},s=function(e){var t;return t=i.extract_errors(e.responseText),t!==!1?"string"==typeof t?r.error(t):"function"==typeof n?n(t):void 0:void 0},a=new v(e),a.validate_shareable_existing_sf_path(t,l,s)},A=function(t,r,o){return null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_NEW_FOLDER_WIZARD",{modalSessionId:o}),p.showInstance(n.createElement(g,{user:t,onBack:r,onSubmit:function(n,r){var i;return i=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_NEW_FOLDER_WIZARD_ERROR",{modalSessionId:o}),r.apply(null,n)},null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_NEW_FOLDER_WIZARD",{modalSessionId:o}),E(t,n,i,o)}}))},R=function(e,t){return l.TIBURON.WIZARD_UI[e]?(k(e,t.show),!0):!1},k=function(t,r,o){return null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:o}),p.showInstance(n.createElement(m,{user:t,onBack:r,onSubmit:function(n,r){var i;return i=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD_ERROR",{modalSessionId:o}),r.apply(null,n)},null!=o&&w.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:o}),x(t,n,i)}}))},C=function(e,t){return l.TIBURON.WIZARD_UI[e]?(T(e,t),!0):!1},T=function(e,t){return null!=t&&w.log(e.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_A_FOLDER_WIZARD",{modalSessionId:t}),p.showInstance(n.createElement(f,{user:e,onSubmit:function(n){return null!=t&&w.log(e.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_A_FOLDER_WIZARD",{target:n,modalSessionId:t}),"new-folder"===n?y.simplifiedWizardUIWithWizard(e.id)?S(e,t):A(e,T.bind(this,e,t),t):"existing-folder"===n?k(e,T.bind(this,e,t),t):void 0}}))},{shareNewFolder:E,shareExistingFolder:x,showShareNewFolderWizardModalIfAllowed:N,showShareExistingFolderWizardModalIfAllowed:R,showShareAFolderWizardModal:T,showShareAFolderWizardModalIfAllowed:C}})}.call(this),function(){define("modules/shims/jquery-security-patch",["jquery","modules/constants/page_load"],function(e,t){var n=/checked\s*(?:[^=]|=\s*.checked.)/i;return e.fn.domManip=function(r,o,i){var s=function(t){return t.type=(null!==e.find.attr(t,"type"))+"/"+t.type,t},a=function(t,n){var r,o,i=0,s="undefined",l=typeof t.getElementsByTagName!==s?t.getElementsByTagName(n||"*"):typeof t.querySelectorAll!==s?t.querySelectorAll(n||"*"):void 0;if(!l)for(l=[],r=t.childNodes||t;null!=(o=r[i]);i++)!n||e.nodeName(o,n)?l.push(o):e.merge(l,a(o,n));return void 0===n||n&&e.nodeName(t,n)?e.merge([t],l):l},l=function(e){var t=/^true\/(.*)/.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e};r=[].concat.apply([],r);var u,c,_,d,h,p,f=0,m=this.length,g=this,v=m-1,y=r[0],w=e.isFunction(y);if(w||!(1>=m||"string"!=typeof y||e.support.checkClone)&&n.test(y))return this.each(function(e){var t=g.eq(e);w&&(r[0]=y.call(this,e,t.html())),t.domManip(r,o,i)});if(m&&(p=e.buildFragment(r,this[0].ownerDocument,!1,!i&&this),u=p.firstChild,1===p.childNodes.length&&(p=u),u)){for(d=e.map(a(p,"script"),s),_=d.length;m>f;f++)c=p,f!==v&&(c=e.clone(c,!0,!0),_&&e.merge(d,a(c,"script"))),o.call(this[f],c,f);if(_)for(h=d[d.length-1].ownerDocument,e.map(d,l),f=0;_>f;f++)c=d[f],null==t.CSP_SCRIPT_NONCE||t.CSP_SCRIPT_NONCE===c.getAttribute("nonce")?/^$|\/(?:java|ecma)script/i.test(c.type||"")&&!e._data(c,"globalEval")&&e.contains(h,c)&&(c.src?e._evalUrl(c.src):e.globalEval((c.text||c.textContent||c.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,""))):console.error("Refused to execute script from node "+c+" because PageLoadConstants.CSP_SCRIPT_NONCE is defined and the nonce doesn't match.");p=u=null}return this},e.ajaxSettings.converters["text script"]=!0,e.noConflict()})}.call(this),function(){define("modules/shims/react",["external/react","modules/core/exception"],function(e,t){var n,r;return r=t.raiseAndReport,n=0,"function"==typeof e.registerWarningHandler&&e.registerWarningHandler(function(e){return 10>n&&r(e,{tags:["react-warning"]}),n+=1}),e})}.call(this),function(){define("modules/shims/rsvp",["external/rsvp","modules/core/exception"],function(e,t){return e.on("error",function(e){var n;return"undefined"!=typeof console&&null!==console&&"function"==typeof console.error&&console.error(null!=(n=null!=e?e.stack:void 0)?n:e),e instanceof Error||(e=new Error(e)),t.reportException({err:e})}),e})}.call(this),function(){define("modules/shims/tracekit",["external/tracekit"],function(e){return e.linesOfContext=1,e.remoteFetching=!1,e.noConflict()})}.call(this);
//# sourceMappingURL=pkg-ab.min.js-vflMkdcRc.map